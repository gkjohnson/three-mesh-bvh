import{J,n as se,V as E,Y as ce,t as de,o as re,W as ue,c as fe,D as he,A as pe,P as ye,ac as ge,G as we,M as L,T as me,g as xe,b1 as Pe,f as K,b2 as Me,s as ve,b3 as Se,b4 as Q,b5 as _,ad as be,Q as Te}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{S as Xe}from"./stats.min-DbzWzcqd.js";import{g as Ce}from"./lil-gui.module.min-BH_YJbPT.js";import{O as We}from"./OrbitControls-DEZHvbFX.js";import{I as N,N as $,a as Ye,M as Ee}from"./MeshBVH-DQV6PBDm.js";import{B as Be}from"./BVHHelper-DA_xcAFF.js";import"./_commonjsHelpers-CqkleIqs.js";class R{constructor(){this.dragging=!1}handlePointerDown(){this.dragging=!0}handlePointerUp(){this.dragging=!1}handlePointerMove(){}get points(){return[]}static normalizePoint(e,r,s){const i=e.getBoundingClientRect(),o=(r-i.left)/i.width,a=(s-i.top)/i.height;return[o*2-1,1-a*2]}}const A=new J,U=new J,V=new J;class ie extends R{constructor(){super(),this.lassoPoints=[],this.prevX=-1/0,this.prevY=-1/0}handlePointerDown(e){super.handlePointerDown(),this.prevX=e.clientX,this.prevY=e.clientY,this.lassoPoints=[]}handlePointerMove(e){const r=e.clientX,s=e.clientY,[i,o]=R.normalizePoint(e.currentTarget,r,s);if(Math.abs(r-this.prevX)>=3||Math.abs(s-this.prevY)>=3){const n=(this.lassoPoints.length/3-1)*3;let c=!1;return this.lassoPoints.length>3&&(A.set(this.lassoPoints[n-3],this.lassoPoints[n-3+1]),U.set(this.lassoPoints[n],this.lassoPoints[n+1]),U.sub(A).normalize(),A.set(this.lassoPoints[n],this.lassoPoints[n+1]),V.set(i,o),V.sub(A).normalize(),c=U.dot(V)>.99),c?(this.lassoPoints[n]=i,this.lassoPoints[n+1]=o):this.lassoPoints.push(i,o,0),this.prevX=r,this.prevY=s,{changed:!0}}return{changed:!1}}get points(){return this.lassoPoints}}class De extends R{constructor(){super(),this.startX=0,this.startY=0,this.currentX=0,this.currentY=0}handlePointerDown(e){super.handlePointerDown(),this.prevX=e.clientX,this.prevY=e.clientY;const[r,s]=R.normalizePoint(e.currentTarget,e.clientX,e.clientY);this.startX=r,this.startY=s,this.lassoPoints=[]}handlePointerMove(e){const r=e.clientX,s=e.clientY,[i,o]=R.normalizePoint(e.currentTarget,e.clientX,e.clientY);return this.currentX=i,this.currentY=o,r===this.prevX&&s===this.prevY?{changed:!1}:(this.prevX=r,this.prevY=s,{changed:!0})}get points(){return[[this.startX,this.startY,0],[this.currentX,this.startY,0],[this.currentX,this.currentY,0],[this.startX,this.currentY,0]].flat()}}function Re(t){function e(l,d,f){const m=(d.y-l.y)*(f.x-d.x)-(d.x-l.x)*(f.y-d.y);return m==0?0:m>0?1:2}function r(l,d){return(l.x-d.x)*(l.x-d.x)+(l.y-d.y)*(l.y-d.y)}function s(l,d){const f=e(a,l,d);return f==0?r(a,d)>=r(a,l)?-1:1:f==2?-1:1}let i=1/0,o=-1;for(let l=0,d=t.length;l<d;l++){const f=t[l];f.y<i&&(o=l,i=f.y)}const a=t[o];t[o]=t[0],t[0]=a,t=t.sort(s);let n=1;const c=t.length;for(let l=1;l<c;l++){for(;l<c-1&&e(a,t[l],t[l+1])==0;)l++;t[n]=t[l],n++}if(n<3)return null;const u=[t[0],t[1],t[2]];for(let l=3;l<n;l++){for(;e(u[u.length-2],u[u.length-1],t[l])!==2;)u.pop();u.push(t[l])}return u}function Z(t,e){function r(n,c,u){return(u.y-n.y)*(c.x-n.x)>(c.y-n.y)*(u.x-n.x)}const s=t.start,i=t.end,o=e.start,a=e.end;return r(s,o,a)!==r(i,o,a)&&r(s,i,o)!==r(s,i,a)}function z(t,e){return Ie(t,e)%2===1}function Ie(t,e){let r=0;const s=e[e.length-1];let i=s.start.y>s.end.y;for(let o=0,a=e.length;o<a;o++){const n=e[o],c=n.start.y>n.end.y;Le(t,n,i,c)&&r++,i=c}return r}function Le(t,e,r,s){const{start:i,end:o}=e,a=t.x,n=t.y,c=i.y,u=o.y;if(c===u||n>c&&n>u||n<c&&n<u)return!1;const l=i.x,d=o.x;if(a>l&&a>d)return!1;if(a<l&&a<d)return!(n===c&&r!==s);const f=d-l,x=u-c,W=-f,P=a-l,Y=n-c,v=x*P+W*Y;return Math.sign(v)!==Math.sign(x)}function Ae(t,e,r,s){O.copy(t.matrixWorld).premultiply(e.matrixWorldInverse).premultiply(e.projectionMatrix),q.copy(t.matrixWorld).invert(),ee.set(0,0,0).applyMatrix4(e.matrixWorld).applyMatrix4(q);const i=F(Ne(r.points)),o=[],a=[];return t.geometry.boundsTree.shapecast({intersectsBounds:(n,c,u,l)=>{if(!s.useBoundsTree)return N;const d=He(n,ze).map(p=>p.applyMatrix4(O));let f=1/0,m=-1/0,x=1/0;for(const p of d)p.y<f&&(f=p.y),p.y>m&&(m=p.y),p.x<x&&(x=p.x);const P=(o[l-1]||i).filter(p=>Oe(p,x,f,m));if(o[l]=P,P.length===0)return $;const Y=Re(d),v=F(Y,oe);if(z(P[0].start,v))return N;for(const p of v)for(const le of P)if(Z(p,le))return N;return z(Y[0],P)?Ye:$},intersectsTriangle:(n,c,u,l)=>{const d=c*3,f=d+0,m=d+1,x=d+2,W=s.useBoundsTree?o[l]:i;if(s.selectionMode==="centroid"||s.selectionMode==="centroid-visible"){if(H.copy(n.a).add(n.b).add(n.c).multiplyScalar(1/3),te.copy(H).applyMatrix4(O),u||z(te,W))return s.selectionMode==="centroid-visible"&&(n.getNormal(ne),G.origin.copy(H).addScaledVector(ne,1e-6),G.direction.subVectors(ee,H),t.geometry.boundsTree.raycastFirst(G,de))?!1:(a.push(f,m,x),s.selectWholeModel)}else if(s.selectionMode==="intersection"){if(u)return a.push(f,m,x),s.selectWholeModel;const P=[n.a,n.b,n.c].map(v=>v.applyMatrix4(O));for(const v of P)if(z(v,W))return a.push(f,m,x),s.selectWholeModel;const Y=F(P,oe);for(const v of Y)for(const p of W)if(Z(v,p))return a.push(f,m,x),s.selectWholeModel}return!1}}),a}const q=new se,ee=new E,G=new ce,H=new E,te=new E,ne=new E,O=new se,ze=new Array(8).fill().map(()=>new E),oe=new Array(12).fill().map(()=>new re);function He(t,e){const{min:r,max:s}=t;let i=0;for(let o=0;o<=1;o++)for(let a=0;a<=1;a++)for(let n=0;n<=1;n++){const c=e[i];c.x=o===0?r.x:s.x,c.y=a===0?r.y:s.y,c.z=n===0?r.z:s.z,i++}return e}function Oe(t,e,r,s){const i=t.start.x,o=t.start.y,a=t.end.x,n=t.end.y;return!(i<e&&a<e||o>s&&n>s||o<r&&n<r)}function F(t,e=null){return e===null&&(e=new Array(t.length).fill(null).map(()=>new re)),t.map((r,s)=>{const i=t[(s+1)%t.length],o=e[s];return o.start.copy(r),o.end.copy(i),o})}function Ne(t){const e=[];for(let r=0;r<t.length;r+=3)e.push(new E(t[r],t[r+1],t[r+2]));return e}const h={toolMode:"lasso",selectionMode:"intersection",liveUpdate:!1,selectWholeModel:!1,wireframe:!1,useBoundsTree:!0,displayBVH:!1,displayDepth:10,rotate:!0};let y,M,X,j,T,w,g,D,S,B,ae,C,k=!1,I=!1,b=new ie;Ue();function Ue(){ae=document.getElementById("output"),y=new ue({antialias:!0}),y.setPixelRatio(window.devicePixelRatio),y.setSize(window.innerWidth,window.innerHeight),y.setClearColor(2503224,1),y.setAnimationLoop(Ve),y.shadowMap.enabled=!0,document.body.appendChild(y.domElement),X=new fe;const e=new he(16777215,3);e.castShadow=!0,e.shadow.mapSize.set(2048,2048),e.position.set(10,10,10),X.add(e,new pe(11583173,2.5)),M=new ye(75,window.innerWidth/window.innerHeight,.1,100),M.position.set(2,4,6),X.add(M),w=new ge,w.material.color.set(16750592),w.renderOrder=1,w.position.z=-.2,w.depthTest=!1,w.scale.setScalar(1),M.add(w),C=new we,X.add(C),g=new L(new me(1.5,.5,500,60).toNonIndexed(),new xe({polygonOffset:!0,polygonOffsetFactor:1})),g.geometry.boundsTree=new Ee(g.geometry),g.geometry.setAttribute("color",new Pe(new Array(g.geometry.index.count*3).fill(255),3,!0)),g.castShadow=g.receiveShadow=!0,C.add(g),D=new Be(g,10),C.add(D),S=new L,S.geometry=g.geometry.clone(),S.geometry.drawRange.count=0,S.material=new K({opacity:.05,transparent:!0,depthWrite:!1,color:16750592}),S.renderOrder=1,C.add(S),B=new L,B.geometry=S.geometry,B.material=new K({opacity:.25,transparent:!0,wireframe:!0,depthWrite:!1,color:16750592}),B.renderOrder=2,C.add(B);const r=new Me(10,10,16777215,16777215);r.material.opacity=.2,r.material.transparent=!0,r.position.y=-2.75,X.add(r);const s=new L(new ve,new Se({color:0,opacity:.2,depthWrite:!1}));s.position.y=-2.74,s.rotation.x=-Math.PI/2,s.scale.setScalar(20),s.renderOrder=2,s.receiveShadow=!0,X.add(s),j=new Xe,document.body.appendChild(j.dom),T=new We(M,y.domElement),T.minDistance=3,T.touches.ONE=Q.PAN,T.mouseButtons.LEFT=_.PAN,T.touches.TWO=Q.ROTATE,T.mouseButtons.RIGHT=_.ROTATE,T.enablePan=!1;const i=new Ce,o=i.addFolder("Selection");o.add(h,"toolMode",["lasso","box"]).onChange(n=>{b=n==="box"?new De:new ie}),o.add(h,"selectionMode",["centroid","centroid-visible","intersection"]),o.add(h,"selectWholeModel"),o.add(h,"liveUpdate"),o.add(h,"useBoundsTree"),o.open();const a=i.addFolder("Display");a.add(h,"wireframe"),a.add(h,"rotate"),a.add(h,"displayBVH"),a.add(h,"displayDepth",1,30,1).onChange(n=>{D.depth=n,D.update()}),a.open(),i.open(),y.domElement.addEventListener("pointerdown",n=>{b.handlePointerDown(n)}),y.domElement.addEventListener("pointerup",()=>{b.handlePointerUp(),w.visible=!1,b.points.length&&(I=!0)}),y.domElement.addEventListener("pointermove",n=>{if((1&n.buttons)===0)return;const{changed:c}=b.handlePointerMove(n);c&&(k=!0,w.visible=!0,h.liveUpdate&&(I=!0))}),window.addEventListener("resize",()=>{M.aspect=window.innerWidth/window.innerHeight,M.updateProjectionMatrix(),y.setSize(window.innerWidth,window.innerHeight)})}function Ve(){j.update(),g.material.wireframe=h.wireframe,D.visible=h.displayBVH;const t=b.points;k&&(w.geometry.setAttribute("position",new be(t.concat(t.slice(0,3)),3,!1)),w.frustumCulled=!1,k=!1),I&&(I=!1,t.length>0&&Ge());const e=Math.tan(Te.DEG2RAD*M.fov/2)*w.position.z;w.scale.set(-e*M.aspect,-e,1),y.render(X,M),h.rotate&&(C.rotation.y+=.01,h.liveUpdate&&b.dragging&&(I=!0))}function Ge(){const t=window.performance.now(),e=Ae(g,M,b,h),r=window.performance.now()-t;ae.innerText=`${r.toFixed(3)}ms`;const s=g.geometry.index,i=S.geometry.index;if(e.length&&h.selectWholeModel){for(let o=0,a=s.count;o<a;o++){const n=s.getX(o);i.setX(o,n)}S.geometry.drawRange.count=1/0,i.needsUpdate=!0}else{for(let o=0,a=e.length;o<a;o++){const n=s.getX(e[o]);i.setX(o,n)}S.geometry.drawRange.count=e.length,i.needsUpdate=!0}}
//# sourceMappingURL=selection-DV96gD-D.js.map
