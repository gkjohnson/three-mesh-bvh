import{V as L,o as $,n as J,r as k,C as K,W as Q,p as _,c as ee,d as te,D as ae,q as ie,P as ne,M as T,s as re,f as E,Z as I,N as oe,t as se,i as le,B as de,u as pe,v as ce,w as me,g as fe,E as ue,x as we,I as O,y as he,z as Z,G as ye,b as Me,h as ge}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{G as xe}from"./GLTFLoader-Be-eETKy.js";import{M as Se}from"./meshopt_decoder.module-j6OW_3Rk.js";import{O as be}from"./OrbitControls-DEZHvbFX.js";import{S as Be}from"./stats.min-DbzWzcqd.js";import{g as Pe}from"./lil-gui.module.min-BH_YJbPT.js";import{M as We,a as ve}from"./MeshBVH-DQV6PBDm.js";import{B as Ce}from"./BVHHelper-DA_xcAFF.js";import"./BufferGeometryUtils-BuPYlHUL.js";import"./_commonjsHelpers-CqkleIqs.js";const a={useBVH:!0,displayBVH:!1,displayDepth:10,wireframeDisplay:!1,displayModel:!0,animate:!0,animation:"SPIN",invert:!1};let r,h,M,w,z,j,X,F,m,f,g,C,o,D,d,N=!1,Y=null,S=0;const l=new L,A=new L,G=new L,v=new L,c=new $,R=new J,b=new k;De();function De(){Y=document.getElementById("output");const B=new K(2503224).multiplyScalar(.1);r=new Q({antialias:!0,stencil:!0}),r.setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),r.setClearColor(B,1),r.setAnimationLoop(Fe),r.shadowMap.enabled=!0,r.shadowMap.type=_,r.localClippingEnabled=!0,document.body.appendChild(r.domElement),M=new ee,M.fog=new te(B,20,70);const u=new ae(16777215,2.5);u.position.set(1,1.5,2).multiplyScalar(50),M.add(u),M.add(new ie(16777215,2241348,1.5)),h=new ne(75,window.innerWidth/window.innerHeight,.01,50),h.position.set(.4,.4,.4),h.far=100,h.updateProjectionMatrix(),j=new be(h,r.domElement),X=new ge,D=[new k],o=new T(new re,new E({side:se,stencilWrite:!0,stencilFunc:oe,stencilFail:I,stencilZFail:I,stencilZPass:I})),o.scale.setScalar(1.5),o.material.color.set(8445674),o.renderOrder=2,M.add(o);const i=new le,p=new de(new Float32Array(3e5),3,!1);p.setUsage(pe),i.setAttribute("position",p),d=new ce(i,new me),d.material.color.set(44225),d.frustumCulled=!1,d.renderOrder=3;const P=new xe;P.setMeshoptDecoder(Se),P.load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/internal-combustion-engine/model.gltf",s=>{const t=s.scene.children[0],H=t.geometry;t.material=new E,t.position.set(0,0,0),t.quaternion.identity();const V=t.clone();V.material=new fe({depthFunc:ue}),V.renderOrder=1,d.scale.copy(t.scale),d.position.set(0,0,0),d.quaternion.identity(),t.updateMatrixWorld(!0);const U=new Set,y=new Map;g=t,g.updateMatrixWorld(!0),g.traverse(n=>{if(n.isMesh){if(y.has(n.material)){n.material=y.get(n.material);return}U.add(n.material);const e=n.material.clone();e.color.set(16777215),e.roughness=1,e.metalness=0,e.side=we,e.stencilWrite=!0,e.stencilFail=O,e.stencilZFail=O,e.stencilZPass=O,e.clippingPlanes=D,y.set(n.material,e),n.material=e}}),y.clear(),C=g.clone(),C.traverse(n=>{if(n.isMesh){if(y.has(n.material)){n.material=y.get(n.material);return}const e=n.material.clone();e.color.set(16777215),e.roughness=1,e.metalness=0,e.colorWrite=!1,e.depthWrite=!1,e.side=he,e.stencilWrite=!0,e.stencilFail=Z,e.stencilZFail=Z,e.stencilZPass=Z,e.clippingPlanes=D,y.set(n.material,e),n.material=e}}),F=new We(H,{maxLeafSize:3}),H.boundsTree=F,m=new T(H,new E({wireframe:!0,transparent:!0,opacity:.01,depthWrite:!1})),m.renderOrder=2,m.position.copy(t.position),m.rotation.copy(t.rotation),m.scale.copy(t.scale),f=new Ce(m,parseInt(a.displayDepth)),f.depth=parseInt(a.displayDepth),f.update();const W=new ye;W.add(g,C,V,m,f,d);const q=new Me;q.setFromObject(g),q.getCenter(W.position).multiplyScalar(-1),W.updateMatrixWorld(!0),M.add(W)}),w=new Pe,w.add(a,"invert"),w.add(a,"animate"),w.add(a,"animation",["SPIN","OSCILLATE"]).onChange(()=>{S=0}),w.add(a,"displayModel"),w.add(a,"useBVH");const x=w.addFolder("helper");x.add(a,"wireframeDisplay"),x.add(a,"displayBVH"),x.add(a,"displayDepth",1,20,1).onChange(s=>{f&&(f.depth=parseInt(s),f.update())}),x.open(),w.open(),z=new Be,document.body.appendChild(z.domElement),window.addEventListener("resize",function(){h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight),r.setPixelRatio(window.devicePixelRatio)},!1)}function Fe(){f&&(f.visible=a.displayBVH,m.visible=a.wireframeDisplay,g.visible=a.displayModel,C.visible=a.displayModel),d.material.color.set(a.displayModel?44225:5099745).convertSRGBToLinear();const B=Math.min(X.getDelta(),.03);a.animate&&(S+=B,a.animation==="SPIN"?(o.rotation.x=.25*S,o.rotation.y=.25*S,o.rotation.z=.25*S,o.position.set(0,0,0)):(o.position.set(Math.sin(.25*S)*.325,0,0),o.rotation.set(0,Math.PI/2,0)),o.updateMatrixWorld());const u=D[0];if(u.normal.set(0,0,a.invert?1:-1),u.constant=0,u.applyMatrix4(o.matrixWorld),F&&(a.animate||!N)){N=!0,R.copy(m.matrixWorld).invert(),b.copy(u).applyMatrix4(R);let i=0;const p=d.geometry.attributes.position,P=window.performance.now();F.shapecast({intersectsBounds:s=>a.useBVH?b.intersectsBox(s):ve,intersectsTriangle:s=>{let t=0;c.start.copy(s.a),c.end.copy(s.b),b.intersectLine(c,l)&&(p.setXYZ(i,l.x,l.y,l.z),i++,t++),c.start.copy(s.b),c.end.copy(s.c),b.intersectLine(c,l)&&(p.setXYZ(i,l.x,l.y,l.z),t++,i++),c.start.copy(s.c),c.end.copy(s.a),b.intersectLine(c,l)&&(p.setXYZ(i,l.x,l.y,l.z),t++,i++),t===3&&(A.fromBufferAttribute(p,i-3),G.fromBufferAttribute(p,i-2),v.fromBufferAttribute(p,i-1),v.equals(A)||v.equals(G)?(t--,i--):A.equals(G)&&(p.setXYZ(i-2,v),t--,i--)),t!==2&&(i-=t)}}),d.geometry.setDrawRange(0,i),d.position.copy(u.normal).multiplyScalar(-1e-5),p.needsUpdate=!0;const x=window.performance.now()-P;Y.innerText=`${parseFloat(x.toFixed(3))}ms`}z.update(),j.update(),r.render(M,h)}
//# sourceMappingURL=clippedEdges-BH11KMKp.js.map
