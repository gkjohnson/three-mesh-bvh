{"version":3,"file":"asyncGenerate-d3ebMxur.js","sources":["../../../src/workers/ParallelMeshBVHWorker.js","../../asyncGenerate.js"],"sourcesContent":["import { Box3, BufferAttribute } from 'three';\nimport { MeshBVH } from '../core/MeshBVH.js';\nimport { WorkerBase } from './utils/WorkerBase.js';\nimport { convertToBufferType, isSharedArrayBufferSupported } from '../utils/BufferUtils.js';\nimport { GenerateMeshBVHWorker } from './GenerateMeshBVHWorker.js';\nimport { ensureIndex } from '../core/build/geometryUtils.js';\n\nconst DEFAULT_WORKER_COUNT = typeof navigator !== 'undefined' ? navigator.hardwareConcurrency : 4;\nclass _ParallelMeshBVHWorker extends WorkerBase {\n\n\tconstructor() {\n\n\t\tconst worker = new Worker( new URL( './parallelMeshBVH.worker.js', import.meta.url ), { type: 'module' } );\n\t\tsuper( worker );\n\n\t\tthis.name = 'ParallelMeshBVHWorker';\n\t\tthis.maxWorkerCount = Math.max( DEFAULT_WORKER_COUNT, 4 );\n\n\t\tif ( ! isSharedArrayBufferSupported() ) {\n\n\t\t\tthrow new Error( 'ParallelMeshBVHWorker: Shared Array Buffers are not supported.' );\n\n\t\t}\n\n\t}\n\n\trunTask( worker, geometry, options = {} ) {\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tif ( ! options.indirect ) {\n\n\t\t\t\tensureIndex( geometry, options );\n\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tgeometry.getAttribute( 'position' ).isInterleavedBufferAttribute ||\n\t\t\t\tgeometry.index && geometry.index.isInterleavedBufferAttribute\n\t\t\t) {\n\n\t\t\t\tthrow new Error( 'ParallelMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.' );\n\n\t\t\t}\n\n\t\t\tworker.onerror = e => {\n\n\t\t\t\treject( new Error( `ParallelMeshBVHWorker: ${ e.message }` ) );\n\n\t\t\t};\n\n\t\t\tworker.onmessage = e => {\n\n\t\t\t\tconst { data } = e;\n\n\t\t\t\tif ( data.error ) {\n\n\t\t\t\t\treject( new Error( data.error ) );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( data.serialized ) {\n\n\t\t\t\t\tconst { serialized, position } = data;\n\t\t\t\t\tconst bvh = MeshBVH.deserialize( serialized, geometry, { setIndex: false } );\n\t\t\t\t\tconst boundsOptions = {\n\t\t\t\t\t\tsetBoundingBox: true,\n\t\t\t\t\t\t...options,\n\t\t\t\t\t};\n\n\t\t\t\t\t// we need to replace the arrays because they're neutered entirely by the\n\t\t\t\t\t// webworker transfer.\n\t\t\t\t\tgeometry.attributes.position.array = position;\n\t\t\t\t\tif ( serialized.index ) {\n\n\t\t\t\t\t\tif ( geometry.index ) {\n\n\t\t\t\t\t\t\tgeometry.index.array = serialized.index;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tconst newIndex = new BufferAttribute( serialized.index, 1, false );\n\t\t\t\t\t\t\tgeometry.setIndex( newIndex );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boundsOptions.setBoundingBox ) {\n\n\t\t\t\t\t\tgeometry.boundingBox = bvh.getBoundingBox( new Box3() );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( options.onProgress ) {\n\n\t\t\t\t\t\toptions.onProgress( data.progress );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( bvh );\n\t\t\t\t\tworker.onmessage = null;\n\n\t\t\t\t} else if ( options.onProgress ) {\n\n\t\t\t\t\toptions.onProgress( data.progress );\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tconst index = geometry.index ? geometry.index.array : null;\n\t\t\tconst position = geometry.attributes.position.array;\n\t\t\tworker.postMessage( {\n\n\t\t\t\toperation: 'BUILD_BVH',\n\t\t\t\tmaxWorkerCount: this.maxWorkerCount,\n\t\t\t\tindex: convertToBufferType( index, SharedArrayBuffer ),\n\t\t\t\tposition: convertToBufferType( position, SharedArrayBuffer ),\n\t\t\t\toptions: {\n\t\t\t\t\t...options,\n\t\t\t\t\tonProgress: null,\n\t\t\t\t\tincludedProgressCallback: Boolean( options.onProgress ),\n\t\t\t\t\tgroups: [ ...geometry.groups ],\n\t\t\t\t},\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\nexport class ParallelMeshBVHWorker {\n\n\tconstructor() {\n\n\t\tif ( isSharedArrayBufferSupported() ) {\n\n\t\t\treturn new _ParallelMeshBVHWorker();\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'ParallelMeshBVHWorker: SharedArrayBuffers not supported. Falling back to single-threaded GenerateMeshBVHWorker.' );\n\n\t\t\tconst object = new GenerateMeshBVHWorker();\n\t\t\tobject.maxWorkerCount = DEFAULT_WORKER_COUNT;\n\t\t\treturn object;\n\n\t\t}\n\n\t}\n\n}\n","import * as THREE from 'three';\nimport Stats from 'stats.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { ParallelMeshBVHWorker } from 'three-mesh-bvh/worker';\nimport { AVERAGE, CENTER, MeshBVH, BVHHelper, SAH } from 'three-mesh-bvh';\n\n// Parallel BVH generation is only supported with SharedArrayBuffer\nconst sharedArrayBufferSupported = typeof SharedArrayBuffer !== 'undefined';\n\nconst params = {\n\n\tuseWebWorker: true,\n\tmaxWorkerCount: sharedArrayBufferSupported ? navigator.hardwareConcurrency : 1,\n\tstrategy: CENTER,\n\tindirect: false,\n\n\tuseGroups: false,\n\tradius: 1,\n\ttube: 0.3,\n\ttubularSegments: 500,\n\tradialSegments: 500,\n\tp: 3,\n\tq: 5,\n\n\tdisplayBVH: false,\n\tdisplayDepth: 10,\n\n};\n\nlet renderer, camera, scene, knot, clock, gui, helper, group, stats;\nlet outputContainer, loadContainer, loadBar, loadText;\nlet bvhGenerationWorker;\nlet generating = false;\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0xffca28;\n\n\toutputContainer = document.getElementById( 'output' );\n\tloadContainer = document.getElementById( 'loading-container' );\n\tloadBar = document.querySelector( '#loading-container .bar' );\n\tloadText = document.querySelector( '#loading-container .text' );\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( 0xffca28, 20, 60 );\n\n\tconst light = new THREE.DirectionalLight( 0xffffff, 3 );\n\tlight.position.set( 1, 1, 1 );\n\tscene.add( light );\n\tscene.add( new THREE.AmbientLight( 0xb0bec5, 2.5 ) );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 0, 0, 4 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\tclock = new THREE.Clock();\n\n\t// stats setup\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\tgroup = new THREE.Group();\n\tscene.add( group );\n\n\tfor ( let i = 0; i < 400; i ++ ) {\n\n\t\tconst sphere = new THREE.Mesh(\n\t\t\tnew THREE.SphereGeometry( 1, 32, 32 ),\n\t\t\tnew THREE.MeshBasicMaterial()\n\t\t);\n\t\tsphere.position.set(\n\t\t\tMath.random() - 0.5,\n\t\t\tMath.random() - 0.5,\n\t\t\tMath.random() - 0.5\n\t\t).multiplyScalar( 70 );\n\t\tsphere.scale.setScalar( Math.random() * 0.3 + 0.1 );\n\t\tgroup.add( sphere );\n\n\t}\n\n\tbvhGenerationWorker = new ParallelMeshBVHWorker();\n\twindow.WORKER = bvhGenerationWorker;\n\n\tgui = new GUI();\n\tconst helperFolder = gui.addFolder( 'helper' );\n\thelperFolder.add( params, 'displayBVH' ).name( 'enabled' ).onChange( v => {\n\n\t\tif ( v && helper ) {\n\n\t\t\thelper.update();\n\n\t\t}\n\n\t} );\n\thelperFolder.add( params, 'displayDepth', 1, 50, 1 ).onChange( v => {\n\n\t\tif ( helper ) {\n\n\t\t\thelper.depth = v;\n\t\t\thelper.update();\n\n\t\t}\n\n\t} );\n\thelperFolder.open();\n\n\tconst knotFolder = gui.addFolder( 'knot' );\n\tknotFolder.add( params, 'useGroups' );\n\tknotFolder.add( params, 'radius', 0.5, 2, 0.01 );\n\tknotFolder.add( params, 'tube', 0.2, 1.2, 0.01 );\n\tknotFolder.add( params, 'tubularSegments', 50, 2000, 1 );\n\tknotFolder.add( params, 'radialSegments', 5, 2000, 1 );\n\tknotFolder.add( params, 'p', 1, 10, 1 );\n\tknotFolder.add( params, 'q', 1, 10, 1 );\n\tknotFolder.open();\n\n\tconst bvhFolder = gui.addFolder( 'bvh' );\n\tbvhFolder.add( params, 'useWebWorker' );\n\tbvhFolder.add( params, 'indirect' );\n\tbvhFolder.add( params, 'maxWorkerCount', 1, 16, 1 ).disable( ! sharedArrayBufferSupported );\n\tbvhFolder.add( params, 'strategy', { CENTER, AVERAGE, SAH } );\n\n\tgui.add( { regenerateKnot }, 'regenerateKnot' ).name( 'regenerate' );\n\n\tregenerateKnot();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n}\n\nfunction regenerateKnot() {\n\n\tif ( generating ) {\n\n\t\treturn;\n\n\t}\n\n\tgenerating = true;\n\n\tif ( knot ) {\n\n\t\tif ( Array.isArray( knot.material ) ) {\n\n\t\t\tknot.material.forEach( m => m.dispose() );\n\n\t\t} else {\n\n\t\t\tknot.material.dispose();\n\n\t\t}\n\n\t\tknot.geometry.dispose();\n\t\tgroup.remove( knot );\n\t\tgroup.remove( helper );\n\n\t}\n\n\tconst stallStartTime = window.performance.now();\n\tconst geomStartTime = window.performance.now();\n\n\t// Create geometry with multiple groups to test parallel worker offset handling\n\tlet material;\n\tconst geometry = new THREE.TorusKnotGeometry(\n\t\tparams.radius,\n\t\tparams.tube,\n\t\tparams.tubularSegments,\n\t\tparams.radialSegments,\n\t\tparams.p,\n\t\tparams.q\n\t);\n\n\n\tif ( params.useGroups ) {\n\n\t\tgeometry.clearGroups();\n\n\t\tconst triCount = geometry.index.count / 3;\n\t\tconst groupSize = Math.floor( triCount / 3 );\n\t\tgeometry.addGroup( 0, groupSize * 3, 0 );\n\t\tgeometry.addGroup( ( groupSize * 1 ) * 3, groupSize * 3, 1 );\n\t\tgeometry.addGroup( ( groupSize * 2 ) * 3, groupSize * 3, 2 );\n\n\t\tmaterial = [\n\t\t\tnew THREE.MeshStandardMaterial( { color: 0x4db6ac, roughness: 0.75 } ),\n\t\t\tnew THREE.MeshStandardMaterial( { color: 0xf06292, roughness: 0.75 } ),\n\t\t\tnew THREE.MeshStandardMaterial( { color: 0x64b5f6, roughness: 0.75 } )\n\t\t];\n\n\t} else {\n\n\t\tmaterial = new THREE.MeshStandardMaterial( {\n\t\t\tcolor: new THREE.Color( 0x4db6ac ),\n\t\t\troughness: 0.75\n\t\t} );\n\n\t}\n\n\n\tknot = new THREE.Mesh( geometry, material );\n\n\tconst geomTime = window.performance.now() - geomStartTime;\n\tconst startTime = window.performance.now();\n\tconst options = { strategy: params.strategy, indirect: params.indirect };\n\tlet totalStallTime;\n\tif ( params.useWebWorker ) {\n\n\t\tconst onProgress = v => {\n\n\t\t\tconst perc = ( v * 100 ).toFixed( 0 );\n\t\t\tloadContainer.style.visibility = 'visible';\n\t\t\tloadBar.style.width = `${ perc }%`;\n\t\t\tloadText.innerText = `${ perc }%`;\n\n\t\t};\n\n\t\tbvhGenerationWorker.maxWorkerCount = params.maxWorkerCount;\n\t\tbvhGenerationWorker.generate( knot.geometry, { onProgress, ...options } ).then( bvh => {\n\n\t\t\tloadContainer.style.visibility = 'hidden';\n\n\t\t\tknot.geometry.boundsTree = bvh;\n\t\t\tgroup.add( knot );\n\n\t\t\tconst deltaTime = window.performance.now() - startTime;\n\t\t\tgenerating = false;\n\n\t\t\thelper = new BVHHelper( knot, 0 );\n\t\t\thelper.depth = params.displayDepth;\n\n\t\t\tif ( params.displayBVH ) {\n\n\t\t\t\thelper.update();\n\n\t\t\t}\n\n\t\t\tgroup.add( helper );\n\n\t\t\toutputContainer.textContent =\n\t\t\t\t`Geometry Generation Time  : ${ geomTime.toFixed( 3 ) }ms\\n` +\n\t\t\t\t`BVH Generation Time       : ${ deltaTime.toFixed( 3 ) }ms\\n` +\n\t\t\t\t`Frame Stall Time          : ${ totalStallTime.toFixed( 3 ) }\\n` +\n\t\t\t\t`SharedArrayBuffer Support : ${ sharedArrayBufferSupported }`;\n\n\t\t} );\n\n\t\ttotalStallTime = window.performance.now() - stallStartTime;\n\n\t} else {\n\n\t\tknot.geometry.boundsTree = new MeshBVH( knot.geometry, options );\n\t\ttotalStallTime = window.performance.now() - stallStartTime;\n\n\t\tgroup.add( knot );\n\n\t\tconst deltaTime = window.performance.now() - startTime;\n\t\tgenerating = false;\n\n\t\thelper = new BVHHelper( knot );\n\t\thelper.depth = params.displayDepth;\n\t\thelper.update();\n\t\tgroup.add( helper );\n\n\t\toutputContainer.textContent =\n\t\t\t`Geometry Generation Time  : ${ geomTime.toFixed( 3 ) }ms\\n` +\n\t\t\t`BVH Generation Time       : ${ deltaTime.toFixed( 3 ) }ms\\n` +\n\t\t\t`Frame Stall Time          : ${ totalStallTime.toFixed( 3 ) }`;\n\n\t}\n\n}\n\nfunction render() {\n\n\tstats.update();\n\n\tlet delta = clock.getDelta();\n\tgroup.rotation.x += 0.4 * delta;\n\tgroup.rotation.y += 0.6 * delta;\n\n\tif ( helper ) {\n\n\t\thelper.visible = params.displayBVH;\n\n\t}\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["DEFAULT_WORKER_COUNT","_ParallelMeshBVHWorker","WorkerBase","worker","isSharedArrayBufferSupported","geometry","options","resolve","reject","ensureIndex","e","data","serialized","position","bvh","MeshBVH","boundsOptions","newIndex","BufferAttribute","Box3","index","convertToBufferType","ParallelMeshBVHWorker","object","GenerateMeshBVHWorker","sharedArrayBufferSupported","params","CENTER","renderer","camera","scene","knot","clock","gui","helper","group","stats","outputContainer","loadContainer","loadBar","loadText","bvhGenerationWorker","generating","init","THREE.WebGLRenderer","render","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","THREE.AmbientLight","THREE.PerspectiveCamera","THREE.Clock","Stats","THREE.Group","i","sphere","THREE.Mesh","THREE.SphereGeometry","THREE.MeshBasicMaterial","GUI","helperFolder","v","knotFolder","bvhFolder","AVERAGE","SAH","regenerateKnot","m","stallStartTime","geomStartTime","material","THREE.TorusKnotGeometry","triCount","groupSize","THREE.MeshStandardMaterial","THREE.Color","geomTime","startTime","totalStallTime","onProgress","perc","deltaTime","BVHHelper","delta"],"mappings":"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"}