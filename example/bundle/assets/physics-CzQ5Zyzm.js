import{K as Y,V as P,W as J,p as K,c as U,d as N,D as Q,q as Z,P as _,k as $,J as ee,az as T,M as G,C as k,e as te,g as oe,h as ae,aL as ie,f as ne}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{G as se}from"./GLTFLoader-Be-eETKy.js";import{O as re}from"./OrbitControls-DEZHvbFX.js";import{S as de}from"./stats.min-DbzWzcqd.js";import{g as ce}from"./lil-gui.module.min-BH_YJbPT.js";import{S as le}from"./StaticGeometryGenerator-QNaaaoUl.js";import{M as pe}from"./MeshBVH-DQV6PBDm.js";import{B as he}from"./BVHHelper-DA_xcAFF.js";import"./BufferGeometryUtils-BuPYlHUL.js";import"./_commonjsHelpers-CqkleIqs.js";const d={displayCollider:!1,displayBVH:!1,displayParents:!1,displayDepth:10,gravity:-9.8,physicsSteps:5,simulationSpeed:1,sphereSize:1,pause:!1,step:()=>{const o=d.physicsSteps;for(let n=0;n<o;n++)j(.016/o)},explode:()=>{const o=new P;f.forEach(n=>{o.copy(n.position),o.y+=10,o.normalize(),n.velocity.addScaledVector(o,120)})},reset:()=>{f.forEach(o=>{o.material.dispose(),o.geometry.dispose(),u.remove(o)}),f.length=0,b.forEach(o=>{o.material.dispose(),o.geometry.dispose(),u.remove(o)}),b.length=0}};let l,g,u,O,F,S,w,C;const f=[],b=[],p=new Y,r=new P,E=new P,me=new P(0,0,1);we();function we(){l=new J({antialias:!0}),l.setPixelRatio(window.devicePixelRatio),l.setSize(window.innerWidth,window.innerHeight),l.setClearColor(1250841,1),l.setAnimationLoop(ye),l.shadowMap.enabled=!0,l.shadowMap.type=K,l.outputEncoding=void 0,document.body.appendChild(l.domElement),u=new U,u.fog=new N(1250841,30,70);const n=new Q(11193599,1.5);n.position.set(50,75,50);const e=n.shadow.camera;e.left=e.bottom=-10,e.top=e.right=10,u.add(n,new Z(9290239,6716557,1.2)),g=new _(75,window.innerWidth/window.innerHeight,.1,100),g.position.set(10,10,-10),O=new ae,new re(g,l.domElement),F=new de,document.body.appendChild(F.dom),fe();const a=new ce,t=a.addFolder("Visualization");t.add(d,"displayCollider"),t.add(d,"displayBVH"),t.add(d,"displayParents").onChange(c=>{C.displayParents=c,C.update()}),t.add(d,"displayDepth",1,20,1).onChange(c=>{C.depth=c,C.update()}),t.open();const i=a.addFolder("Physics");i.add(d,"physicsSteps",0,30,1),i.add(d,"gravity",-100,100,.01),i.add(d,"simulationSpeed",0,5,.01),i.add(d,"sphereSize",.2,5,.1),i.add(d,"pause"),i.add(d,"step"),i.open(),a.add(d,"explode"),a.add(d,"reset"),a.open();const h=new $,s=new ee;let m=0,y=0;l.domElement.addEventListener("pointerdown",c=>{m=c.clientX,y=c.clientY}),l.domElement.addEventListener("pointerup",c=>{if(Math.abs(c.clientX-m)+Math.abs(c.clientY-y)>2)return;s.x=c.clientX/window.innerWidth*2-1,s.y=-(c.clientY/window.innerHeight)*2+1,h.setFromCamera(s,g);const L=X();L.position.copy(g.position).addScaledVector(h.ray.direction,3),L.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).addScaledVector(h.ray.direction,10*Math.random()+15).multiplyScalar(.5)}),window.addEventListener("resize",()=>{g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),l.setSize(window.innerWidth,window.innerHeight)}),window.createSphere=X}function fe(){new se().load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/low-poly-jungle-scene/scene.gltf",o=>{S=o.scene,S.scale.setScalar(.05);const n=new T(65535,9,7);n.position.set(-100,-40,100),S.add(n);const e=new T(16768358,5,15);e.position.set(80,80,135),e.shadow.normalBias=.01,e.shadow.bias=-.001,e.shadow.mapSize.setScalar(1024),e.castShadow=!0,S.add(e),S.updateMatrixWorld(!0);const a=new le(S);a.attributes=["position"];const t=a.generate();t.boundsTree=new pe(t),w=new G(t),w.material.wireframe=!0,w.material.opacity=.5,w.material.transparent=!0,C=new he(w,d.displayDepth),u.add(C,w,S),S.traverse(i=>{i.material&&(i.castShadow=i.receiveShadow=!0,i.material.shadowSide=2)})})}function I(o,n,e,a,t,i=0){if(t<Math.max(Math.abs(.04*d.gravity),5))return;const h=Math.max(n?Math.max(o.collider.radius,n.collider.radius):o.collider.radius,.4)*2,s=new G(new ie(0,1,30),new ne({side:2,transparent:!0,depthWrite:!1}));s.lifetime=0,s.maxLifetime=.4,s.maxScale=h*Math.max(Math.sin(Math.min(t/200,1)*Math.PI/2),.35),s.position.copy(e).addScaledVector(a,i),s.quaternion.setFromUnitVectors(me,a),u.add(s),b.push(s)}function X(){const o=new k(16777215),n=new k(1250841).lerp(o,Math.random()*.5+.5),e=new G(new te(1,20,20),new oe({color:n}));u.add(e),e.castShadow=e.receiveShadow=!0,e.material.shadowSide=2;const a=.5*d.sphereSize*(Math.random()*.2+.6);return e.scale.setScalar(a),e.collider=new Y(e.position,a),e.velocity=new P(0,0,0),e.mass=Math.pow(a,3)*Math.PI*4/3,f.push(e),e}function ue(o){const n=w.geometry.boundsTree;for(let e=0,a=f.length;e<a;e++){const t=f[e],i=t.collider;if(t.velocity.y+=d.gravity*o,i.center.addScaledVector(t.velocity,o),i.center.y<-80){f.splice(e,1),e--,a--,t.material.dispose(),t.geometry.dispose(),u.remove(t);continue}p.copy(t.collider);let h=!1;if(n.shapecast({intersectsBounds:s=>s.intersectsSphere(p),intersectsTriangle:s=>{s.closestPointToPoint(p.center,r),r.sub(p.center);const m=r.length();if(m<p.radius){const y=p.radius,c=m-y;r.multiplyScalar(1/m),p.center.addScaledVector(r,c),h=!0}},boundsTraverseOrder:s=>s.distanceToPoint(p.center)-p.radius}),h){r.subVectors(p.center,i.center).normalize(),t.velocity.reflect(r);const s=t.velocity.dot(r);t.velocity.addScaledVector(r,-s*.5),t.velocity.multiplyScalar(Math.max(1-o,0)),i.center.copy(p.center),E.copy(p.center).addScaledVector(r,-p.radius),I(t,null,E,r,s,.05)}}for(let e=0,a=f.length;e<a;e++){const t=f[e],i=t.collider;for(let h=e+1;h<a;h++){const s=f[h],m=s.collider;r.subVectors(i.center,m.center);const y=r.length()-(i.radius+m.radius);if(y<0){r.normalize();const c=t.velocity.dot(r),B=s.velocity.dot(r),L=Math.max(c,.2),W=Math.max(B,.2),R=L+W,q=L/R,A=W/R;i.center.addScaledVector(r,-q*y),m.center.addScaledVector(r,A*y);const v=new P;v.addScaledVector(r,-c).addScaledVector(r,B);const M=v.length(),V=t.mass,x=s.mass;let z,H;const D=.5;v.dot(t.velocity)>v.dot(s.velocity)?(z=D*M*(V-x)/(V+x),H=D*M*2*V/(V+x),z-=M):(z=D*M*2*x/(V+x),H=D*M*(x-V)/(V+x),H-=M),v.normalize(),t.velocity.addScaledVector(v,z),s.velocity.addScaledVector(v,H),E.copy(i.center).addScaledVector(r,-i.radius),I(t,s,E,r,M,0)}}t.position.copy(i.center)}}function j(o){if(w){const n=d.physicsSteps;for(let e=0;e<n;e++)ue(o/n)}for(let n=0,e=b.length;n<e;n++){const a=b[n];a.lifetime+=o;const t=a.lifetime/a.maxLifetime;let i=Math.sin(t*4.5*Math.PI/4);i=1-Math.pow(1-i,2),a.scale.setScalar(i*a.maxScale),a.material.opacity=1-Math.sin(t*2*Math.PI/4),t>=1&&(b.splice(n,1),a.parent.remove(a),a.geometry.dispose(),a.material.dispose(),n--,e--)}}function ye(){F.update();const o=Math.min(O.getDelta(),.1);w&&(w.visible=d.displayCollider,C.visible=d.displayBVH,d.pause||j(d.simulationSpeed*o)),l.render(u,g)}
//# sourceMappingURL=physics-CzQ5Zyzm.js.map
