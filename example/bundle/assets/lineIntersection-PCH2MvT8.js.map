{"version":3,"file":"lineIntersection-PCH2MvT8.js","sources":["../../../src/core/LineBVH.js","../../lineIntersection.js"],"sourcesContent":["import { Matrix4, Line3, Vector3, Ray, Box3 } from 'three';\nimport { PrimitivePool } from '../utils/PrimitivePool.js';\nimport { INTERSECTED, NOT_INTERSECTED } from './Constants.js';\nimport { GeometryBVH } from './GeometryBVH.js';\n\nconst _inverseMatrix = /* @__PURE__ */ new Matrix4();\nconst _ray = /* @__PURE__ */ new Ray();\nconst _linePool = /* @__PURE__ */ new PrimitivePool( () => new Line3() );\nconst _intersectPointOnRay = /*@__PURE__*/ new Vector3();\nconst _intersectPointOnSegment = /*@__PURE__*/ new Vector3();\nconst _box = /* @__PURE__ */ new Box3();\nconst _getters = [ 'getX', 'getY', 'getZ' ];\n\nexport class LineSegmentsBVH extends GeometryBVH {\n\n\tget primitiveStride() {\n\n\t\treturn 2;\n\n\t}\n\n\twritePrimitiveBounds( i, targetBuffer, baseIndex ) {\n\n\t\tconst indirectBuffer = this._indirectBuffer;\n\t\tconst { geometry, primitiveStride } = this;\n\n\t\tconst posAttr = geometry.attributes.position;\n\t\tconst indexAttr = geometry.index;\n\n\t\t// TODO: this may not be right for a LineLoop with a limited draw range / groups\n\t\tconst vertCount = indexAttr ? indexAttr.count : posAttr.count;\n\n\t\tconst prim = indirectBuffer ? indirectBuffer[ i ] : i;\n\t\tlet i0 = prim * primitiveStride;\n\t\tlet i1 = ( i0 + 1 ) % vertCount;\n\t\tif ( indexAttr ) {\n\n\t\t\ti0 = indexAttr.getX( i0 );\n\t\t\ti1 = indexAttr.getX( i1 );\n\n\t\t}\n\n\t\tfor ( let el = 0; el < 3; el ++ ) {\n\n\t\t\tconst v0 = posAttr[ _getters[ el ] ]( i0 );\n\t\t\tconst v1 = posAttr[ _getters[ el ] ]( i1 );\n\t\t\tconst min = v0 < v1 ? v0 : v1;\n\t\t\tconst max = v0 > v1 ? v0 : v1;\n\n\t\t\t// Write in min/max format [minx, miny, minz, maxx, maxy, maxz]\n\t\t\ttargetBuffer[ baseIndex + el ] = min;\n\t\t\ttargetBuffer[ baseIndex + el + 3 ] = max;\n\n\t\t}\n\n\t\treturn targetBuffer;\n\n\t}\n\n\tshapecast( callbacks ) {\n\n\t\tconst line = _linePool.getPrimitive();\n\t\tconst result = super.shapecast( {\n\t\t\t...callbacks,\n\t\t\tintersectsPrimitive: callbacks.intersectsLine,\n\t\t\tscratchPrimitive: line,\n\t\t\titerate: iterateOverLines,\n\t\t} );\n\t\t_linePool.releasePrimitive( line );\n\n\t\treturn result;\n\n\t}\n\n\traycastObject3D( object, raycaster, intersects = [] ) {\n\n\t\tconst { matrixWorld } = object;\n\t\tconst { firstHitOnly } = raycaster;\n\n\t\t_inverseMatrix.copy( matrixWorld ).invert();\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\n\n\t\tconst threshold = raycaster.params.Line.threshold;\n\t\tconst localThreshold = threshold / ( ( object.scale.x + object.scale.y + object.scale.z ) / 3 );\n\t\tconst localThresholdSq = localThreshold * localThreshold;\n\n\t\tlet closestHit = null;\n\t\tlet closestDistance = Infinity;\n\t\tthis.shapecast( {\n\t\t\tboundsTraverseOrder: box => {\n\n\t\t\t\treturn box.distanceToPoint( _ray.origin );\n\n\t\t\t},\n\t\t\tintersectsBounds: box => {\n\n\t\t\t\t// TODO: for some reason trying to early-out here is causing firstHitOnly tests to fail\n\t\t\t\t_box.copy( box ).expandByScalar( Math.abs( localThreshold ) );\n\t\t\t\treturn _ray.intersectsBox( _box ) ? INTERSECTED : NOT_INTERSECTED;\n\n\t\t\t},\n\t\t\tintersectsLine: ( line, index ) => {\n\n\t\t\t\tconst distSq = _ray.distanceSqToSegment( line.start, line.end, _intersectPointOnRay, _intersectPointOnSegment );\n\n\t\t\t\tif ( distSq > localThresholdSq ) return;\n\n\t\t\t\t_intersectPointOnRay.applyMatrix4( object.matrixWorld );\n\n\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( _intersectPointOnRay );\n\n\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) return;\n\n\t\t\t\tif ( firstHitOnly && distance >= closestDistance ) return;\n\t\t\t\tclosestDistance = distance;\n\n\t\t\t\tindex = this.resolvePrimitiveIndex( index );\n\n\t\t\t\tclosestHit = {\n\t\t\t\t\tdistance,\n\t\t\t\t\tpoint: _intersectPointOnSegment.clone().applyMatrix4( matrixWorld ),\n\t\t\t\t\tindex: index * this.primitiveStride,\n\t\t\t\t\tface: null,\n\t\t\t\t\tfaceIndex: null,\n\t\t\t\t\tbarycoord: null,\n\t\t\t\t\tobject,\n\t\t\t\t};\n\n\t\t\t\tif ( ! firstHitOnly ) {\n\n\t\t\t\t\tintersects.push( closestHit );\n\n\t\t\t\t}\n\n\t\t\t},\n\t\t} );\n\n\t\tif ( firstHitOnly && closestHit ) {\n\n\t\t\tintersects.push( closestHit );\n\n\t\t}\n\n\t\treturn intersects;\n\n\t}\n\n}\n\nexport class LineLoopBVH extends LineSegmentsBVH {\n\n\tget primitiveStride() {\n\n\t\treturn 1;\n\n\t}\n\n\tconstructor( geometry, options = {} ) {\n\n\t\t// \"Line\" and \"LineLoop\" BVH must be indirect since we cannot rearrange the index\n\t\t// buffer without breaking the lines\n\t\toptions = {\n\t\t\t...options,\n\t\t\tindirect: true,\n\t\t};\n\n\t\tsuper( geometry, options );\n\n\t}\n\n}\n\nexport class LineBVH extends LineLoopBVH {\n\n\tgetRootRanges( ...args ) {\n\n\t\tconst res = super.getRootRanges( ...args );\n\t\tres.forEach( group => group.count -- );\n\t\treturn res;\n\n\t}\n\n}\n\nfunction iterateOverLines(\n\toffset,\n\tcount,\n\tbvh,\n\tintersectsPointFunc,\n\tcontained,\n\tdepth,\n\tline\n) {\n\n\tconst { geometry, primitiveStride } = bvh;\n\tconst { index } = geometry;\n\tconst posAttr = geometry.attributes.position;\n\tconst vertCount = index ? index.count : posAttr.count;\n\n\tfor ( let i = offset, l = count + offset; i < l; i ++ ) {\n\n\t\tconst prim = bvh.resolvePrimitiveIndex( i );\n\t\tlet i0 = prim * primitiveStride;\n\t\tlet i1 = ( i0 + 1 ) % vertCount;\n\t\tif ( index ) {\n\n\t\t\ti0 = index.getX( i0 );\n\t\t\ti1 = index.getX( i1 );\n\n\t\t}\n\n\t\tline.start.fromBufferAttribute( posAttr, i0 );\n\t\tline.end.fromBufferAttribute( posAttr, i1 );\n\n\t\tif ( intersectsPointFunc( line, i, contained, depth ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t}\n\n\treturn false;\n\n}\n","import * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport Stats from 'three/examples/jsm/libs/stats.module.js';\nimport {\n\tacceleratedRaycast, computeBoundsTree, disposeBoundsTree, LineBVH, BVHHelper,\n\tSAH, CENTER, AVERAGE,\n} from 'three-mesh-bvh';\n\nTHREE.Line.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nconst params = {\n\tdisplayBVH: false,\n\tdisplayDepth: 10,\n\tdisplayParents: false,\n\n\tuseBVH: true,\n\tstrategy: 0,\n\tindirect: false,\n};\n\nlet renderer, camera, scene, controls, stats, outputContainer;\nlet line, helper;\nlet raycaster, mouse;\nlet sphereCollision;\n\ninit();\n\nfunction init() {\n\n\toutputContainer = document.getElementById( 'output' );\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( 0x131619 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 2, 1, 2 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\t// controls\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\n\t// raycaster\n\traycaster = new THREE.Raycaster();\n\traycaster.params.Line.threshold = 0.01;\n\tmouse = new THREE.Vector2();\n\n\t// collision sphere\n\tsphereCollision = new THREE.Mesh(\n\t\tnew THREE.SphereGeometry( 0.01, 16, 16 ),\n\t\tnew THREE.MeshBasicMaterial( { color: 0xff0000, transparent: true, opacity: 0.75 } )\n\t);\n\tsphereCollision.visible = false;\n\tscene.add( sphereCollision );\n\n\t// stats\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\t// generate initial geometry\n\tline = new THREE.Line( generateGeometry(), new THREE.LineBasicMaterial( {\n\t\tvertexColors: true,\n\t\tlinewidth: 2,\n\t} ) );\n\n\thelper = new BVHHelper( line, params.displayDepth );\n\n\tscene.add( line, helper );\n\n\tupdateBVH();\n\n\t// GUI\n\tconst gui = new GUI();\n\n\tconst helperFolder = gui.addFolder( 'helper' );\n\thelperFolder.add( params, 'displayBVH' );\n\thelperFolder.add( params, 'displayParents' ).onChange( v => {\n\n\t\thelper.displayParents = v;\n\t\thelper.update();\n\n\t} );\n\thelperFolder.add( params, 'displayDepth', 1, 25, 1 ).name( 'depth' ).onChange( v => {\n\n\t\thelper.depth = parseInt( v );\n\t\thelper.update();\n\n\t} );\n\thelperFolder.open();\n\n\tconst linesFolder = gui.addFolder( 'lines' );\n\tlinesFolder.add( params, 'useBVH' ).onChange( updateBVH );\n\tlinesFolder.add( params, 'strategy', { CENTER, AVERAGE, SAH } ).onChange( updateBVH );\n\tlinesFolder.add( params, 'indirect' ).onChange( updateBVH );\n\tlinesFolder.open();\n\n\twindow.addEventListener( 'resize', onWindowResize, false );\n\twindow.addEventListener( 'pointermove', onPointerMove, false );\n\n}\n\nfunction generateCurve( segments ) {\n\n\tconst points = [];\n\tconst norm = new THREE.Vector3();\n\tconst tangent = new THREE.Vector3();\n\tconst v0 = new THREE.Vector3();\n\tconst v1 = new THREE.Vector3();\n\n\tconst getSurfacePoint = ( t, target ) => {\n\n\t\t// Torus knot parameters\n\t\tconst p = 3; // number of times the knot winds around the torus longitudinally\n\t\tconst q = 10; // number of times the knot winds around the torus meridionally\n\t\tconst R = 1.0; // major radius\n\t\tconst r = 0.4; // minor radius (tube radius)\n\n\t\tconst theta = t * Math.PI * 2;\n\t\tconst phi = p * theta;\n\t\tconst psi = q * theta;\n\n\t\tconst x = ( R + r * Math.cos( psi ) ) * Math.cos( phi );\n\t\tconst y = ( R + r * Math.cos( psi ) ) * Math.sin( phi );\n\t\tconst z = r * Math.sin( psi );\n\n\t\ttarget.set( x, y, z );\n\n\t};\n\n\tfor ( let i = 0; i <= segments; i ++ ) {\n\n\t\tconst t0 = i / segments;\n\t\tconst t1 = t0 + 1e-4;\n\n\t\tgetSurfacePoint( t0, v0 );\n\t\tgetSurfacePoint( t1, v1 );\n\n\t\tnorm.copy( v0 ).normalize();\n\t\ttangent.subVectors( v1, v0 ).normalize();\n\n\t\tnorm.applyAxisAngle( tangent, 1000 * t0 * 2 * Math.PI );\n\n\t\tv0\n\t\t\t// .multiplyScalar( Math.sin( t0 * Math.PI ) )\n\t\t\t.addScaledVector( norm, 0.05 * ( Math.sin( 50 * t0 * Math.PI ) + 2 ) );\n\t\tpoints.push( v0.clone() );\n\n\t}\n\n\treturn points;\n\n}\n\nfunction generateGeometry() {\n\n\tconst positions = [];\n\tconst colors = [];\n\n\tconst points = generateCurve( 1e6 );\n\tconst color = new THREE.Color();\n\tfor ( let i = 0; i < points.length - 1; i ++ ) {\n\n\t\tconst p1 = points[ i ];\n\t\tconst t = i / ( points.length - 1 );\n\t\tcolor.setHSL( t * 3, 1.0, 0.6 );\n\n\t\tpositions.push( p1.x, p1.y, p1.z );\n\t\tcolors.push( color.r, color.g, color.b );\n\n\t}\n\n\n\tconst geometry = new THREE.BufferGeometry();\n\tgeometry.setAttribute( 'position', new THREE.Float32BufferAttribute( positions, 3 ) );\n\tgeometry.setAttribute( 'color', new THREE.Float32BufferAttribute( colors, 3 ) );\n\n\treturn geometry;\n\n}\n\nfunction updateBVH() {\n\n\tif ( params.useBVH ) {\n\n\t\tconsole.time( 'LineBVH' );\n\t\tline.geometry.computeBoundsTree( {\n\t\t\tstrategy: parseInt( params.strategy ),\n\t\t\tindirect: params.indirect,\n\t\t\ttype: LineBVH,\n\t\t} );\n\t\tconsole.timeEnd( 'LineBVH' );\n\n\t} else {\n\n\t\tline.geometry.disposeBoundsTree();\n\n\t}\n\n\thelper.update();\n\n}\n\nfunction updateRaycast() {\n\n\traycaster.setFromCamera( mouse, camera );\n\traycaster.firstHitOnly = true;\n\n\tconst startTime = window.performance.now();\n\tconst intersects = raycaster.intersectObject( line );\n\tconst delta = window.performance.now() - startTime;\n\n\tconst hit = intersects[ 0 ];\n\tif ( hit ) {\n\n\t\tsphereCollision.position.copy( hit.point );\n\t\tsphereCollision.visible = true;\n\n\t} else {\n\n\t\tsphereCollision.visible = false;\n\n\t}\n\n\toutputContainer.innerText = `${ delta.toFixed( 2 ) }ms`;\n\n}\n\nfunction onPointerMove( event ) {\n\n\tmouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;\n\tmouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;\n\n}\n\nfunction onWindowResize() {\n\n\tcamera.aspect = window.innerWidth / window.innerHeight;\n\tcamera.updateProjectionMatrix();\n\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n}\n\nfunction render() {\n\n\tif ( helper ) {\n\n\t\thelper.visible = params.displayBVH;\n\n\t}\n\n\tline.rotation.y = performance.now() * 1e-4;\n\n\tupdateRaycast();\n\n\trenderer.render( scene, camera );\n\n\tstats.update();\n\n}\n"],"names":["_inverseMatrix","Matrix4","_ray","Ray","_linePool","PrimitivePool","Line3","_intersectPointOnRay","Vector3","_intersectPointOnSegment","_box","Box3","_getters","LineSegmentsBVH","GeometryBVH","i","targetBuffer","baseIndex","indirectBuffer","geometry","primitiveStride","posAttr","indexAttr","vertCount","i0","i1","el","v0","v1","min","max","callbacks","line","result","iterateOverLines","object","raycaster","intersects","matrixWorld","firstHitOnly","localThreshold","localThresholdSq","closestHit","closestDistance","box","INTERSECTED","NOT_INTERSECTED","index","distance","LineLoopBVH","options","LineBVH","args","res","group","offset","count","bvh","intersectsPointFunc","contained","depth","l","THREE.Line","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","params","renderer","camera","scene","stats","outputContainer","helper","mouse","sphereCollision","init","THREE.WebGLRenderer","render","THREE.Scene","THREE.PerspectiveCamera","OrbitControls","THREE.Raycaster","THREE.Vector2","THREE.Mesh","THREE.SphereGeometry","THREE.MeshBasicMaterial","Stats","generateGeometry","THREE.LineBasicMaterial","BVHHelper","updateBVH","gui","GUI","helperFolder","v","linesFolder","CENTER","AVERAGE","SAH","onWindowResize","onPointerMove","generateCurve","segments","points","norm","THREE.Vector3","tangent","getSurfacePoint","t","target","theta","phi","psi","y","z","t0","t1","positions","colors","color","THREE.Color","p1","THREE.Float32BufferAttribute","updateRaycast","startTime","delta","hit","event"],"mappings":"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"}