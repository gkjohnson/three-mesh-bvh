import{M as g,i as D,j as T,k as q,e as H,l as N,O as R,W as K,c as J,d as Q,D as U,A as X,m as Y,P as Z,T as V,f as k,V as P}from"./ExtendedTriangle-hsPasuNU.js";import{S as _}from"./stats.min-DbzWzcqd.js";import{g as $}from"./lil-gui.module.min-BH_YJbPT.js";import{a as L,c as ee,d as te,b as oe,e as ne}from"./ExtensionUtilities-BlnM4xb7.js";import{C as O,A as se,S as ae}from"./MeshBVH-DQV6PBDm.js";import"./_commonjsHelpers-CqkleIqs.js";g.prototype.raycast=L;D.prototype.computeBoundsTree=ee;D.prototype.disposeBoundsTree=te;T.prototype.raycast=L;T.prototype.computeBoundsTree=oe;T.prototype.disposeBoundsTree=ne;const W=13621468,re=2503224,j=14162784;let c,m,b,u,v,i,t;const f=[],d=new q,F=new H(.25,20,20),ie=new N(.01,.01),p=23,e=new R,n={raycasters:{count:150,near:0,far:p},mesh:{splitStrategy:O,useBoundsTree:!0,indirect:!1}};de();l();function de(){c=new K({antialias:!0}),c.setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),c.setClearColor(W,1),c.setAnimationLoop(ue),document.body.appendChild(c.domElement),m=new J,m.fog=new Q(W,40,100);const o=new U(16777215,1.5);o.position.set(1,1,1),m.add(o),m.add(new X(16777215,1.2)),i=new R,v=new Y({color:re}),i.scale.multiplyScalar(10),i.rotation.x=10.989999999999943,i.rotation.y=10.989999999999943,m.add(i),ce(),u=new Z(60,window.innerWidth/window.innerHeight,.1,50),u.position.z=50,u.far=100,u.updateProjectionMatrix(),b=new _,document.body.appendChild(b.dom);const r=new $,s=r.addFolder("Raycasters");s.add(n.raycasters,"count").min(1).max(1e3).step(1).onChange(()=>l()),s.add(n.raycasters,"near").min(0).max(p).onChange(()=>l()),s.add(n.raycasters,"far").min(0).max(p).onChange(()=>l()),s.open();const a=r.addFolder("Mesh");a.add(n.mesh,"useBoundsTree").onChange(()=>l()),a.add(n.mesh,"indirect").onChange(()=>l()),a.add(n.mesh,"splitStrategy",{CENTER:O,SAH:ae,AVERAGE:se}).onChange(()=>l()),a.open(),window.addEventListener("resize",function(){u.aspect=window.innerWidth/window.innerHeight,u.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight)},!1)}function ce(){const r=new V(.5,.2,200,100,2,3),s=new V(.5,.2,200,100,3,4),a=new H(.5,100,100),h=r.attributes.position.count,B=s.attributes.position.count,S=a.attributes.position.count,A=h+B+S,x=r.index.count,M=s.index.count,C=a.index.count,G=x+M+C;t=new T(3,A,G,v);const E=t.addGeometry(r),y=t.addGeometry(s),w=t.addGeometry(a);t.addInstance(E),t.addInstance(y),t.addInstance(w),e.position.x=-1.5,e.updateMatrix(),t.setMatrixAt(0,e.matrix),e.position.x=0,e.updateMatrix(),t.setMatrixAt(1,e.matrix),e.position.x=1.5,e.updateMatrix(),t.setMatrixAt(2,e.matrix),t.rotation.x=Math.random()*10,t.rotation.y=Math.random()*10,i.add(t)}function me(){const o=window.performance.now();t.getMatrixAt(0,e.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.rotation.set(3e-4*o,3e-4*o,0),e.updateMatrix(),t.setMatrixAt(0,e.matrix),t.getMatrixAt(1,e.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.rotation.set(9e-4*o,9e-4*o,0),e.updateMatrix(),t.setMatrixAt(1,e.matrix),t.getMatrixAt(2,e.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale),e.rotation.set(5e-4*o,5e-4*o,0),e.updateMatrix(),t.setMatrixAt(2,e.matrix)}function pe(){const o=new R,r=new k({color:j}),s=new g(F,r),a=new g(F,r);a.scale.multiplyScalar(.25),s.scale.multiplyScalar(.5);const h=new g(ie,new k({color:j,transparent:!0,opacity:.5}));o.add(h),o.add(s),o.add(a),m.add(o),s.position.set(p,0,0);const B=Math.random()*10,S=Math.random()*10,A=Math.random()*10,x=new P,M=new P,C=Math.random()-.5,G=Math.random()-.5,E=Math.random()-.5;f.push({update:()=>{const y=window.performance.now();o.rotation.x=C*1e-4*y+B,o.rotation.y=G*1e-4*y+S,o.rotation.z=E*1e-4*y+A,s.updateMatrixWorld(),x.setFromMatrixPosition(s.matrixWorld),M.copy(x).multiplyScalar(-1).normalize(),d.set(x,M),d.firstHitOnly=!0;const w=d.intersectObject(i,!0),I=w.length?w[0].distance:p;a.position.set(p-I,0,0);const z=w.length?I-d.near:I-d.near-(p-d.far);h.position.set(p-d.near-z/2,0,0),h.scale.set(1,z,1),h.rotation.z=Math.PI/2},remove:()=>{m.remove(o)}})}function l(){for(d.near=n.raycasters.near,d.far=n.raycasters.far;f.length>n.raycasters.count;)f.pop().remove();for(;f.length<n.raycasters.count;)pe();t&&((!n.mesh.useBoundsTree&&t.boundsTrees||t.boundsTrees&&(n.mesh.splitStrategy!==t.boundsTrees.splitStrategy||n.mesh.indirect!==t.boundsTrees.indirect))&&(t.disposeBoundsTree(),t.boundsTrees=null),n.mesh.useBoundsTree&&!t.boundsTrees&&(console.time("computing bounds tree"),t.computeBoundsTree(-1,{maxLeafSize:5,strategy:parseFloat(n.mesh.splitStrategy),indirect:n.mesh.indirect}),t.boundsTrees.splitStrategy=n.mesh.splitStrategy,t.boundsTrees.indirect=n.mesh.indirect,console.timeEnd("computing bounds tree")))}function ue(){b.begin();const o=window.performance.now();i.rotation.x=1e-4*o,i.rotation.y=1e-4*o,i.updateMatrixWorld(),me(),f.forEach(r=>r.update()),c.render(m,u),b.end()}
//# sourceMappingURL=batchedMesh-B8lw-14Q.js.map
