{"version":3,"file":"collectTriangles-zpjj4Eqd.js","sources":["../../collectTriangles.js"],"sourcesContent":["import Stats from 'stats.js/src/Stats';\nimport * as dat from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { acceleratedRaycast, computeBoundsTree, disposeBoundsTree, CONTAINED, INTERSECTED, NOT_INTERSECTED } from 'three-mesh-bvh';\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nconst params = {\n\tsize: 0.1,\n\trotate: true,\n};\n\nlet stats;\nlet scene, camera, renderer, controls;\nlet targetMesh, brushMesh;\nlet mouse = new THREE.Vector2();\nlet mouseType = - 1, brushActive = false;\nlet lastTime;\n\nfunction init() {\n\n\tconst bgColor = 0x263238 / 2;\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\trenderer.domElement.style.touchAction = 'none';\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( 0x263238 / 2, 20, 60 );\n\n\tconst light = new THREE.DirectionalLight( 0xffffff, 1.5 );\n\tlight.position.set( 1, 1, 1 );\n\tscene.add( light );\n\tscene.add( new THREE.AmbientLight( 0xffffff, 1.2 ) );\n\n\t// geometry setup\n\tconst radius = 1;\n\tconst tube = 0.4;\n\tconst tubularSegments = 800;\n\tconst radialSegments = 400;\n\n\tconst knotGeometry = new THREE.TorusKnotGeometry( radius, tube, tubularSegments, radialSegments ).toNonIndexed();\n\tconst colorArray = new Uint8Array( knotGeometry.attributes.position.count * 3 );\n\tcolorArray.fill( 255 );\n\tconst colorAttr = new THREE.BufferAttribute( colorArray, 3, true );\n\tcolorAttr.setUsage( THREE.DynamicDrawUsage );\n\tknotGeometry.setAttribute( 'color', colorAttr );\n\n\tconst knotMaterial = new THREE.MeshStandardMaterial( { color: 0xffffff, roughness: 0.3, metalness: 0, vertexColors: true } );\n\ttargetMesh = new THREE.Mesh( knotGeometry, knotMaterial );\n\ttargetMesh.geometry.computeBoundsTree();\n\tscene.add( targetMesh );\n\n\tconst brushGeometry = new THREE.SphereGeometry( 1, 40, 40 );\n\tconst brushMaterial = new THREE.MeshStandardMaterial( {\n\t\tcolor: 0xEC407A,\n\t\troughness: 0.75,\n\t\tmetalness: 0,\n\t\ttransparent: true,\n\t\topacity: 0.5,\n\t\tpremultipliedAlpha: true,\n\t\temissive: 0xEC407A,\n\t\temissiveIntensity: 0.5,\n\t} );\n\n\tbrushMesh = new THREE.Mesh( brushGeometry, brushMaterial );\n\tscene.add( brushMesh );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 3, 3, 3 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\n\t// stats setup\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\tconst gui = new dat.GUI();\n\tgui.add( params, 'size' ).min( 0.1 ).max( 1 ).step( 0.1 );\n\tgui.add( params, 'rotate' );\n\tgui.open();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n\twindow.addEventListener( 'pointermove', function ( e ) {\n\n\t\tmouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;\n\t\tmouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;\n\t\tbrushActive = true;\n\n\t} );\n\n\twindow.addEventListener( 'pointerdown', function ( e ) {\n\n\t\tmouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;\n\t\tmouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;\n\t\tmouseType = e.button;\n\n\t\t// disable the controls early if we're over the object because on touch screens\n\t\t// we're not constantly tracking where the cursor is.\n\t\tconst raycaster = new THREE.Raycaster();\n\t\traycaster.setFromCamera( mouse, camera );\n\t\traycaster.firstHitOnly = true;\n\n\t\tconst res = raycaster.intersectObject( targetMesh, true );\n\t\tbrushActive = true;\n\t\tcontrols.enabled = res.length === 0;\n\n\t}, true );\n\n\twindow.addEventListener( 'pointerup', function ( e ) {\n\n\t\tmouseType = - 1;\n\t\tif ( e.pointerType === 'touch' ) {\n\n\t\t\t// disable the brush visualization when the pointer action is done only\n\t\t\t// if it's on a touch device.\n\t\t\tbrushActive = false;\n\n\t\t}\n\n\t}, true );\n\n\twindow.addEventListener( 'contextmenu', function ( e ) {\n\n\t\te.preventDefault();\n\n\t} );\n\n\twindow.addEventListener( 'wheel', function ( e ) {\n\n\t\tlet delta = e.deltaY;\n\n\t\tif ( e.deltaMode === 1 ) {\n\n\t\t\tdelta *= 40;\n\n\t\t}\n\n\t\tif ( e.deltaMode === 2 ) {\n\n\t\t\tdelta *= 40;\n\n\t\t}\n\n\t\tparams.size += delta * 0.0005;\n\t\tparams.size = Math.max( Math.min( params.size, 1 ), 0.1 );\n\n\t\tgui.controllersRecursive().forEach( c => c.updateDisplay() );\n\n\t} );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\n\tcontrols.addEventListener( 'start', function () {\n\n\t\tthis.active = true;\n\n\t} );\n\n\tcontrols.addEventListener( 'end', function () {\n\n\t\tthis.active = false;\n\n\t} );\n\n\tlastTime = window.performance.now();\n\n}\n\nfunction render() {\n\n\tstats.begin();\n\n\tconst geometry = targetMesh.geometry;\n\tconst bvh = geometry.boundsTree;\n\tconst colorAttr = geometry.getAttribute( 'color' );\n\tconst indexAttr = geometry.index;\n\n\tif ( controls.active || ! brushActive ) {\n\n\t\tbrushMesh.visible = false;\n\n\t} else {\n\n\t\tbrushMesh.scale.setScalar( params.size );\n\n\t\tconst raycaster = new THREE.Raycaster();\n\t\traycaster.setFromCamera( mouse, camera );\n\t\traycaster.firstHitOnly = true;\n\n\t\tconst res = raycaster.intersectObject( targetMesh, true );\n\t\tif ( res.length ) {\n\n\t\t\tbrushMesh.position.copy( res[ 0 ].point );\n\t\t\tcontrols.enabled = false;\n\t\t\tbrushMesh.visible = true;\n\n\t\t\tconst inverseMatrix = new THREE.Matrix4();\n\t\t\tinverseMatrix.copy( targetMesh.matrixWorld ).invert();\n\n\t\t\tconst sphere = new THREE.Sphere();\n\t\t\tsphere.center.copy( brushMesh.position ).applyMatrix4( inverseMatrix );\n\t\t\tsphere.radius = params.size;\n\n\t\t\tconst indices = [];\n\t\t\tconst tempVec = new THREE.Vector3();\n\t\t\tbvh.shapecast( {\n\n\t\t\t\tintersectsBounds: box => {\n\n\t\t\t\t\tconst intersects = sphere.intersectsBox( box );\n\t\t\t\t\tconst { min, max } = box;\n\t\t\t\t\tif ( intersects ) {\n\n\t\t\t\t\t\tfor ( let x = 0; x <= 1; x ++ ) {\n\n\t\t\t\t\t\t\tfor ( let y = 0; y <= 1; y ++ ) {\n\n\t\t\t\t\t\t\t\tfor ( let z = 0; z <= 1; z ++ ) {\n\n\t\t\t\t\t\t\t\t\ttempVec.set(\n\t\t\t\t\t\t\t\t\t\tx === 0 ? min.x : max.x,\n\t\t\t\t\t\t\t\t\t\ty === 0 ? min.y : max.y,\n\t\t\t\t\t\t\t\t\t\tz === 0 ? min.z : max.z\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\tif ( ! sphere.containsPoint( tempVec ) ) {\n\n\t\t\t\t\t\t\t\t\t\treturn INTERSECTED;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn CONTAINED;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn intersects ? INTERSECTED : NOT_INTERSECTED;\n\n\t\t\t\t},\n\n\t\t\t\tintersectsTriangle: ( tri, i, contained ) => {\n\n\t\t\t\t\tif ( contained || tri.intersectsSphere( sphere ) ) {\n\n\t\t\t\t\t\tconst i3 = 3 * i;\n\t\t\t\t\t\tindices.push( i3, i3 + 1, i3 + 2 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tif ( mouseType === 0 || mouseType === 2 ) {\n\n\t\t\t\tlet r = 1, g = 1, b = 1;\n\t\t\t\tif ( mouseType === 0 ) {\n\n\t\t\t\t\tr = 15 / 255;\n\t\t\t\t\tg = 78 / 255;\n\t\t\t\t\tb = 85 / 255;\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 0, l = indices.length; i < l; i ++ ) {\n\n\t\t\t\t\tconst i2 = indexAttr.getX( indices[ i ] );\n\t\t\t\t\tcolorAttr.setX( i2, r );\n\t\t\t\t\tcolorAttr.setY( i2, g );\n\t\t\t\t\tcolorAttr.setZ( i2, b );\n\n\t\t\t\t}\n\n\t\t\t\tcolorAttr.needsUpdate = true;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tcontrols.enabled = true;\n\t\t\tbrushMesh.visible = false;\n\n\t\t}\n\n\t}\n\n\tconst currTime = window.performance.now();\n\tif ( params.rotate ) {\n\n\t\tconst delta = currTime - lastTime;\n\t\ttargetMesh.rotation.y += delta * 0.001;\n\n\t}\n\n\tlastTime = currTime;\n\n\trenderer.render( scene, camera );\n\tstats.end();\n\n}\n\n\ninit();\n"],"names":["THREE.Mesh","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","params","stats","scene","camera","renderer","controls","targetMesh","brushMesh","mouse","THREE.Vector2","mouseType","brushActive","lastTime","init","THREE.WebGLRenderer","render","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","THREE.AmbientLight","radius","tube","tubularSegments","radialSegments","knotGeometry","THREE.TorusKnotGeometry","colorArray","colorAttr","THREE.BufferAttribute","THREE.DynamicDrawUsage","knotMaterial","THREE.MeshStandardMaterial","brushGeometry","THREE.SphereGeometry","brushMaterial","THREE.PerspectiveCamera","Stats","gui","dat.GUI","raycaster","THREE.Raycaster","res","delta","c","OrbitControls","geometry","bvh","indexAttr","inverseMatrix","THREE.Matrix4","sphere","THREE.Sphere","indices","tempVec","THREE.Vector3","box","intersects","min","max","x","y","INTERSECTED","CONTAINED","NOT_INTERSECTED","tri","i","contained","i3","g","b","l","i2","currTime"],"mappings":"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"}