{"version":3,"file":"clippedEdges-BH11KMKp.js","sources":["../../clippedEdges.js"],"sourcesContent":["import * as THREE from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { MeshoptDecoder } from 'three/examples/jsm/libs/meshopt_decoder.module.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\n// import * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport Stats from 'stats.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { MeshBVH, BVHHelper, CONTAINED } from 'three-mesh-bvh';\n\nconst params = {\n\tuseBVH: true,\n\n\tdisplayBVH: false,\n\tdisplayDepth: 10,\n\n\twireframeDisplay: false,\n\tdisplayModel: true,\n\n\tanimate: true,\n\tanimation: 'SPIN',\n\tinvert: false,\n};\n\nlet renderer, camera, scene, gui, stats;\nlet controls, clock;\nlet colliderBvh, colliderMesh, bvhHelper;\nlet frontSideModel, backSideModel, planeMesh;\nlet clippingPlanes, outlineLines;\nlet initialClip = false;\nlet outputElement = null;\nlet time = 0;\n\nconst tempVector = new THREE.Vector3();\nconst tempVector1 = new THREE.Vector3();\nconst tempVector2 = new THREE.Vector3();\nconst tempVector3 = new THREE.Vector3();\nconst tempLine = new THREE.Line3();\nconst inverseMatrix = new THREE.Matrix4();\nconst localPlane = new THREE.Plane();\n\ninit();\n\nfunction init() {\n\n\toutputElement = document.getElementById( 'output' );\n\n\tconst bgColor = new THREE.Color( 0x263238 ).multiplyScalar( 0.1 );\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true, stencil: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\trenderer.shadowMap.enabled = true;\n\trenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\trenderer.localClippingEnabled = true;\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( bgColor, 20, 70 );\n\n\t// lights\n\tconst light = new THREE.DirectionalLight( 0xffffff, 2.5 );\n\tlight.position.set( 1, 1.5, 2 ).multiplyScalar( 50 );\n\tscene.add( light );\n\tscene.add( new THREE.HemisphereLight( 0xffffff, 0x223344, 1.5 ) );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.01, 50 );\n\tcamera.position.set( 0.4, 0.4, 0.4 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\n\tclock = new THREE.Clock();\n\n\t// clippingPlanes\n\tclippingPlanes = [\n\t\tnew THREE.Plane(),\n\t];\n\n\tplaneMesh = new THREE.Mesh( new THREE.PlaneGeometry(), new THREE.MeshBasicMaterial( {\n\t\tside: THREE.DoubleSide,\n\t\tstencilWrite: true,\n\t\tstencilFunc: THREE.NotEqualStencilFunc,\n\t\tstencilFail: THREE.ZeroStencilOp,\n\t\tstencilZFail: THREE.ZeroStencilOp,\n\t\tstencilZPass: THREE.ZeroStencilOp,\n\t} ) );\n\tplaneMesh.scale.setScalar( 1.5 );\n\tplaneMesh.material.color.set( 0x80deea );\n\tplaneMesh.renderOrder = 2;\n\tscene.add( planeMesh );\n\n\t// create line geometry with enough data to hold 100000 segments\n\tconst lineGeometry = new THREE.BufferGeometry();\n\tconst linePosAttr = new THREE.BufferAttribute( new Float32Array( 300000 ), 3, false );\n\tlinePosAttr.setUsage( THREE.DynamicDrawUsage );\n\tlineGeometry.setAttribute( 'position', linePosAttr );\n\toutlineLines = new THREE.LineSegments( lineGeometry, new THREE.LineBasicMaterial() );\n\toutlineLines.material.color.set( 0x00acc1 );\n\toutlineLines.frustumCulled = false;\n\toutlineLines.renderOrder = 3;\n\n\t// load the model\n\tconst loader = new GLTFLoader();\n\tloader.setMeshoptDecoder( MeshoptDecoder );\n\tloader\n\t\t.load( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/internal-combustion-engine/model.gltf', gltf => {\n\n\t\t\t// merge the geometry if needed\n\t\t\t// let model = gltf.scene;\n\t\t\t// model.updateMatrixWorld( true );\n\n\t\t\t// create a merged version if it isn't already\n\t\t\t// const geometries = [];\n\t\t\t// model.traverse( c => {\n\n\t\t\t// \tif ( c.isMesh ) {\n\n\t\t\t// \t\tconst clonedGeometry = c.geometry.clone();\n\t\t\t// \t\tclonedGeometry.applyMatrix4( c.matrixWorld );\n\t\t\t// \t\tfor ( const key in clonedGeometry.attributes ) {\n\n\t\t\t// \t\t\tif ( key === 'position' || key === 'normal' ) {\n\n\t\t\t// \t\t\t\tcontinue;\n\n\t\t\t// \t\t\t}\n\n\t\t\t// \t\t\tclonedGeometry.deleteAttribute( key );\n\n\t\t\t// \t\t}\n\n\t\t\t// \t\tgeometries.push( clonedGeometry );\n\n\t\t\t// \t}\n\n\t\t\t// } );\n\n\t\t\t// const mergedGeometry = BufferGeometryUtils.mergeBufferGeometries( geometries );\n\t\t\t// model = new THREE.Mesh( mergedGeometry, new THREE.MeshStandardMaterial() );\n\n\t\t\t// Render Order\n\t\t\t// 0. Render front model and back model with stencil\n\t\t\t// 1. Render surface color model\n\t\t\t// 2. Render clip pane cap\n\t\t\t// 3. Render outlines\n\n\t\t\t// use basic material because the using clip caps is expensive since the fragment\n\t\t\t// shader has to run always.\n\t\t\tconst model = gltf.scene.children[ 0 ];\n\t\t\tconst mergedGeometry = model.geometry;\n\t\t\tmodel.material = new THREE.MeshBasicMaterial();\n\t\t\tmodel.position.set( 0, 0, 0 );\n\t\t\tmodel.quaternion.identity();\n\n\t\t\t// color the surface of the geometry with an EQUAL depth to limit the amount of\n\t\t\t// fragment shading that has to run.\n\t\t\tconst surfaceModel = model.clone();\n\t\t\tsurfaceModel.material = new THREE.MeshStandardMaterial( {\n\t\t\t\tdepthFunc: THREE.EqualDepth,\n\t\t\t} );\n\t\t\tsurfaceModel.renderOrder = 1;\n\n\t\t\toutlineLines.scale.copy( model.scale );\n\t\t\toutlineLines.position.set( 0, 0, 0 );\n\t\t\toutlineLines.quaternion.identity();\n\n\t\t\tmodel.updateMatrixWorld( true );\n\n\t\t\t// Adjust all the materials to draw front and back side with stencil for clip cap\n\t\t\tconst matSet = new Set();\n\t\t\tconst materialMap = new Map();\n\t\t\tfrontSideModel = model;\n\t\t\tfrontSideModel.updateMatrixWorld( true );\n\t\t\tfrontSideModel.traverse( c => {\n\n\t\t\t\tif ( c.isMesh ) {\n\n\t\t\t\t\tif ( materialMap.has( c.material ) ) {\n\n\t\t\t\t\t\tc.material = materialMap.get( c.material );\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tmatSet.add( c.material );\n\n\t\t\t\t\tconst material = c.material.clone();\n\t\t\t\t\tmaterial.color.set( 0xffffff );\n\t\t\t\t\tmaterial.roughness = 1.0;\n\t\t\t\t\tmaterial.metalness = 0.0;\n\t\t\t\t\tmaterial.side = THREE.FrontSide;\n\t\t\t\t\tmaterial.stencilWrite = true;\n\t\t\t\t\tmaterial.stencilFail = THREE.IncrementWrapStencilOp;\n\t\t\t\t\tmaterial.stencilZFail = THREE.IncrementWrapStencilOp;\n\t\t\t\t\tmaterial.stencilZPass = THREE.IncrementWrapStencilOp;\n\t\t\t\t\tmaterial.clippingPlanes = clippingPlanes;\n\n\t\t\t\t\tmaterialMap.set( c.material, material );\n\t\t\t\t\tc.material = material;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tmaterialMap.clear();\n\n\t\t\tbackSideModel = frontSideModel.clone();\n\t\t\tbackSideModel.traverse( c => {\n\n\t\t\t\tif ( c.isMesh ) {\n\n\t\t\t\t\tif ( materialMap.has( c.material ) ) {\n\n\t\t\t\t\t\tc.material = materialMap.get( c.material );\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst material = c.material.clone();\n\t\t\t\t\tmaterial.color.set( 0xffffff );\n\t\t\t\t\tmaterial.roughness = 1.0;\n\t\t\t\t\tmaterial.metalness = 0.0;\n\t\t\t\t\tmaterial.colorWrite = false;\n\t\t\t\t\tmaterial.depthWrite = false;\n\t\t\t\t\tmaterial.side = THREE.BackSide;\n\t\t\t\t\tmaterial.stencilWrite = true;\n\t\t\t\t\tmaterial.stencilFail = THREE.DecrementWrapStencilOp;\n\t\t\t\t\tmaterial.stencilZFail = THREE.DecrementWrapStencilOp;\n\t\t\t\t\tmaterial.stencilZPass = THREE.DecrementWrapStencilOp;\n\t\t\t\t\tmaterial.clippingPlanes = clippingPlanes;\n\n\t\t\t\t\tmaterialMap.set( c.material, material );\n\t\t\t\t\tc.material = material;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\t// create the collider and preview mesh\n\t\t\tcolliderBvh = new MeshBVH( mergedGeometry, { maxLeafSize: 3 } );\n\t\t\tmergedGeometry.boundsTree = colliderBvh;\n\n\t\t\tcolliderMesh = new THREE.Mesh( mergedGeometry, new THREE.MeshBasicMaterial( {\n\t\t\t\twireframe: true,\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 0.01,\n\t\t\t\tdepthWrite: false,\n\t\t\t} ) );\n\t\t\tcolliderMesh.renderOrder = 2;\n\t\t\tcolliderMesh.position.copy( model.position );\n\t\t\tcolliderMesh.rotation.copy( model.rotation );\n\t\t\tcolliderMesh.scale.copy( model.scale );\n\n\t\t\tbvhHelper = new BVHHelper( colliderMesh, parseInt( params.displayDepth ) );\n\t\t\tbvhHelper.depth = parseInt( params.displayDepth );\n\t\t\tbvhHelper.update();\n\n\t\t\t// create group of meshes and offset it so they're centered\n\t\t\tconst group = new THREE.Group();\n\t\t\tgroup.add( frontSideModel, backSideModel, surfaceModel, colliderMesh, bvhHelper, outlineLines );\n\n\t\t\tconst box = new THREE.Box3();\n\t\t\tbox.setFromObject( frontSideModel );\n\t\t\tbox.getCenter( group.position ).multiplyScalar( - 1 );\n\t\t\tgroup.updateMatrixWorld( true );\n\t\t\tscene.add( group );\n\n\t\t} );\n\n\t// dat.gui\n\tgui = new GUI();\n\n\tgui.add( params, 'invert' );\n\tgui.add( params, 'animate' );\n\tgui.add( params, 'animation', [ 'SPIN', 'OSCILLATE' ] ).onChange( () => {\n\n\t\ttime = 0;\n\n\t} );\n\tgui.add( params, 'displayModel' );\n\tgui.add( params, 'useBVH' );\n\n\tconst helperFolder = gui.addFolder( 'helper' );\n\thelperFolder.add( params, 'wireframeDisplay' );\n\thelperFolder.add( params, 'displayBVH' );\n\thelperFolder.add( params, 'displayDepth', 1, 20, 1 ).onChange( v => {\n\n\t\tif ( bvhHelper ) {\n\n\t\t\tbvhHelper.depth = parseInt( v );\n\t\t\tbvhHelper.update();\n\n\t\t}\n\n\t} );\n\thelperFolder.open();\n\n\tgui.open();\n\n\t// stats\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.domElement );\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\t\trenderer.setPixelRatio( window.devicePixelRatio );\n\n\t}, false );\n\n}\n\nfunction render() {\n\n\tif ( bvhHelper ) {\n\n\t\tbvhHelper.visible = params.displayBVH;\n\t\tcolliderMesh.visible = params.wireframeDisplay;\n\n\t\tfrontSideModel.visible = params.displayModel;\n\t\tbackSideModel.visible = params.displayModel;\n\n\t}\n\n\t// make the outlines darker if the model is shown\n\toutlineLines.material.color\n\t\t.set( params.displayModel ? 0x00acc1 : 0x4dd0e1 )\n\t\t.convertSRGBToLinear();\n\n\tconst delta = Math.min( clock.getDelta(), 0.03 );\n\tif ( params.animate ) {\n\n\t\ttime += delta;\n\n\t\tif ( params.animation === 'SPIN' ) {\n\n\t\t\tplaneMesh.rotation.x = 0.25 * time;\n\t\t\tplaneMesh.rotation.y = 0.25 * time;\n\t\t\tplaneMesh.rotation.z = 0.25 * time;\n\t\t\tplaneMesh.position.set( 0, 0, 0 );\n\n\t\t} else {\n\n\t\t\tplaneMesh.position.set( Math.sin( 0.25 * time ) * 0.325, 0, 0 );\n\t\t\tplaneMesh.rotation.set( 0, Math.PI / 2, 0 );\n\n\t\t}\n\n\t\tplaneMesh.updateMatrixWorld();\n\n\t}\n\n\tconst clippingPlane = clippingPlanes[ 0 ];\n\tclippingPlane.normal.set( 0, 0, params.invert ? 1 : - 1 );\n\tclippingPlane.constant = 0;\n\tclippingPlane.applyMatrix4( planeMesh.matrixWorld );\n\n\t// Perform the clipping\n\tif ( colliderBvh && ( params.animate || ! initialClip ) ) {\n\n\t\tinitialClip = true;\n\n\t\t// get the clipping plane in the local space of the BVH\n\t\tinverseMatrix.copy( colliderMesh.matrixWorld ).invert();\n\t\tlocalPlane.copy( clippingPlane ).applyMatrix4( inverseMatrix );\n\n\t\tlet index = 0;\n\t\tconst posAttr = outlineLines.geometry.attributes.position;\n\t\tconst startTime = window.performance.now();\n\t\tcolliderBvh.shapecast( {\n\n\t\t\tintersectsBounds: box => {\n\n\t\t\t\t// if we're not using the BVH then skip straight to iterating over all triangles\n\t\t\t\tif ( ! params.useBVH ) {\n\n\t\t\t\t\treturn CONTAINED;\n\n\t\t\t\t}\n\n\t\t\t\treturn localPlane.intersectsBox( box );\n\n\t\t\t},\n\n\t\t\tintersectsTriangle: tri => {\n\n\t\t\t\t// check each triangle edge to see if it intersects with the plane. If so then\n\t\t\t\t// add it to the list of segments.\n\t\t\t\tlet count = 0;\n\n\t\t\t\ttempLine.start.copy( tri.a );\n\t\t\t\ttempLine.end.copy( tri.b );\n\t\t\t\tif ( localPlane.intersectLine( tempLine, tempVector ) ) {\n\n\t\t\t\t\tposAttr.setXYZ( index, tempVector.x, tempVector.y, tempVector.z );\n\t\t\t\t\tindex ++;\n\t\t\t\t\tcount ++;\n\n\t\t\t\t}\n\n\t\t\t\ttempLine.start.copy( tri.b );\n\t\t\t\ttempLine.end.copy( tri.c );\n\t\t\t\tif ( localPlane.intersectLine( tempLine, tempVector ) ) {\n\n\t\t\t\t\tposAttr.setXYZ( index, tempVector.x, tempVector.y, tempVector.z );\n\t\t\t\t\tcount ++;\n\t\t\t\t\tindex ++;\n\n\t\t\t\t}\n\n\t\t\t\ttempLine.start.copy( tri.c );\n\t\t\t\ttempLine.end.copy( tri.a );\n\t\t\t\tif ( localPlane.intersectLine( tempLine, tempVector ) ) {\n\n\t\t\t\t\tposAttr.setXYZ( index, tempVector.x, tempVector.y, tempVector.z );\n\t\t\t\t\tcount ++;\n\t\t\t\t\tindex ++;\n\n\t\t\t\t}\n\n\t\t\t\t// When the plane passes through a vertex and one of the edges of the triangle, there will be three intersections, two of which must be repeated\n\t\t\t\tif ( count === 3 ) {\n\n\t\t\t\t\ttempVector1.fromBufferAttribute( posAttr, index - 3 );\n\t\t\t\t\ttempVector2.fromBufferAttribute( posAttr, index - 2 );\n\t\t\t\t\ttempVector3.fromBufferAttribute( posAttr, index - 1 );\n\t\t\t\t\t// If the last point is a duplicate intersection\n\t\t\t\t\tif ( tempVector3.equals( tempVector1 ) || tempVector3.equals( tempVector2 ) ) {\n\n\t\t\t\t\t\tcount --;\n\t\t\t\t\t\tindex --;\n\n\t\t\t\t\t} else if ( tempVector1.equals( tempVector2 ) ) {\n\n\t\t\t\t\t\t// If the last point is not a duplicate intersection\n\t\t\t\t\t\t// Set the penultimate point as a distinct point and delete the last point\n\t\t\t\t\t\tposAttr.setXYZ( index - 2, tempVector3 );\n\t\t\t\t\t\tcount --;\n\t\t\t\t\t\tindex --;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// If we only intersected with one or three sides then just remove it. This could be handled\n\t\t\t\t// more gracefully.\n\t\t\t\tif ( count !== 2 ) {\n\n\t\t\t\t\tindex -= count;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t} );\n\n\t\t// set the draw range to only the new segments and offset the lines so they don't intersect with the geometry\n\t\toutlineLines.geometry.setDrawRange( 0, index );\n\t\toutlineLines.position.copy( clippingPlane.normal ).multiplyScalar( - 0.00001 );\n\t\tposAttr.needsUpdate = true;\n\n\t\tconst delta = window.performance.now() - startTime;\n\t\toutputElement.innerText = `${ parseFloat( delta.toFixed( 3 ) ) }ms`;\n\n\t}\n\n\tstats.update();\n\tcontrols.update();\n\n\trenderer.render( scene, camera );\n\n}\n\n"],"names":["params","renderer","camera","scene","gui","stats","controls","clock","colliderBvh","colliderMesh","bvhHelper","frontSideModel","backSideModel","planeMesh","clippingPlanes","outlineLines","initialClip","outputElement","time","tempVector","THREE.Vector3","tempVector1","tempVector2","tempVector3","tempLine","THREE.Line3","inverseMatrix","THREE.Matrix4","localPlane","THREE.Plane","init","bgColor","THREE.Color","THREE.WebGLRenderer","render","THREE.PCFSoftShadowMap","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","THREE.HemisphereLight","THREE.PerspectiveCamera","OrbitControls","THREE.Clock","THREE.Mesh","THREE.PlaneGeometry","THREE.MeshBasicMaterial","THREE.DoubleSide","THREE.NotEqualStencilFunc","THREE.ZeroStencilOp","lineGeometry","THREE.BufferGeometry","linePosAttr","THREE.BufferAttribute","THREE.DynamicDrawUsage","THREE.LineSegments","THREE.LineBasicMaterial","loader","GLTFLoader","MeshoptDecoder","gltf","model","mergedGeometry","surfaceModel","THREE.MeshStandardMaterial","THREE.EqualDepth","matSet","materialMap","c","material","THREE.FrontSide","THREE.IncrementWrapStencilOp","THREE.BackSide","THREE.DecrementWrapStencilOp","MeshBVH","BVHHelper","group","THREE.Group","box","THREE.Box3","GUI","helperFolder","v","Stats","delta","clippingPlane","index","posAttr","startTime","CONTAINED","tri","count"],"mappings":"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"}