import{W as E,c as U,D as F,A as V,P as I,f as K,M as P,T as q,X as Q,bc as X,C as T,ak as Y,g as J,V as j,n as R,b as N,Y as Z,af as _}from"./ExtendedTriangle-hsPasuNU.js";import{G as O}from"./GLTFLoader-Be-eETKy.js";import{M as z}from"./meshopt_decoder.module-j6OW_3Rk.js";import{S as $}from"./stats.min-DbzWzcqd.js";import{g as ee}from"./lil-gui.module.min-BH_YJbPT.js";import{O as te}from"./OrbitControls-DEZHvbFX.js";import{R as oe}from"./RoundedBoxGeometry-BprMXSMI.js";import{G as D}from"./GenerateMeshBVHWorker-vOgOjCfJ.js";import{M as ne}from"./MeshBVH-DQV6PBDm.js";import"./BufferGeometryUtils-BuPYlHUL.js";import"./_commonjsHelpers-CqkleIqs.js";let s,w,a,C,L,t,u,r=!1,v=null;const o={model:"Torus Knot",scale:.75,resolution:30,solid:!0,displayMesh:!0,displayBounds:!1,insideOnly:!1,rebuild:()=>r=!0},i={};ae();function ae(){document.getElementById("output"),s=new E({antialias:!0}),s.setPixelRatio(window.devicePixelRatio),s.setSize(window.innerWidth,window.innerHeight),s.setClearColor(1449501,1),s.setAnimationLoop(se),s.outputEncoding=void 0,document.body.appendChild(s.domElement),a=new U;const l=new F(16777215,3);l.position.set(3,6,9),a.add(l);const c=new F(16777215,.3);c.position.set(-3,-6,-9),a.add(c);const m=new V(16777215,.75);a.add(m),w=new I(75,window.innerWidth/window.innerHeight,.1,50),w.position.set(1,.5,1),w.far=100,w.updateProjectionMatrix(),new te(w,s.domElement),L=new $,document.body.appendChild(L.dom);const h=new K({transparent:!0,wireframe:!0,depthWrite:!1,opacity:.02});new O().setMeshoptDecoder(z).load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/happy-buddha/buddha.glb",n=>{const e=n.scene.children[0];e.geometry.center(),e.material=h,e.scale.setScalar(1.5),e.rotation.y=-Math.PI/2,new D().generate(e.geometry).then(y=>{a.add(e),i.Buddha={model:e,bvh:y},o.model==="Buddha"&&(r=!0)})}),new O().setMeshoptDecoder(z).load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/stanford-bunny/bunny.glb",n=>{const e=n.scene.children[0];e.geometry.center(),e.material=h,e.rotation.y=Math.PI/2,e.scale.setScalar(.65),new D().generate(e.geometry).then(y=>{a.add(e),i.Bunny={model:e,bvh:y},o.model==="Bunny"&&(r=!0)})});{const n=new P(new q(.3,.1,400,60),h),e=new ne(n.geometry);a.add(n),i["Torus Knot"]={bvh:e,model:n},r=!0}i.Buddha={model:null,bvh:null},i.Bunny={model:null,bvh:null};const B=new P(new Q);u=new X(B,16777215),u.material.opacity=.35,u.material.transparent=!0,a.add(u),C=new ee,C.add(o,"model",Object.keys(i)).onChange(()=>{r=!0});const f=C.addFolder("voxelize");f.add(o,"resolution",5,75,1).onChange(()=>{r=!0}),f.add(o,"scale",.1,4).onChange(()=>{r=!0}),f.add(o,"solid").onChange(()=>{r=!0}),f.add(o,"insideOnly").onChange(()=>{r=!0}),f.add(o,"rebuild");const g=C.addFolder("helpers");g.add(o,"displayMesh"),g.add(o,"displayBounds"),window.addEventListener("resize",function(){w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)},!1)}function*re(){const d=o.resolution,l=d**3,c=o.scale,m=c/d,h=new T(16777215),B=new T(16761095).convertSRGBToLinear();t&&t.instanceMatrix.count!==l&&(t.material.dispose(),t.dispose(),t.parent.remove(t),t=null);const{model:f,bvh:g}=i[o.model];if(!f)return;t||(t=new Y(new oe(1,1,1,4,.1),new J,l),t.setColorAt(0,h),a.add(t));const n=-c/2+m*.5,e=new j,x=new _,y=new j().setScalar(m),b=new R,S=new N,k=new R().copy(f.matrixWorld).invert(),M=new Z;M.direction.set(0,0,1);let p=0;for(let W=0;W<d;W++)for(let G=0;G<d;G++)for(let H=0;H<d;H++){if(e.set(n+G*m,n+W*m,n+H*m),S.min.setScalar(-.5*m).add(e),S.max.setScalar(.5*m).add(e),g.intersectsBox(S,k))o.insideOnly||(b.compose(e,x,y),t.setMatrixAt(p,b),t.setColorAt(p,h),t.instanceMatrix.needsUpdate=!0,t.instanceColor.needsUpdate=!0,p++);else if(o.solid){M.origin.copy(e).applyMatrix4(k);const A=g.raycastFirst(M,2);A&&A.face.normal.dot(M.direction)>0&&(b.compose(e,x,y),t.setMatrixAt(p,b),t.setColorAt(p,B),t.instanceMatrix.needsUpdate=!0,t.instanceColor.needsUpdate=!0,p++)}t.count=p,yield}t.count=p}function se(){if(L.update(),a.updateMatrixWorld(!0),r&&(v=re(),r=!1),v){let l=window.performance.now();for(;window.performance.now()-l<16;)if(v.next().done){v=null;break}}u&&(u.object.scale.setScalar(o.scale),u.object.updateMatrixWorld(!0),u.update());for(const l in i){const c=i[l];c.model&&(c.model.visible=!1)}const{model:d}=i[o.model];d&&(d.visible=o.displayMesh,u.visible=o.displayBounds),s.render(a,w)}
//# sourceMappingURL=voxelize-Cu_lLPdK.js.map
