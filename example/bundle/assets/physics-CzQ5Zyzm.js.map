{"version":3,"file":"physics-CzQ5Zyzm.js","sources":["../../physics.js"],"sourcesContent":["import * as THREE from 'three';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport Stats from 'stats.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { MeshBVH, BVHHelper, StaticGeometryGenerator } from 'three-mesh-bvh';\n\nconst params = {\n\tdisplayCollider: false,\n\tdisplayBVH: false,\n\tdisplayParents: false,\n\tdisplayDepth: 10,\n\tgravity: - 9.8,\n\tphysicsSteps: 5,\n\tsimulationSpeed: 1,\n\tsphereSize: 1,\n\tpause: false,\n\tstep: () => {\n\n\t\tconst steps = params.physicsSteps;\n\t\tfor ( let i = 0; i < steps; i ++ ) update( 0.016 / steps );\n\n\t},\n\texplode: () => {\n\n\t\tconst temp = new THREE.Vector3();\n\t\tspheres.forEach( s => {\n\n\t\t\ttemp.copy( s.position );\n\t\t\ttemp.y += 10;\n\t\t\ttemp.normalize();\n\t\t\ts.velocity.addScaledVector( temp, 120 );\n\n\t\t} );\n\n\t},\n\treset: () => {\n\n\t\tspheres.forEach( s => {\n\n\t\t\ts.material.dispose();\n\t\t\ts.geometry.dispose();\n\t\t\tscene.remove( s );\n\n\t\t} );\n\t\tspheres.length = 0;\n\n\t\thits.forEach( h => {\n\n\t\t\th.material.dispose();\n\t\t\th.geometry.dispose();\n\t\t\tscene.remove( h );\n\n\t\t} );\n\t\thits.length = 0;\n\n\t},\n};\n\nlet renderer, camera, scene, clock, stats;\nlet environment, collider, bvhHelper;\nconst spheres = [];\nconst hits = [];\nconst tempSphere = new THREE.Sphere();\nconst deltaVec = new THREE.Vector3();\nconst tempVec = new THREE.Vector3();\nconst forwardVector = new THREE.Vector3( 0, 0, 1 );\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0x131619;\n\n\t// Renderer\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\trenderer.shadowMap.enabled = true;\n\trenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\trenderer.outputEncoding = THREE.sRGBEncoding;\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// Scene\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( bgColor, 30, 70 );\n\n\t// Lights\n\tconst light = new THREE.DirectionalLight( 0xaaccff, 1.5 );\n\tlight.position.set( 50, 75, 50 );\n\n\tconst shadowCam = light.shadow.camera;\n\tshadowCam.left = shadowCam.bottom = - 10;\n\tshadowCam.top = shadowCam.right = 10;\n\n\tscene.add(\n\t\tlight,\n\t\tnew THREE.HemisphereLight( 0x8dc1ff, 0x667c8d, 1.2 )\n\t);\n\n\t// Camera\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100 );\n\tcamera.position.set( 10, 10, - 10 );\n\n\tclock = new THREE.Clock();\n\tnew OrbitControls( camera, renderer.domElement );\n\n\t// Stats\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\t// Load environment\n\tloadColliderEnvironment();\n\n\t// GUI\n\tconst gui = new GUI();\n\n\tconst visFolder = gui.addFolder( 'Visualization' );\n\tvisFolder.add( params, 'displayCollider' );\n\tvisFolder.add( params, 'displayBVH' );\n\tvisFolder.add( params, 'displayParents' ).onChange( v => {\n\n\t\tbvhHelper.displayParents = v;\n\t\tbvhHelper.update();\n\n\t} );\n\tvisFolder.add( params, 'displayDepth', 1, 20, 1 ).onChange( v => {\n\n\t\tbvhHelper.depth = v;\n\t\tbvhHelper.update();\n\n\t} );\n\tvisFolder.open();\n\n\tconst physicsFolder = gui.addFolder( 'Physics' );\n\tphysicsFolder.add( params, 'physicsSteps', 0, 30, 1 );\n\tphysicsFolder.add( params, 'gravity', - 100, 100, 0.01 );\n\tphysicsFolder.add( params, 'simulationSpeed', 0, 5, 0.01 );\n\tphysicsFolder.add( params, 'sphereSize', 0.2, 5, 0.1 );\n\tphysicsFolder.add( params, 'pause' );\n\tphysicsFolder.add( params, 'step' );\n\tphysicsFolder.open();\n\n\tgui.add( params, 'explode' );\n\tgui.add( params, 'reset' );\n\tgui.open();\n\n\t// Event listeners\n\tconst raycaster = new THREE.Raycaster();\n\tconst mouse = new THREE.Vector2();\n\tlet pointerDownX = 0;\n\tlet pointerDownY = 0;\n\n\trenderer.domElement.addEventListener( 'pointerdown', e => {\n\n\t\tpointerDownX = e.clientX;\n\t\tpointerDownY = e.clientY;\n\n\t} );\n\n\trenderer.domElement.addEventListener( 'pointerup', e => {\n\n\t\tconst totalDelta = Math.abs( e.clientX - pointerDownX ) + Math.abs( e.clientY - pointerDownY );\n\t\tif ( totalDelta > 2 ) return;\n\n\t\tmouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;\n\t\tmouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;\n\t\traycaster.setFromCamera( mouse, camera );\n\n\t\tconst sphere = createSphere();\n\t\tsphere.position.copy( camera.position ).addScaledVector( raycaster.ray.direction, 3 );\n\t\tsphere.velocity\n\t\t\t.set( Math.random() - 0.5, Math.random() - 0.5, Math.random() - 0.5 )\n\t\t\t.addScaledVector( raycaster.ray.direction, 10 * Math.random() + 15 )\n\t\t\t.multiplyScalar( 0.5 );\n\n\t} );\n\n\twindow.addEventListener( 'resize', () => {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t} );\n\n\twindow.createSphere = createSphere;\n\n}\n\nfunction loadColliderEnvironment() {\n\n\tnew GLTFLoader().load(\n\t\t'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/low-poly-jungle-scene/scene.gltf',\n\t\tres => {\n\n\t\t\tenvironment = res.scene;\n\t\t\tenvironment.scale.setScalar( 0.05 );\n\n\t\t\t// Add point lights\n\t\t\tconst pointLight = new THREE.PointLight( 0x00ffff, 9, 7 );\n\t\t\tpointLight.position.set( - 100, - 40, 100 );\n\t\t\tenvironment.add( pointLight );\n\n\t\t\tconst porchLight = new THREE.PointLight( 0xffdd66, 5, 15 );\n\t\t\tporchLight.position.set( 80, 80, 135 );\n\t\t\tporchLight.shadow.normalBias = 1e-2;\n\t\t\tporchLight.shadow.bias = - 1e-3;\n\t\t\tporchLight.shadow.mapSize.setScalar( 1024 );\n\t\t\tporchLight.castShadow = true;\n\t\t\tenvironment.add( porchLight );\n\n\t\t\t// Generate merged collision geometry\n\t\t\tenvironment.updateMatrixWorld( true );\n\n\t\t\tconst staticGenerator = new StaticGeometryGenerator( environment );\n\t\t\tstaticGenerator.attributes = [ 'position' ];\n\n\t\t\tconst mergedGeometry = staticGenerator.generate();\n\t\t\tmergedGeometry.boundsTree = new MeshBVH( mergedGeometry );\n\n\t\t\tcollider = new THREE.Mesh( mergedGeometry );\n\t\t\tcollider.material.wireframe = true;\n\t\t\tcollider.material.opacity = 0.5;\n\t\t\tcollider.material.transparent = true;\n\n\t\t\tbvhHelper = new BVHHelper( collider, params.displayDepth );\n\n\t\t\tscene.add( bvhHelper, collider, environment );\n\n\t\t\tenvironment.traverse( c => {\n\n\t\t\t\tif ( c.material ) {\n\n\t\t\t\t\tc.castShadow = c.receiveShadow = true;\n\t\t\t\t\tc.material.shadowSide = 2;\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\t);\n\n}\n\nfunction onCollide( object1, object2, point, normal, velocity, offset = 0 ) {\n\n\tif ( velocity < Math.max( Math.abs( 0.04 * params.gravity ), 5 ) ) return;\n\n\t// Create collision effect\n\tconst effectScale = Math.max(\n\t\tobject2 ?\n\t\t\tMath.max( object1.collider.radius, object2.collider.radius ) :\n\t\t\tobject1.collider.radius,\n\t\t0.4\n\t) * 2.0;\n\n\tconst plane = new THREE.Mesh(\n\t\tnew THREE.RingGeometry( 0, 1, 30 ),\n\t\tnew THREE.MeshBasicMaterial( { side: 2, transparent: true, depthWrite: false } )\n\t);\n\tplane.lifetime = 0;\n\tplane.maxLifetime = 0.4;\n\tplane.maxScale = effectScale * Math.max( Math.sin( Math.min( velocity / 200, 1 ) * Math.PI / 2 ), 0.35 );\n\n\tplane.position.copy( point ).addScaledVector( normal, offset );\n\tplane.quaternion.setFromUnitVectors( forwardVector, normal );\n\tscene.add( plane );\n\thits.push( plane );\n\n}\n\nfunction createSphere() {\n\n\tconst white = new THREE.Color( 0xffffff );\n\tconst color = new THREE.Color( 0x131619 ).lerp( white, Math.random() * 0.5 + 0.5 );\n\tconst sphere = new THREE.Mesh(\n\t\tnew THREE.SphereGeometry( 1, 20, 20 ),\n\t\tnew THREE.MeshStandardMaterial( { color } )\n\t);\n\tscene.add( sphere );\n\tsphere.castShadow = sphere.receiveShadow = true;\n\tsphere.material.shadowSide = 2;\n\n\tconst radius = 0.5 * params.sphereSize * ( Math.random() * 0.2 + 0.6 );\n\tsphere.scale.setScalar( radius );\n\tsphere.collider = new THREE.Sphere( sphere.position, radius );\n\tsphere.velocity = new THREE.Vector3( 0, 0, 0 );\n\tsphere.mass = Math.pow( radius, 3 ) * Math.PI * 4 / 3;\n\n\tspheres.push( sphere );\n\treturn sphere;\n\n}\n\nfunction updateSphereCollisions( deltaTime ) {\n\n\tconst bvh = collider.geometry.boundsTree;\n\n\tfor ( let i = 0, l = spheres.length; i < l; i ++ ) {\n\n\t\tconst sphere = spheres[ i ];\n\t\tconst sphereCollider = sphere.collider;\n\n\t\t// Apply gravity and move sphere\n\t\tsphere.velocity.y += params.gravity * deltaTime;\n\t\tsphereCollider.center.addScaledVector( sphere.velocity, deltaTime );\n\n\t\t// Remove spheres that fell out of the world\n\t\tif ( sphereCollider.center.y < - 80 ) {\n\n\t\t\tspheres.splice( i, 1 );\n\t\t\ti --;\n\t\t\tl --;\n\n\t\t\tsphere.material.dispose();\n\t\t\tsphere.geometry.dispose();\n\t\t\tscene.remove( sphere );\n\t\t\tcontinue;\n\n\t\t}\n\n\t\t// Check collision with environment\n\t\ttempSphere.copy( sphere.collider );\n\n\t\tlet collided = false;\n\t\tbvh.shapecast( {\n\n\t\t\tintersectsBounds: box => box.intersectsSphere( tempSphere ),\n\n\t\t\tintersectsTriangle: tri => {\n\n\t\t\t\ttri.closestPointToPoint( tempSphere.center, deltaVec );\n\t\t\t\tdeltaVec.sub( tempSphere.center );\n\t\t\t\tconst distance = deltaVec.length();\n\n\t\t\t\tif ( distance < tempSphere.radius ) {\n\n\t\t\t\t\tconst radius = tempSphere.radius;\n\t\t\t\t\tconst depth = distance - radius;\n\t\t\t\t\tdeltaVec.multiplyScalar( 1 / distance );\n\t\t\t\t\ttempSphere.center.addScaledVector( deltaVec, depth );\n\n\t\t\t\t\tcollided = true;\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tboundsTraverseOrder: box => box.distanceToPoint( tempSphere.center ) - tempSphere.radius,\n\n\t\t} );\n\n\t\tif ( collided ) {\n\n\t\t\tdeltaVec.subVectors( tempSphere.center, sphereCollider.center ).normalize();\n\t\t\tsphere.velocity.reflect( deltaVec );\n\n\t\t\tconst dot = sphere.velocity.dot( deltaVec );\n\t\t\tsphere.velocity.addScaledVector( deltaVec, - dot * 0.5 );\n\t\t\tsphere.velocity.multiplyScalar( Math.max( 1.0 - deltaTime, 0 ) );\n\n\t\t\tsphereCollider.center.copy( tempSphere.center );\n\n\t\t\ttempVec.copy( tempSphere.center ).addScaledVector( deltaVec, - tempSphere.radius );\n\t\t\tonCollide( sphere, null, tempVec, deltaVec, dot, 0.05 );\n\n\t\t}\n\n\t}\n\n\t// Handle sphere-sphere collisions\n\tfor ( let i = 0, l = spheres.length; i < l; i ++ ) {\n\n\t\tconst s1 = spheres[ i ];\n\t\tconst c1 = s1.collider;\n\n\t\tfor ( let j = i + 1; j < l; j ++ ) {\n\n\t\t\tconst s2 = spheres[ j ];\n\t\t\tconst c2 = s2.collider;\n\n\t\t\tdeltaVec.subVectors( c1.center, c2.center );\n\t\t\tconst depth = deltaVec.length() - ( c1.radius + c2.radius );\n\n\t\t\tif ( depth < 0 ) {\n\n\t\t\t\tdeltaVec.normalize();\n\n\t\t\t\tconst v1dot = s1.velocity.dot( deltaVec );\n\t\t\t\tconst v2dot = s2.velocity.dot( deltaVec );\n\n\t\t\t\tconst offsetRatio1 = Math.max( v1dot, 0.2 );\n\t\t\t\tconst offsetRatio2 = Math.max( v2dot, 0.2 );\n\n\t\t\t\tconst total = offsetRatio1 + offsetRatio2;\n\t\t\t\tconst ratio1 = offsetRatio1 / total;\n\t\t\t\tconst ratio2 = offsetRatio2 / total;\n\n\t\t\t\tc1.center.addScaledVector( deltaVec, - ratio1 * depth );\n\t\t\t\tc2.center.addScaledVector( deltaVec, ratio2 * depth );\n\n\t\t\t\tconst velocityDifference = new THREE.Vector3();\n\t\t\t\tvelocityDifference\n\t\t\t\t\t.addScaledVector( deltaVec, - v1dot )\n\t\t\t\t\t.addScaledVector( deltaVec, v2dot );\n\n\t\t\t\tconst velDiff = velocityDifference.length();\n\t\t\t\tconst m1 = s1.mass;\n\t\t\t\tconst m2 = s2.mass;\n\n\t\t\t\tlet newVel1, newVel2;\n\t\t\t\tconst damping = 0.5;\n\n\t\t\t\tif ( velocityDifference.dot( s1.velocity ) > velocityDifference.dot( s2.velocity ) ) {\n\n\t\t\t\t\tnewVel1 = damping * velDiff * ( m1 - m2 ) / ( m1 + m2 );\n\t\t\t\t\tnewVel2 = damping * velDiff * 2 * m1 / ( m1 + m2 );\n\t\t\t\t\tnewVel1 -= velDiff;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewVel1 = damping * velDiff * 2 * m2 / ( m1 + m2 );\n\t\t\t\t\tnewVel2 = damping * velDiff * ( m2 - m1 ) / ( m1 + m2 );\n\t\t\t\t\tnewVel2 -= velDiff;\n\n\t\t\t\t}\n\n\t\t\t\tvelocityDifference.normalize();\n\t\t\t\ts1.velocity.addScaledVector( velocityDifference, newVel1 );\n\t\t\t\ts2.velocity.addScaledVector( velocityDifference, newVel2 );\n\n\t\t\t\ttempVec.copy( c1.center ).addScaledVector( deltaVec, - c1.radius );\n\t\t\t\tonCollide( s1, s2, tempVec, deltaVec, velDiff, 0 );\n\n\t\t\t}\n\n\t\t}\n\n\t\ts1.position.copy( c1.center );\n\n\t}\n\n}\n\nfunction update( delta ) {\n\n\tif ( collider ) {\n\n\t\tconst steps = params.physicsSteps;\n\t\tfor ( let i = 0; i < steps; i ++ ) updateSphereCollisions( delta / steps );\n\n\t}\n\n\t// Update collision effects\n\tfor ( let i = 0, l = hits.length; i < l; i ++ ) {\n\n\t\tconst hit = hits[ i ];\n\t\thit.lifetime += delta;\n\n\t\tconst ratio = hit.lifetime / hit.maxLifetime;\n\t\tlet scale = Math.sin( ratio * 4.5 * Math.PI / 4 );\n\t\tscale = 1.0 - Math.pow( 1.0 - scale, 2 );\n\t\thit.scale.setScalar( scale * hit.maxScale );\n\t\thit.material.opacity = 1.0 - Math.sin( ratio * 2 * Math.PI / 4 );\n\n\t\tif ( ratio >= 1 ) {\n\n\t\t\thits.splice( i, 1 );\n\t\t\thit.parent.remove( hit );\n\t\t\thit.geometry.dispose();\n\t\t\thit.material.dispose();\n\t\t\ti --;\n\t\t\tl --;\n\n\t\t}\n\n\t}\n\n}\n\nfunction render() {\n\n\tstats.update();\n\n\tconst delta = Math.min( clock.getDelta(), 0.1 );\n\n\tif ( collider ) {\n\n\t\tcollider.visible = params.displayCollider;\n\t\tbvhHelper.visible = params.displayBVH;\n\n\t\tif ( ! params.pause ) update( params.simulationSpeed * delta );\n\n\t}\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["params","steps","i","update","temp","THREE.Vector3","spheres","s","scene","hits","h","renderer","camera","clock","stats","environment","collider","bvhHelper","tempSphere","THREE.Sphere","deltaVec","tempVec","forwardVector","init","THREE.WebGLRenderer","render","THREE.PCFSoftShadowMap","THREE.sRGBEncoding","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","shadowCam","THREE.HemisphereLight","THREE.PerspectiveCamera","THREE.Clock","OrbitControls","Stats","loadColliderEnvironment","gui","GUI","visFolder","v","physicsFolder","raycaster","THREE.Raycaster","mouse","THREE.Vector2","pointerDownX","pointerDownY","e","sphere","createSphere","GLTFLoader","res","pointLight","THREE.PointLight","porchLight","staticGenerator","StaticGeometryGenerator","mergedGeometry","MeshBVH","THREE.Mesh","BVHHelper","c","onCollide","object1","object2","point","normal","velocity","offset","effectScale","plane","THREE.RingGeometry","THREE.MeshBasicMaterial","white","THREE.Color","color","THREE.SphereGeometry","THREE.MeshStandardMaterial","radius","updateSphereCollisions","deltaTime","bvh","l","sphereCollider","collided","box","tri","distance","depth","dot","s1","c1","j","s2","c2","v1dot","v2dot","offsetRatio1","offsetRatio2","total","ratio1","ratio2","velocityDifference","velDiff","m1","m2","newVel1","newVel2","damping","delta","hit","ratio","scale"],"mappings":"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"}