import{n as q,Y as X,V as P,b as N,o as Y,ac as D,i as b,W as J,c as Z,P as $,k,J as K,M as Q,e as U,f as j,w as ee,C as te,ad as A}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{O as ne}from"./OrbitControls-DEZHvbFX.js";import{g as ie}from"./lil-gui.module.min-BH_YJbPT.js";import{S as oe}from"./stats.module--VATS4Kh.js";import{G as se,P as re,I as ae,N as ce,S as de,A as le,C as pe}from"./MeshBVH-DQV6PBDm.js";import{a as ue,c as me,d as he}from"./ExtensionUtilities-BlnM4xb7.js";import{B as we}from"./BVHHelper-DA_xcAFF.js";const I=new q,C=new X,O=new re(()=>new Y),L=new P,W=new P,z=new N,_=["getX","getY","getZ"];class fe extends se{get primitiveStride(){return 2}writePrimitiveBounds(t,e,n){const s=this._indirectBuffer,{geometry:r,primitiveStride:p}=this,o=r.attributes.position,a=r.index,c=a?a.count:o.count;let d=(s?s[t]:t)*p,u=(d+1)%c;a&&(d=a.getX(d),u=a.getX(u));for(let h=0;h<3;h++){const l=o[_[h]](d),m=o[_[h]](u),x=l<m?l:m,V=l>m?l:m;e[n+h]=x,e[n+h+3]=V}return e}shapecast(t){const e=O.getPrimitive(),n=super.shapecast({...t,intersectsPrimitive:t.intersectsLine,scratchPrimitive:e,iterate:ve});return O.releasePrimitive(e),n}raycastObject3D(t,e,n=[]){const{matrixWorld:s}=t,{firstHitOnly:r}=e;I.copy(s).invert(),C.copy(e.ray).applyMatrix4(I);const o=e.params.Line.threshold/((t.scale.x+t.scale.y+t.scale.z)/3),a=o*o;let c=null,v=1/0;return this.shapecast({boundsTraverseOrder:d=>d.distanceToPoint(C.origin),intersectsBounds:d=>(z.copy(d).expandByScalar(Math.abs(o)),C.intersectsBox(z)?ae:ce),intersectsLine:(d,u)=>{if(C.distanceSqToSegment(d.start,d.end,L,W)>a)return;L.applyMatrix4(t.matrixWorld);const l=e.ray.origin.distanceTo(L);l<e.near||l>e.far||r&&l>=v||(v=l,u=this.resolvePrimitiveIndex(u),c={distance:l,point:W.clone().applyMatrix4(s),index:u*this.primitiveStride,face:null,faceIndex:null,barycoord:null,object:t},r||n.push(c))}}),r&&c&&n.push(c),n}}class ye extends fe{get primitiveStride(){return 1}constructor(t,e={}){e={...e,indirect:!0},super(t,e)}}class ge extends ye{getRootRanges(...t){const e=super.getRootRanges(...t);return e.forEach(n=>n.count--),e}}function ve(i,t,e,n,s,r,p){const{geometry:o,primitiveStride:a}=e,{index:c}=o,v=o.attributes.position,d=c?c.count:v.count;for(let u=i,h=t+i;u<h;u++){let m=e.resolvePrimitiveIndex(u)*a,x=(m+1)%d;if(c&&(m=c.getX(m),x=c.getX(x)),p.start.fromBufferAttribute(v,m),p.end.fromBufferAttribute(v,x),n(p,u,s,r))return!0}return!1}D.prototype.raycast=ue;b.prototype.computeBoundsTree=me;b.prototype.disposeBoundsTree=he;const w={displayBVH:!1,displayDepth:10,displayParents:!1,useBVH:!0,strategy:0,indirect:!1};let f,g,R,E,F,B,y,H,T,S;xe();function xe(){F=document.getElementById("output"),f=new J({antialias:!0}),f.setPixelRatio(window.devicePixelRatio),f.setSize(window.innerWidth,window.innerHeight),f.setClearColor(1250841),f.setAnimationLoop(Me),document.body.appendChild(f.domElement),R=new Z,g=new $(75,window.innerWidth/window.innerHeight,.1,50),g.position.set(2,1,2),g.far=100,g.updateProjectionMatrix(),new ne(g,f.domElement),H=new k,H.params.Line.threshold=.01,T=new K,S=new Q(new U(.01,16,16),new j({color:16711680,transparent:!0,opacity:.75})),S.visible=!1,R.add(S),E=new oe,document.body.appendChild(E.dom),B=new D(Pe(),new ee({vertexColors:!0,linewidth:2})),y=new we(B,w.displayDepth),R.add(B,y),M();const i=new ie,t=i.addFolder("helper");t.add(w,"displayBVH"),t.add(w,"displayParents").onChange(n=>{y.displayParents=n,y.update()}),t.add(w,"displayDepth",1,25,1).name("depth").onChange(n=>{y.depth=parseInt(n),y.update()}),t.open();const e=i.addFolder("lines");e.add(w,"useBVH").onChange(M),e.add(w,"strategy",{CENTER:pe,AVERAGE:le,SAH:de}).onChange(M),e.add(w,"indirect").onChange(M),e.open(),window.addEventListener("resize",Ce,!1),window.addEventListener("pointermove",He,!1)}function Be(i){const t=[],e=new P,n=new P,s=new P,r=new P,p=(o,a)=>{const h=o*Math.PI*2,l=3*h,m=10*h,x=(1+.4*Math.cos(m))*Math.cos(l),V=(1+.4*Math.cos(m))*Math.sin(l),G=.4*Math.sin(m);a.set(x,V,G)};for(let o=0;o<=i;o++){const a=o/i,c=a+1e-4;p(a,s),p(c,r),e.copy(s).normalize(),n.subVectors(r,s).normalize(),e.applyAxisAngle(n,1e3*a*2*Math.PI),s.addScaledVector(e,.05*(Math.sin(50*a*Math.PI)+2)),t.push(s.clone())}return t}function Pe(){const i=[],t=[],e=Be(1e6),n=new te;for(let r=0;r<e.length-1;r++){const p=e[r],o=r/(e.length-1);n.setHSL(o*3,1,.6),i.push(p.x,p.y,p.z),t.push(n.r,n.g,n.b)}const s=new b;return s.setAttribute("position",new A(i,3)),s.setAttribute("color",new A(t,3)),s}function M(){w.useBVH?(console.time("LineBVH"),B.geometry.computeBoundsTree({strategy:parseInt(w.strategy),indirect:w.indirect,type:ge}),console.timeEnd("LineBVH")):B.geometry.disposeBoundsTree(),y.update()}function Se(){H.setFromCamera(T,g),H.firstHitOnly=!0;const i=window.performance.now(),t=H.intersectObject(B),e=window.performance.now()-i,n=t[0];n?(S.position.copy(n.point),S.visible=!0):S.visible=!1,F.innerText=`${e.toFixed(2)}ms`}function He(i){T.x=i.clientX/window.innerWidth*2-1,T.y=-(i.clientY/window.innerHeight)*2+1}function Ce(){g.aspect=window.innerWidth/window.innerHeight,g.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)}function Me(){y&&(y.visible=w.displayBVH),B.rotation.y=performance.now()*1e-4,Se(),f.render(R,g),E.update()}
//# sourceMappingURL=lineIntersection-PCH2MvT8.js.map
