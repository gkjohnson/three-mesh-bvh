import{W as G,c as R,d as T,D as A,A as W,P as D,G as j,k,J as L,M as I,e as O,f as z,ah as N,C as U,g as M,ak as q,n as P,j as J,V,af as Q,a9 as X}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{O as Y}from"./OrbitControls-DEZHvbFX.js";import{g as $}from"./lil-gui.module.min-BH_YJbPT.js";import{S as K}from"./stats.min-DbzWzcqd.js";import{O as Z,o as _}from"./ObjectBVH-DzrY0qF4.js";import{C as v,S as ee,A as te}from"./MeshBVH-DQV6PBDm.js";import{B as ne}from"./BVHHelper-DA_xcAFF.js";import"./_commonjsHelpers-CqkleIqs.js";const n={mode:"batched",animate:!0,useBVH:!0,strategy:v,precise:!1,includeInstances:!0,showHelper:!1,helperDepth:15,helperParents:!1,firstHitOnly:!0};let p,h,m,x,C,d,i,g,H,b,F;ae();S();function ae(){F=document.getElementById("output"),p=new G({antialias:!0}),p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.setClearColor(1250841,1),p.setAnimationLoop(re),document.body.appendChild(p.domElement),h=new R,h.fog=new T(1250841,0,10);const a=new A(16777215,2.5);a.position.set(1,2,1);const e=new A(16777215,.75);e.position.set(-1,-2,-1),h.add(a,e,new W(16777215,.75)),m=new D(75,window.innerWidth/window.innerHeight,.1,200),m.position.set(18,10,0),x=new Y(m,p.domElement),x.enablePan=!1,x.enableDamping=!0,d=new j,h.add(d),g=new k,H=new L,b=new I(new O(.1,16,16),new z({color:16776960,transparent:!0,opacity:.75,fog:!1})),b.visible=!1,h.add(b),C=new K,document.body.appendChild(C.dom),oe(),window.addEventListener("resize",()=>{m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),p.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("pointermove",o=>{H.x=o.clientX/window.innerWidth*2-1,H.y=-(o.clientY/window.innerHeight)*2+1})}function oe(){const a=new $;a.add(n,"mode",["group","instanced","batched","mix"]).onChange(S),a.add(n,"animate");const e=a.addFolder("BVH");e.add(n,"useBVH").onChange(w),e.add(n,"strategy",{CENTER:v,AVERAGE:te,SAH:ee}).onChange(w),e.add(n,"precise").onChange(w),e.add(n,"includeInstances").onChange(w),e.add(n,"firstHitOnly").onChange(()=>g.firstHitOnly=n.firstHitOnly),e.open();const o=a.addFolder("Helper");o.add(n,"showHelper"),o.add(n,"helperDepth",1,20,1).onChange(t=>{i&&(i.depth=t,i.update())}),o.add(n,"helperParents").onChange(t=>{i&&(i.displayParents=t,i.update())})}function se(){de(d);const a=1e4,e=[new N(.25,.1,30,30),new O(.25,30,30)],o=[15277667,240116,5025616,16761095,10233776].map(s=>new U(s)),t={group:0,instanced:0,batched:0};switch(n.mode){case"group":t.group=a;break;case"instanced":t.instanced=a;break;case"batched":t.batched=a;break;case"mix":t.group=t.instanced=t.batched=Math.ceil(a/3);break}if(t.group){const s=o.map(c=>new M({color:c}));for(let c=0;c<t.group;c++){const r=new I(e[c%e.length],s[c%s.length]);B(r.matrix).decompose(r.position,r.quaternion,r.scale),d.add(r)}}if(t.instanced&&e.forEach(s=>{const c=Math.ceil(t.instanced/e.length),r=new q(s,new M,c),y=new P;for(let f=0;f<c;f++)r.setMatrixAt(f,B(y)),r.setColorAt(f,o[f%o.length]);d.add(r)}),t.batched){const s=e.reduce((l,u)=>l+u.attributes.position.count,0),c=e.reduce((l,u)=>{var E;return l+(((E=u.index)==null?void 0:E.count)||0)},0),r=new J(t.batched,s,c,new M),y=e.map(l=>r.addGeometry(l)),f=new P;for(let l=0;l<t.batched;l++){const u=r.addInstance(y[l%y.length]);r.setMatrixAt(u,B(f)),r.setColorAt(u,o[l%o.length])}d.add(r)}}function w(){i&&(i.dispose(),h.remove(i),i=null),d.boundsTree=null,n.useBVH&&(console.time("BVH Build"),d.updateMatrixWorld(),d.boundsTree=new Z(d,{strategy:n.strategy,precise:n.precise,includeInstances:n.includeInstances}),d.raycast=_,console.timeEnd("BVH Build"),i=new ne(d,d.sceneBoundsTree,n.helperDepth),i.displayParents=n.displayParents,i.color.set(16777215),i.opacity=.6,h.add(i))}function S(){se(),w()}function ie(){g.setFromCamera(H,m),g.firstHitOnly=n.firstHitOnly;const a=performance.now(),e=g.intersectObject(d,!0);F.innerText=`${(performance.now()-a).toFixed(3)}ms`,b.visible=e.length>0,e.length&&b.position.copy(e[0].point)}function re(){C.begin(),i&&(i.visible=n.showHelper),n.animate&&(d.rotation.y+=5e-4),h.fog.near=m.position.length()-7.5,h.fog.far=m.position.length()+5,x.update(),ie(),p.render(h,m),C.end()}function B(a){const e=Math.cbrt(Math.random()),o=new V().randomDirection().multiplyScalar(10*e*e),t=new Q().setFromEuler(new X(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2)),s=new V().setScalar(.25+Math.random()*.75);return a.compose(o,t,s)}function de(a){var e,o,t;for(;a.children.length;){const s=a.children[0];(e=s.geometry)==null||e.dispose(),(o=s.material)==null||o.dispose(),(t=s.dispose)==null||t.call(s),a.remove(s)}}
//# sourceMappingURL=objectbvh_sceneRaycast-BqjxtEpl.js.map
