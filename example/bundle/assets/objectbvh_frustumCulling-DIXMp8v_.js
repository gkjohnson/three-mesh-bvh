import{W as E,P as A,ag as v,c as F,d as O,D as V,A as D,ah as I,e as T,ai as G,C as j,j as z,g as N,n as y,V as S,af as R,a9 as L,aj as k,K as U}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{O as $}from"./OrbitControls-DEZHvbFX.js";import{g as K}from"./lil-gui.module.min-BH_YJbPT.js";import{S as Q}from"./stats.min-DbzWzcqd.js";import{R as _}from"./RoundedBoxGeometry-BprMXSMI.js";import{a as q}from"./BufferGeometryUtils-BuPYlHUL.js";import{O as J}from"./ObjectBVH-DzrY0qF4.js";import{I as X,a as Y}from"./MeshBVH-DQV6PBDm.js";import{B as Z}from"./BVHHelper-DA_xcAFF.js";import"./_commonjsHelpers-CqkleIqs.js";const s={animate:!0,thirdPerson:!1,useBVH:!0,checkBoundingSphere:!1,showHelper:!1,helperDepth:25,helperParents:!1};let p,c,i,h,M,C,b,o,t,g,W;ee();te();function ee(){W=document.getElementById("output"),p=new E({antialias:!0}),p.setPixelRatio(window.devicePixelRatio),p.setSize(window.innerWidth,window.innerHeight),p.setClearColor(1250841,1),p.setAnimationLoop(re),document.body.appendChild(p.domElement),i=new A(75,window.innerWidth/window.innerHeight,.1,100),i.position.set(18,10,0),h=new A(75,window.innerWidth/window.innerHeight,.1,800),h.position.set(0,20,400),h.lookAt(0,0,0),g=new v(i),c=new F,c.fog=new O(1250841,25,i.far),c.add(g);const d=new V(16777215,2.5);d.position.set(1,2,1);const a=new V(16777215,.75);a.position.set(-1,-2,-1),c.add(d,a,new D(16777215,.75)),M=new $(i,p.domElement),M.enablePan=!1,M.enableDamping=!0,C=new Q,document.body.appendChild(C.dom);const n=new K;n.add(s,"animate"),n.add(s,"thirdPerson"),n.add(s,"useBVH"),n.add(s,"checkBoundingSphere");const m=n.addFolder("Helper");m.add(s,"showHelper"),m.add(s,"helperDepth",1,25,1).onChange(f=>{o&&(o.depth=f,o.update())}),m.add(s,"helperParents").onChange(f=>{o&&(o.displayParents=f,o.update())}),window.addEventListener("resize",()=>{i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),h.aspect=window.innerWidth/window.innerHeight,h.updateProjectionMatrix(),g.update(),p.setSize(window.innerWidth,window.innerHeight)})}function te(){const a=[new I(.25,.1,30,30),new T(.25,30,30),new G(.25,.25),q(new _(.25,.25,.5,4,1))],n=[15277667,240116,5025616,16761095,10233776].map(r=>new j(r)),m=a.reduce((r,e)=>r+e.attributes.position.count,0),f=a.reduce((r,e)=>{var l;return r+(((l=e.index)==null?void 0:l.count)||0)},0);t=new z(5e5,m,f,new N({roughness:.5})),t.sortObjects=!1;const u=a.map(r=>t.addGeometry(r)),w=new y;for(let r=0;r<5e5;r++){const e=t.addInstance(u[r%u.length]);t.setMatrixAt(e,oe(w)),t.setColorAt(e,n[r%n.length]),t.setVisibleAt(e,!1)}c.add(t),c.updateMatrixWorld(),b=new J(t),o=new Z(t,b,s.helperDepth),o.color.set(16777215),o.opacity=.1,o.instanceId=-1,c.add(o)}function ne(){const{useBVH:d,checkBoundingSphere:a}=s;t.perObjectFrustumCulled=!d;for(let e=0;e<t.instanceCount;e++)t.setVisibleAt(e,!d);if(!d)return;i.updateMatrixWorld();const n=new k,m=new y().multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(t.matrixWorld);n.setFromProjectionMatrix(m,i.coordinateSystem,i.reversedDepth);const f=new y().copy(b.matrixWorld).invert(),u=new y,w=new U,r=new S;b.shapecast({intersectsBounds:e=>{if(!n.intersectsBox(e))return;const{min:l,max:x}=e;for(let H=-1;H<=1;H+=2)for(let P=-1;P<=1;P+=2)for(let B=-1;B<=1;B+=2)if(r.set(H<0?l.x:x.x,P<0?l.y:x.y,B<0?l.z:x.z),!n.containsPoint(r))return X;return Y},intersectsObject:(e,l)=>{if(a){const x=e.getGeometryIdAt(l);e.getMatrixAt(l,u),u.premultiply(e.matrixWorld).premultiply(f),e.getBoundingSphereAt(x,w),w.applyMatrix4(u),n.intersectsSphere(w)&&e.setVisibleAt(l,!0)}else e.setVisibleAt(l,!0)}})}function re(){C.begin(),o&&(o.visible=s.showHelper),s.animate&&(t.rotation.y+=5e-4),M.update();const d=performance.now();ne(),s.thirdPerson?(o.opacity=.05,g.visible=!0,c.fog.far=1e10,p.render(c,h)):(o.opacity=.5,g.visible=!1,c.fog.far=i.far,p.render(c,i));const a=performance.now()-d;W.innerText=`render: ${a.toFixed(2)}ms
visible: ${t._multiDrawCount}`,C.end()}function oe(d){const a=Math.cbrt(Math.random()),n=new S().randomDirection().multiplyScalar(300*a),m=new R().setFromEuler(new L(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2)),f=new S().setScalar(1+Math.random()*3);return d.compose(n,m,f)}
//# sourceMappingURL=objectbvh_frustumCulling-DIXMp8v_.js.map
