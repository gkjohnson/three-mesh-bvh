{"version":3,"file":"shapecast-YtPvDHDW.js","sources":["../../shapecast.js"],"sourcesContent":["import Stats from 'stats.js';\nimport * as dat from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { TransformControls } from 'three/examples/jsm/controls/TransformControls.js';\nimport { acceleratedRaycast, computeBoundsTree, disposeBoundsTree, BVHHelper } from 'three-mesh-bvh';\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nconst params = {\n\tspeed: 1,\n\tdisplayBVH: false,\n\tdisplayDepth: 10,\n\tshape: 'sphere',\n\tposition: new THREE.Vector3(),\n\trotation: new THREE.Euler(),\n\tscale: new THREE.Vector3( 1, 1, 1 ),\n};\n\nlet stats, scene, camera, renderer, orbitControls, bvhHelper, transformControls;\nlet targetMesh, shapes;\nlet lastTime = window.performance.now();\n\ninit();\nupdateFromOptions();\n\nfunction init() {\n\n\tconst bgColor = 0x131619;\n\n\t// Renderer\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// Scene\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( bgColor, 20, 60 );\n\n\t// Lights\n\tconst light = new THREE.DirectionalLight( 0xffffff, 1.5 );\n\tlight.position.set( 1, 1, 1 );\n\tscene.add( light, new THREE.AmbientLight( 0xffffff, 1.2 ) );\n\n\t// Target mesh\n\tconst knotGeometry = new THREE.TorusKnotGeometry( 1, 0.4, 400, 100 );\n\tconst material = new THREE.MeshPhongMaterial( { color: 0xffffff, side: THREE.DoubleSide } );\n\ttargetMesh = new THREE.Mesh( knotGeometry, material );\n\ttargetMesh.geometry.computeBoundsTree();\n\tscene.add( targetMesh );\n\n\t// Camera\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100 );\n\tcamera.position.set( 3, 3, 3 );\n\n\t// Controls\n\ttransformControls = new TransformControls( camera, renderer.domElement );\n\tscene.add( transformControls.getHelper() );\n\n\torbitControls = new OrbitControls( camera, renderer.domElement );\n\n\t// Stats\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\t// Intersection shapes\n\tconst shapeMaterial = new THREE.MeshStandardMaterial( {\n\t\tmetalness: 0.1,\n\t\ttransparent: true,\n\t\topacity: 0.75,\n\t\tpremultipliedAlpha: true\n\t} );\n\n\tshapes = {\n\t\tsphere: new THREE.Mesh( new THREE.SphereGeometry( 1, 50, 50 ), shapeMaterial ),\n\t\tbox: new THREE.Mesh( new THREE.BoxGeometry( 1, 1, 1 ), shapeMaterial ),\n\t\tgeometry: new THREE.Mesh( new THREE.TorusKnotGeometry( 0.5, 0.2, 200, 50 ), shapeMaterial ),\n\t};\n\n\tshapes.geometry.geometry.computeBoundsTree();\n\tObject.values( shapes ).forEach( shape => scene.add( shape ) );\n\n\t// GUI\n\tconst gui = new dat.GUI();\n\tgui.add( params, 'speed', 0, 10 );\n\tgui.add( params, 'displayBVH' ).onChange( updateFromOptions );\n\tgui.add( params, 'displayDepth', 1, 40, 1 ).onChange( v => {\n\n\t\tif ( bvhHelper ) {\n\n\t\t\tbvhHelper.depth = v;\n\t\t\tbvhHelper.update();\n\n\t\t}\n\n\t} );\n\tgui.add( params, 'shape', [ 'sphere', 'box', 'geometry' ] );\n\tgui.add( transformControls, 'mode', [ 'translate', 'rotate' ] );\n\n\tconst posFolder = gui.addFolder( 'Position' );\n\tposFolder.add( params.position, 'x', - 5, 5, 0.001 );\n\tposFolder.add( params.position, 'y', - 5, 5, 0.001 );\n\tposFolder.add( params.position, 'z', - 5, 5, 0.001 );\n\tposFolder.open();\n\n\tconst rotFolder = gui.addFolder( 'Rotation' );\n\trotFolder.add( params.rotation, 'x', - Math.PI, Math.PI, 0.001 );\n\trotFolder.add( params.rotation, 'y', - Math.PI, Math.PI, 0.001 );\n\trotFolder.add( params.rotation, 'z', - Math.PI, Math.PI, 0.001 );\n\trotFolder.open();\n\n\tgui.open();\n\n\t// Transform controls sync with GUI\n\ttransformControls.addEventListener( 'change', () => {\n\n\t\tparams.position.copy( shapes[ params.shape ].position );\n\t\tparams.rotation.copy( shapes[ params.shape ].rotation );\n\t\tparams.scale.copy( shapes[ params.shape ].scale );\n\t\tgui.controllersRecursive().forEach( c => c.updateDisplay() );\n\n\t} );\n\n\t// Disable orbit controls when using transform controls\n\ttransformControls.addEventListener( 'mouseDown', () => orbitControls.enabled = false );\n\ttransformControls.addEventListener( 'mouseUp', () => orbitControls.enabled = true );\n\torbitControls.addEventListener( 'start', () => transformControls.enabled = false );\n\torbitControls.addEventListener( 'end', () => transformControls.enabled = true );\n\n\t// Keyboard shortcuts\n\twindow.addEventListener( 'keydown', e => {\n\n\t\tif ( e.key === 'w' ) transformControls.mode = 'translate';\n\t\tif ( e.key === 'e' ) transformControls.mode = 'rotate';\n\t\tgui.controllersRecursive().forEach( c => c.updateDisplay() );\n\n\t} );\n\n\twindow.addEventListener( 'resize', () => {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t} );\n\n}\n\nfunction updateFromOptions() {\n\n\t// Update bounds visualization\n\tif ( bvhHelper && ! params.displayBVH ) {\n\n\t\tscene.remove( bvhHelper );\n\t\tbvhHelper = null;\n\n\t}\n\n\tif ( ! bvhHelper && params.displayBVH ) {\n\n\t\tbvhHelper = new BVHHelper( targetMesh );\n\t\tscene.add( bvhHelper );\n\n\t}\n\n}\n\nfunction render() {\n\n\tconst delta = window.performance.now() - lastTime;\n\tlastTime = window.performance.now();\n\n\ttargetMesh.rotation.y += params.speed * delta * 0.001;\n\ttargetMesh.updateMatrixWorld();\n\n\tstats.begin();\n\n\tif ( bvhHelper ) bvhHelper.visible = params.displayBVH;\n\n\t// Hide all shapes, then show and update the selected one\n\tObject.values( shapes ).forEach( shape => shape.visible = false );\n\n\tconst shape = shapes[ params.shape ];\n\tshape.visible = true;\n\tshape.position.copy( params.position );\n\tshape.rotation.copy( params.rotation );\n\tshape.scale.copy( params.scale );\n\n\tconst transformMatrix = new THREE.Matrix4()\n\t\t.copy( targetMesh.matrixWorld )\n\t\t.invert()\n\t\t.multiply( shape.matrixWorld );\n\n\t// Perform intersection test\n\tlet hit = false;\n\tif ( params.shape === 'sphere' ) {\n\n\t\tconst sphere = new THREE.Sphere( undefined, 1 );\n\t\tsphere.applyMatrix4( transformMatrix );\n\t\thit = targetMesh.geometry.boundsTree.intersectsSphere( sphere );\n\n\t} else if ( params.shape === 'box' ) {\n\n\t\tconst box = new THREE.Box3();\n\t\tbox.min.set( - 0.5, - 0.5, - 0.5 );\n\t\tbox.max.set( 0.5, 0.5, 0.5 );\n\t\thit = targetMesh.geometry.boundsTree.intersectsBox( box, transformMatrix );\n\n\t} else if ( params.shape === 'geometry' ) {\n\n\t\thit = targetMesh.geometry.boundsTree.intersectsGeometry( shape.geometry, transformMatrix );\n\n\t}\n\n\t// Update material based on intersection\n\tshape.material.color.set( hit ? 0xE91E63 : 0x666666 );\n\tshape.material.emissive.set( 0xE91E63 ).multiplyScalar( hit ? 0.25 : 0 );\n\n\t// Attach transform controls to active shape\n\tif ( transformControls.object !== shape ) transformControls.attach( shape );\n\n\trenderer.render( scene, camera );\n\tstats.end();\n\n}\n"],"names":["THREE.Mesh","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","params","THREE.Vector3","THREE.Euler","stats","scene","camera","renderer","orbitControls","bvhHelper","transformControls","targetMesh","shapes","lastTime","init","updateFromOptions","THREE.WebGLRenderer","render","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","THREE.AmbientLight","knotGeometry","THREE.TorusKnotGeometry","material","THREE.MeshPhongMaterial","THREE.DoubleSide","THREE.PerspectiveCamera","TransformControls","OrbitControls","Stats","shapeMaterial","THREE.MeshStandardMaterial","THREE.SphereGeometry","THREE.BoxGeometry","shape","gui","dat.GUI","v","posFolder","rotFolder","c","e","BVHHelper","delta","transformMatrix","THREE.Matrix4","hit","sphere","THREE.Sphere","box","THREE.Box3"],"mappings":"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"}