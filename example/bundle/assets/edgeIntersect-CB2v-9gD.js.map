{"version":3,"file":"edgeIntersect-CB2v-9gD.js","sources":["../../edgeIntersect.js"],"sourcesContent":["import Stats from 'stats.js';\nimport * as dat from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { acceleratedRaycast, computeBoundsTree, disposeBoundsTree, SAH } from 'three-mesh-bvh';\n\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nconst params = {\n\tposition: new THREE.Vector3(),\n\trotation: new THREE.Euler(),\n\tscale: new THREE.Vector3( 1, 1, 1 ),\n\tspeed: 1,\n\tdisplayMeshes: false,\n\tdistance: 1.1,\n};\n\nlet stats;\nlet scene, camera, renderer, orbitControls;\nlet mesh1, mesh2, lineGroup, line, bgLine;\nlet depth1, depth2, group1, group2;\nlet lastTime = window.performance.now();\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0x66093a;\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( 0x263238 / 2, 20, 60 );\n\n\tconst light = new THREE.DirectionalLight( 0xffffff, 0.5 );\n\tlight.position.set( 1, 1, 1 );\n\tscene.add( light );\n\tscene.add( new THREE.AmbientLight( 0xffffff, 0.4 ) );\n\n\t// geometry setup\n\tconst radius = 1;\n\tconst tube = 0.4;\n\tconst tubularSegments = 100;\n\tconst radialSegments = 40;\n\n\tconst geometry = new THREE.TorusKnotGeometry( radius, tube, tubularSegments, radialSegments );\n\tconst material = new THREE.MeshPhongMaterial( {\n\t\tcolor: 0xffffff,\n\t\tside: THREE.DoubleSide,\n\t\tshininess: 0.01,\n\t\tpolygonOffset: true,\n\t\tpolygonOffsetFactor: 1,\n\t\tpolygonOffsetUnits: 1,\n\t\topacity: 0.5,\n\t\tblending: THREE.CustomBlending\n\t} );\n\tconst depthMaterial = new THREE.MeshBasicMaterial( {\n\t\tpolygonOffset: true,\n\t\tpolygonOffsetFactor: 1,\n\t\tpolygonOffsetUnits: 1,\n\t\tcolorWrite: false,\n\t} );\n\n\t// const geometry = new THREE.BoxGeometry();\n\n\t// const geometry = new THREE.BufferGeometry();\n\t// geometry.setFromPoints( [\n\t// \tnew THREE.Vector3( 1, 0, 0 ),\n\t// \tnew THREE.Vector3( - 1, 0, 0 ),\n\t// \tnew THREE.Vector3( 0, 1, 0 ),\n\t// ] );\n\t// geometry.computeVertexNormals();\n\tgeometry.computeBoundsTree( { maxLeafSize: 1, strategy: SAH } );\n\n\tgroup1 = new THREE.Group();\n\tmesh1 = new THREE.Mesh( geometry, material );\n\tmesh1.renderOrder = 2;\n\tdepth1 = new THREE.Mesh( geometry, depthMaterial );\n\tdepth1.renderOrder = 1;\n\tgroup1.add( depth1, mesh1 );\n\n\tgroup2 = new THREE.Group();\n\tmesh2 = new THREE.Mesh( geometry, material );\n\tmesh2.renderOrder = 2;\n\tdepth2 = new THREE.Mesh( geometry, depthMaterial );\n\tdepth2.renderOrder = 1;\n\tgroup2.add( depth2, mesh2 );\n\n\tscene.add( group1, group2 );\n\n\tconst lineGeometry = new THREE.BufferGeometry();\n\tlineGeometry.setFromPoints( [ new THREE.Vector3( 0, 1, 0 ), new THREE.Vector3( 0, - 1, 0 ) ] );\n\tline = new THREE.LineSegments( lineGeometry, new THREE.LineBasicMaterial( { color: 0xe88baa } ) );\n\n\tbgLine = line.clone();\n\tbgLine.material = new THREE.LineBasicMaterial( {\n\t\tcolor: 0xE91E63,\n\t\ttransparent: true,\n\t\topacity: 0.25,\n\t\tdepthFunc: THREE.GreaterDepth,\n\t} );\n\tbgLine.renderOrder = 3;\n\n\tlineGroup = new THREE.Group();\n\tlineGroup.add( line, bgLine );\n\tscene.add( lineGroup );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 2, 2, 2 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\torbitControls = new OrbitControls( camera, renderer.domElement );\n\n\t// stats setup\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\tconst gui = new dat.GUI();\n\tgui.add( params, 'speed', 0, 10, 0.001 );\n\tgui.add( params, 'distance', 0, 1.5, 0.001 );\n\tgui.add( params, 'displayMeshes' );\n\n\tgui.open();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n}\n\nfunction render() {\n\n\tconst delta = window.performance.now() - lastTime;\n\tlastTime = window.performance.now();\n\n\tgroup1.position.y = - params.distance;\n\tgroup1.rotation.x -= delta * 3 * 0.0001 * params.speed * 0.5;\n\tgroup1.rotation.y -= delta * 1 * 0.0001 * params.speed * 0.5;\n\tgroup1.rotation.z -= delta * 2 * 0.0001 * params.speed * 0.5;\n\n\tgroup2.position.y = params.distance;\n\tgroup2.rotation.x += delta * 0.0001 * params.speed;\n\tgroup2.rotation.y += delta * 2 * 0.0001 * params.speed;\n\tgroup2.rotation.z += delta * 3 * 0.0001 * params.speed;\n\n\tscene.updateMatrixWorld( true );\n\n\tconst matrix2to1 = new THREE.Matrix4()\n\t\t.copy( mesh1.matrixWorld )\n\t\t.invert()\n\t\t.multiply( mesh2.matrixWorld );\n\n\n\tconst edge = new THREE.Line3();\n\tconst results = [];\n\tmesh1.geometry.boundsTree.bvhcast( mesh2.geometry.boundsTree, matrix2to1, {\n\n\t\tintersectsTriangles( triangle1, triangle2 ) {\n\n\t\t\tif ( triangle1.intersectsTriangle( triangle2, edge ) ) {\n\n\t\t\t\tconst { start, end } = edge;\n\t\t\t\tresults.push(\n\t\t\t\t\tstart.x,\n\t\t\t\t\tstart.y,\n\t\t\t\t\tstart.z,\n\t\t\t\t\tend.x,\n\t\t\t\t\tend.y,\n\t\t\t\t\tend.z,\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\tif ( results.length ) {\n\n\t\tconst geometry = line.geometry;\n\t\tconst posArray = geometry.attributes.position.array;\n\t\tif ( posArray.length < results.length ) {\n\n\t\t\tgeometry.dispose();\n\t\t\tgeometry.setAttribute( 'position', new THREE.BufferAttribute( new Float32Array( results ), 3, false ) );\n\n\t\t} else {\n\n\t\t\tposArray.set( results );\n\n\t\t}\n\n\t\tgeometry.setDrawRange( 0, results.length / 3 );\n\t\tgeometry.attributes.position.needsUpdate = true;\n\t\tlineGroup.position.copy( group1.position );\n\t\tlineGroup.rotation.copy( group1.rotation );\n\t\tlineGroup.scale.copy( group1.scale );\n\t\tlineGroup.visible = true;\n\n\t} else {\n\n\t\tlineGroup.visible = false;\n\n\t}\n\n\tgroup1.visible = params.displayMeshes;\n\tgroup2.visible = params.displayMeshes;\n\trenderer.render( scene, camera );\n\n\tstats.begin();\n\tstats.end();\n\n}\n\n"],"names":["THREE.Mesh","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","params","THREE.Vector3","THREE.Euler","stats","scene","camera","renderer","mesh1","mesh2","lineGroup","line","bgLine","depth1","depth2","group1","group2","lastTime","init","THREE.WebGLRenderer","render","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","THREE.AmbientLight","radius","tube","tubularSegments","radialSegments","geometry","THREE.TorusKnotGeometry","material","THREE.MeshPhongMaterial","THREE.DoubleSide","THREE.CustomBlending","depthMaterial","THREE.MeshBasicMaterial","SAH","THREE.Group","lineGeometry","THREE.LineSegments","THREE.LineBasicMaterial","THREE.GreaterDepth","THREE.PerspectiveCamera","OrbitControls","Stats","gui","dat.GUI","delta","matrix2to1","THREE.Matrix4","edge","THREE.Line3","results","triangle1","triangle2","start","end","posArray","THREE.BufferAttribute"],"mappings":"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"}