import{V as P,b as K,n as j,o as I,W as O,p as q,c as J,d as N,D as Q,q as U,P as X,M as B,g as R,G as Y,h as Z}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{R as _}from"./RoundedBoxGeometry-BprMXSMI.js";import{G as $}from"./GLTFLoader-Be-eETKy.js";import{O as ee}from"./OrbitControls-DEZHvbFX.js";import{m as te}from"./BufferGeometryUtils-BuPYlHUL.js";import{S as ae}from"./stats.min-DbzWzcqd.js";import{g as oe}from"./lil-gui.module.min-BH_YJbPT.js";import{S as se}from"./StaticGeometryGenerator-QNaaaoUl.js";import{M as ie}from"./MeshBVH-DQV6PBDm.js";import{B as ne}from"./BVHHelper-DA_xcAFF.js";import"./_commonjsHelpers-CqkleIqs.js";const a={firstPerson:!1,displayCollider:!1,displayBVH:!1,displayDepth:10,gravity:-30,playerSpeed:10,physicsSteps:5,reset:L};let c,d,g,T,b,G,v,m,V,e,n,C=!1,W=!1,H=!1,D=!1,z=!1,u=new P,k=new P(0,1,0),f=new P,F=new P,M=new K,A=new j,h=new I;re();function re(){c=new O({antialias:!0}),c.setPixelRatio(window.devicePixelRatio),c.setSize(window.innerWidth,window.innerHeight),c.setClearColor(1251612,1),c.setAnimationLoop(pe),c.shadowMap.enabled=!0,c.shadowMap.type=q,document.body.appendChild(c.domElement),g=new J,g.fog=new N(1251612,20,70);const t=new Q(16777215,3);t.position.set(1,1.5,1).multiplyScalar(50),t.shadow.mapSize.setScalar(2048),t.shadow.bias=-1e-4,t.shadow.normalBias=.05,t.castShadow=!0;const s=t.shadow.camera;s.bottom=s.left=-30,s.top=30,s.right=45,g.add(t),g.add(new U(16777215,2241348,.4)),d=new X(75,window.innerWidth/window.innerHeight,.1,50),d.position.set(10,10,-10),d.far=100,d.updateProjectionMatrix(),window.camera=d,T=new Z,n=new ee(d,c.domElement),G=new ae,document.body.appendChild(G.dom),de(),e=new B(new _(1,2,1,10,.5),new R),e.geometry.translate(0,-.5,0),e.capsuleInfo={radius:.5,segment:new I(new P,new P(0,-1,0))},e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2,g.add(e),L(),b=new oe,b.add(a,"firstPerson").onChange(r=>{r||d.position.sub(n.target).normalize().multiplyScalar(10).add(n.target)});const p=b.addFolder("Visualization");p.add(a,"displayCollider"),p.add(a,"displayBVH"),p.add(a,"displayDepth",1,20,1).onChange(r=>{V.depth=r,V.update()}),p.open();const i=b.addFolder("Player");i.add(a,"physicsSteps",0,30,1),i.add(a,"gravity",-100,100,.01).onChange(r=>{a.gravity=parseFloat(r)}),i.add(a,"playerSpeed",1,20),i.open(),b.add(a,"reset"),b.open(),window.addEventListener("resize",function(){d.aspect=window.innerWidth/window.innerHeight,d.updateProjectionMatrix(),c.setSize(window.innerWidth,window.innerHeight)},!1),window.addEventListener("keydown",function(r){switch(r.code){case"KeyW":W=!0;break;case"KeyS":H=!0;break;case"KeyD":z=!0;break;case"KeyA":D=!0;break;case"Space":C&&(u.y=10,C=!1);break}}),window.addEventListener("keyup",function(r){switch(r.code){case"KeyW":W=!1;break;case"KeyS":H=!1;break;case"KeyD":z=!1;break;case"KeyA":D=!1;break}})}function de(){new $().load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/dungeon-warkarma/scene.gltf",l=>{const t=l.scene;t.scale.setScalar(.01);const s=new K;s.setFromObject(t),s.getCenter(t.position).negate(),t.updateMatrixWorld(!0);const p={};t.traverse(o=>{if(!(/Boss/.test(o.name)||/Enemie/.test(o.name)||/Shield/.test(o.name)||/Sword/.test(o.name)||/Character/.test(o.name)||/Gate/.test(o.name)||/Cube/.test(o.name)||o.material&&o.material.color.r===1)&&o.isMesh){const S=o.material.color.getHex();p[S]=p[S]||[],p[S].push(o)}}),v=new Y;for(const o in p){const S=p[o],x=[];if(S.forEach(y=>{if(y.material.emissive.r!==0)v.attach(y);else{const w=y.geometry.clone();w.applyMatrix4(y.matrixWorld),x.push(w)}}),x.length){const y=te(x),w=new B(y,new R({color:parseInt(o),shadowSide:2}));w.castShadow=!0,w.receiveShadow=!0,w.material.shadowSide=2,v.add(w)}}const i=new se(v);i.attributes=["position"];const r=i.generate();r.boundsTree=new ie(r),m=new B(r),m.material.wireframe=!0,m.material.opacity=.5,m.material.transparent=!0,V=new ne(m,a.displayDepth),g.add(V),g.add(m),g.add(v)})}function L(){u.set(0,0,0),e.position.set(15.75,-3,30),d.position.sub(n.target),n.target.copy(e.position),d.position.add(e.position),n.update()}function le(l){C?u.y=l*a.gravity:u.y+=l*a.gravity,e.position.addScaledVector(u,l);const t=n.getAzimuthalAngle();W&&(f.set(0,0,-1).applyAxisAngle(k,t),e.position.addScaledVector(f,a.playerSpeed*l)),H&&(f.set(0,0,1).applyAxisAngle(k,t),e.position.addScaledVector(f,a.playerSpeed*l)),D&&(f.set(-1,0,0).applyAxisAngle(k,t),e.position.addScaledVector(f,a.playerSpeed*l)),z&&(f.set(1,0,0).applyAxisAngle(k,t),e.position.addScaledVector(f,a.playerSpeed*l)),e.updateMatrixWorld();const s=e.capsuleInfo;M.makeEmpty(),A.copy(m.matrixWorld).invert(),h.copy(s.segment),h.start.applyMatrix4(e.matrixWorld).applyMatrix4(A),h.end.applyMatrix4(e.matrixWorld).applyMatrix4(A),M.expandByPoint(h.start),M.expandByPoint(h.end),M.min.addScalar(-s.radius),M.max.addScalar(s.radius),m.geometry.boundsTree.shapecast({intersectsBounds:o=>o.intersectsBox(M),intersectsTriangle:o=>{const S=f,x=F,y=o.closestPointToSegment(h,S,x);if(y<s.radius){const w=s.radius-y,E=x.sub(S).normalize();h.start.addScaledVector(E,w),h.end.addScaledVector(E,w)}}});const p=f;p.copy(h.start).applyMatrix4(m.matrixWorld);const i=F;i.subVectors(p,e.position),C=i.y>Math.abs(l*u.y*.25);const r=Math.max(0,i.length()-1e-5);i.normalize().multiplyScalar(r),e.position.add(i),C?u.set(0,0,0):(i.normalize(),u.addScaledVector(i,-i.dot(u))),d.position.sub(n.target),n.target.copy(e.position),d.position.add(e.position),e.position.y<-25&&L()}function pe(){G.update();const l=Math.min(T.getDelta(),.1);if(a.firstPerson?(n.maxPolarAngle=Math.PI,n.minDistance=1e-4,n.maxDistance=1e-4):(n.maxPolarAngle=Math.PI/2,n.minDistance=1,n.maxDistance=20),m){m.visible=a.displayCollider,V.visible=a.displayBVH;const t=a.physicsSteps;for(let s=0;s<t;s++)le(l/t)}n.update(),c.render(g,d)}
//# sourceMappingURL=characterMovement-FPWssdkQ.js.map
