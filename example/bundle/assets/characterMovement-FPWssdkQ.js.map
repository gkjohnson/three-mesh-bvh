{"version":3,"file":"characterMovement-FPWssdkQ.js","sources":["../../characterMovement.js"],"sourcesContent":["import * as THREE from 'three';\nimport { RoundedBoxGeometry } from 'three/examples/jsm/geometries/RoundedBoxGeometry.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport * as BufferGeometryUtils from 'three/examples/jsm/utils/BufferGeometryUtils.js';\nimport Stats from 'stats.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport { MeshBVH, BVHHelper, StaticGeometryGenerator } from 'three-mesh-bvh';\n\nconst params = {\n\n\tfirstPerson: false,\n\n\tdisplayCollider: false,\n\tdisplayBVH: false,\n\tdisplayDepth: 10,\n\tgravity: - 30,\n\tplayerSpeed: 10,\n\tphysicsSteps: 5,\n\n\treset: reset,\n\n};\n\nlet renderer, camera, scene, clock, gui, stats;\nlet environment, collider, bvhHelper, player, controls;\nlet playerIsOnGround = false;\nlet fwdPressed = false, bkdPressed = false, lftPressed = false, rgtPressed = false;\nlet playerVelocity = new THREE.Vector3();\nlet upVector = new THREE.Vector3( 0, 1, 0 );\nlet tempVector = new THREE.Vector3();\nlet tempVector2 = new THREE.Vector3();\nlet tempBox = new THREE.Box3();\nlet tempMat = new THREE.Matrix4();\nlet tempSegment = new THREE.Line3();\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0x263238 / 2;\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\trenderer.shadowMap.enabled = true;\n\trenderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\tscene.fog = new THREE.Fog( bgColor, 20, 70 );\n\n\t// lights\n\tconst light = new THREE.DirectionalLight( 0xffffff, 3 );\n\tlight.position.set( 1, 1.5, 1 ).multiplyScalar( 50 );\n\tlight.shadow.mapSize.setScalar( 2048 );\n\tlight.shadow.bias = - 1e-4;\n\tlight.shadow.normalBias = 0.05;\n\tlight.castShadow = true;\n\n\tconst shadowCam = light.shadow.camera;\n\tshadowCam.bottom = shadowCam.left = - 30;\n\tshadowCam.top = 30;\n\tshadowCam.right = 45;\n\n\tscene.add( light );\n\tscene.add( new THREE.HemisphereLight( 0xffffff, 0x223344, 0.4 ) );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 10, 10, - 10 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\twindow.camera = camera;\n\n\tclock = new THREE.Clock();\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\n\t// stats setup\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\tloadColliderEnvironment();\n\n\t// character\n\tplayer = new THREE.Mesh(\n\t\tnew RoundedBoxGeometry( 1.0, 2.0, 1.0, 10, 0.5 ),\n\t\tnew THREE.MeshStandardMaterial()\n\t);\n\tplayer.geometry.translate( 0, - 0.5, 0 );\n\tplayer.capsuleInfo = {\n\t\tradius: 0.5,\n\t\tsegment: new THREE.Line3( new THREE.Vector3(), new THREE.Vector3( 0, - 1.0, 0.0 ) )\n\t};\n\tplayer.castShadow = true;\n\tplayer.receiveShadow = true;\n\tplayer.material.shadowSide = 2;\n\tscene.add( player );\n\treset();\n\n\t// dat.gui\n\tgui = new GUI();\n\tgui.add( params, 'firstPerson' ).onChange( v => {\n\n\t\tif ( ! v ) {\n\n\t\t\tcamera\n\t\t\t\t.position\n\t\t\t\t.sub( controls.target )\n\t\t\t\t.normalize()\n\t\t\t\t.multiplyScalar( 10 )\n\t\t\t\t.add( controls.target );\n\n\t\t}\n\n\t} );\n\n\tconst visFolder = gui.addFolder( 'Visualization' );\n\tvisFolder.add( params, 'displayCollider' );\n\tvisFolder.add( params, 'displayBVH' );\n\tvisFolder.add( params, 'displayDepth', 1, 20, 1 ).onChange( v => {\n\n\t\tbvhHelper.depth = v;\n\t\tbvhHelper.update();\n\n\t} );\n\tvisFolder.open();\n\n\tconst physicsFolder = gui.addFolder( 'Player' );\n\tphysicsFolder.add( params, 'physicsSteps', 0, 30, 1 );\n\tphysicsFolder.add( params, 'gravity', - 100, 100, 0.01 ).onChange( v => {\n\n\t\tparams.gravity = parseFloat( v );\n\n\t} );\n\tphysicsFolder.add( params, 'playerSpeed', 1, 20 );\n\tphysicsFolder.open();\n\n\tgui.add( params, 'reset' );\n\tgui.open();\n\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n\twindow.addEventListener( 'keydown', function ( e ) {\n\n\t\tswitch ( e.code ) {\n\n\t\t\tcase 'KeyW': fwdPressed = true; break;\n\t\t\tcase 'KeyS': bkdPressed = true; break;\n\t\t\tcase 'KeyD': rgtPressed = true; break;\n\t\t\tcase 'KeyA': lftPressed = true; break;\n\t\t\tcase 'Space':\n\t\t\t\tif ( playerIsOnGround ) {\n\n\t\t\t\t\tplayerVelocity.y = 10.0;\n\t\t\t\t\tplayerIsOnGround = false;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n\twindow.addEventListener( 'keyup', function ( e ) {\n\n\t\tswitch ( e.code ) {\n\n\t\t\tcase 'KeyW': fwdPressed = false; break;\n\t\t\tcase 'KeyS': bkdPressed = false; break;\n\t\t\tcase 'KeyD': rgtPressed = false; break;\n\t\t\tcase 'KeyA': lftPressed = false; break;\n\n\t\t}\n\n\t} );\n\n}\n\nfunction loadColliderEnvironment() {\n\n\tnew GLTFLoader()\n\t\t.load( 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/dungeon-warkarma/scene.gltf', res => {\n\n\t\t\tconst gltfScene = res.scene;\n\t\t\tgltfScene.scale.setScalar( .01 );\n\n\t\t\tconst box = new THREE.Box3();\n\t\t\tbox.setFromObject( gltfScene );\n\t\t\tbox.getCenter( gltfScene.position ).negate();\n\t\t\tgltfScene.updateMatrixWorld( true );\n\n\t\t\t// visual geometry setup\n\t\t\tconst toMerge = {};\n\t\t\tgltfScene.traverse( c => {\n\n\t\t\t\tif (\n\t\t\t\t\t/Boss/.test( c.name ) ||\n\t\t\t\t/Enemie/.test( c.name ) ||\n\t\t\t\t/Shield/.test( c.name ) ||\n\t\t\t\t/Sword/.test( c.name ) ||\n\t\t\t\t/Character/.test( c.name ) ||\n\t\t\t\t/Gate/.test( c.name ) ||\n\n\t\t\t\t// spears\n\t\t\t\t/Cube/.test( c.name ) ||\n\n\t\t\t\t// pink brick\n\t\t\t\tc.material && c.material.color.r === 1.0\n\t\t\t\t) {\n\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tif ( c.isMesh ) {\n\n\t\t\t\t\tconst hex = c.material.color.getHex();\n\t\t\t\t\ttoMerge[ hex ] = toMerge[ hex ] || [];\n\t\t\t\t\ttoMerge[ hex ].push( c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tenvironment = new THREE.Group();\n\t\t\tfor ( const hex in toMerge ) {\n\n\t\t\t\tconst arr = toMerge[ hex ];\n\t\t\t\tconst visualGeometries = [];\n\t\t\t\tarr.forEach( mesh => {\n\n\t\t\t\t\tif ( mesh.material.emissive.r !== 0 ) {\n\n\t\t\t\t\t\tenvironment.attach( mesh );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconst geom = mesh.geometry.clone();\n\t\t\t\t\t\tgeom.applyMatrix4( mesh.matrixWorld );\n\t\t\t\t\t\tvisualGeometries.push( geom );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\tif ( visualGeometries.length ) {\n\n\t\t\t\t\tconst newGeom = BufferGeometryUtils.mergeGeometries( visualGeometries );\n\t\t\t\t\tconst newMesh = new THREE.Mesh( newGeom, new THREE.MeshStandardMaterial( { color: parseInt( hex ), shadowSide: 2 } ) );\n\t\t\t\t\tnewMesh.castShadow = true;\n\t\t\t\t\tnewMesh.receiveShadow = true;\n\t\t\t\t\tnewMesh.material.shadowSide = 2;\n\n\t\t\t\t\tenvironment.add( newMesh );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst staticGenerator = new StaticGeometryGenerator( environment );\n\t\t\tstaticGenerator.attributes = [ 'position' ];\n\n\t\t\tconst mergedGeometry = staticGenerator.generate();\n\t\t\tmergedGeometry.boundsTree = new MeshBVH( mergedGeometry );\n\n\t\t\tcollider = new THREE.Mesh( mergedGeometry );\n\t\t\tcollider.material.wireframe = true;\n\t\t\tcollider.material.opacity = 0.5;\n\t\t\tcollider.material.transparent = true;\n\n\t\t\tbvhHelper = new BVHHelper( collider, params.displayDepth );\n\t\t\tscene.add( bvhHelper );\n\t\t\tscene.add( collider );\n\t\t\tscene.add( environment );\n\n\t\t} );\n\n}\n\nfunction reset() {\n\n\tplayerVelocity.set( 0, 0, 0 );\n\tplayer.position.set( 15.75, - 3, 30 );\n\tcamera.position.sub( controls.target );\n\tcontrols.target.copy( player.position );\n\tcamera.position.add( player.position );\n\tcontrols.update();\n\n}\n\nfunction updatePlayer( delta ) {\n\n\tif ( playerIsOnGround ) {\n\n\t\tplayerVelocity.y = delta * params.gravity;\n\n\t} else {\n\n\t\tplayerVelocity.y += delta * params.gravity;\n\n\t}\n\n\tplayer.position.addScaledVector( playerVelocity, delta );\n\n\t// move the player\n\tconst angle = controls.getAzimuthalAngle();\n\tif ( fwdPressed ) {\n\n\t\ttempVector.set( 0, 0, - 1 ).applyAxisAngle( upVector, angle );\n\t\tplayer.position.addScaledVector( tempVector, params.playerSpeed * delta );\n\n\t}\n\n\tif ( bkdPressed ) {\n\n\t\ttempVector.set( 0, 0, 1 ).applyAxisAngle( upVector, angle );\n\t\tplayer.position.addScaledVector( tempVector, params.playerSpeed * delta );\n\n\t}\n\n\tif ( lftPressed ) {\n\n\t\ttempVector.set( - 1, 0, 0 ).applyAxisAngle( upVector, angle );\n\t\tplayer.position.addScaledVector( tempVector, params.playerSpeed * delta );\n\n\t}\n\n\tif ( rgtPressed ) {\n\n\t\ttempVector.set( 1, 0, 0 ).applyAxisAngle( upVector, angle );\n\t\tplayer.position.addScaledVector( tempVector, params.playerSpeed * delta );\n\n\t}\n\n\tplayer.updateMatrixWorld();\n\n\t// adjust player position based on collisions\n\tconst capsuleInfo = player.capsuleInfo;\n\ttempBox.makeEmpty();\n\ttempMat.copy( collider.matrixWorld ).invert();\n\ttempSegment.copy( capsuleInfo.segment );\n\n\t// get the position of the capsule in the local space of the collider\n\ttempSegment.start.applyMatrix4( player.matrixWorld ).applyMatrix4( tempMat );\n\ttempSegment.end.applyMatrix4( player.matrixWorld ).applyMatrix4( tempMat );\n\n\t// get the axis aligned bounding box of the capsule\n\ttempBox.expandByPoint( tempSegment.start );\n\ttempBox.expandByPoint( tempSegment.end );\n\n\ttempBox.min.addScalar( - capsuleInfo.radius );\n\ttempBox.max.addScalar( capsuleInfo.radius );\n\n\tcollider.geometry.boundsTree.shapecast( {\n\n\t\tintersectsBounds: box => box.intersectsBox( tempBox ),\n\n\t\tintersectsTriangle: tri => {\n\n\t\t\t// check if the triangle is intersecting the capsule and adjust the\n\t\t\t// capsule position if it is.\n\t\t\tconst triPoint = tempVector;\n\t\t\tconst capsulePoint = tempVector2;\n\n\t\t\tconst distance = tri.closestPointToSegment( tempSegment, triPoint, capsulePoint );\n\t\t\tif ( distance < capsuleInfo.radius ) {\n\n\t\t\t\tconst depth = capsuleInfo.radius - distance;\n\t\t\t\tconst direction = capsulePoint.sub( triPoint ).normalize();\n\n\t\t\t\ttempSegment.start.addScaledVector( direction, depth );\n\t\t\t\ttempSegment.end.addScaledVector( direction, depth );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n\t// get the adjusted position of the capsule collider in world space after checking\n\t// triangle collisions and moving it. capsuleInfo.segment.start is assumed to be\n\t// the origin of the player model.\n\tconst newPosition = tempVector;\n\tnewPosition.copy( tempSegment.start ).applyMatrix4( collider.matrixWorld );\n\n\t// check how much the collider was moved\n\tconst deltaVector = tempVector2;\n\tdeltaVector.subVectors( newPosition, player.position );\n\n\t// if the player was primarily adjusted vertically we assume it's on something we should consider ground\n\tplayerIsOnGround = deltaVector.y > Math.abs( delta * playerVelocity.y * 0.25 );\n\n\tconst offset = Math.max( 0.0, deltaVector.length() - 1e-5 );\n\tdeltaVector.normalize().multiplyScalar( offset );\n\n\t// adjust the player model\n\tplayer.position.add( deltaVector );\n\n\tif ( ! playerIsOnGround ) {\n\n\t\tdeltaVector.normalize();\n\t\tplayerVelocity.addScaledVector( deltaVector, - deltaVector.dot( playerVelocity ) );\n\n\t} else {\n\n\t\tplayerVelocity.set( 0, 0, 0 );\n\n\t}\n\n\t// adjust the camera\n\tcamera.position.sub( controls.target );\n\tcontrols.target.copy( player.position );\n\tcamera.position.add( player.position );\n\n\t// if the player has fallen too far below the level reset their position to the start\n\tif ( player.position.y < - 25 ) {\n\n\t\treset();\n\n\t}\n\n}\n\nfunction render() {\n\n\tstats.update();\n\n\tconst delta = Math.min( clock.getDelta(), 0.1 );\n\tif ( params.firstPerson ) {\n\n\t\tcontrols.maxPolarAngle = Math.PI;\n\t\tcontrols.minDistance = 1e-4;\n\t\tcontrols.maxDistance = 1e-4;\n\n\t} else {\n\n\t\tcontrols.maxPolarAngle = Math.PI / 2;\n\t\tcontrols.minDistance = 1;\n\t\tcontrols.maxDistance = 20;\n\n\t}\n\n\tif ( collider ) {\n\n\t\tcollider.visible = params.displayCollider;\n\t\tbvhHelper.visible = params.displayBVH;\n\n\t\tconst physicsSteps = params.physicsSteps;\n\n\t\tfor ( let i = 0; i < physicsSteps; i ++ ) {\n\n\t\t\tupdatePlayer( delta / physicsSteps );\n\n\t\t}\n\n\t}\n\n\t// TODO: limit the camera movement based on the collider\n\t// raycast in direction of camera and move it if it's further than the closest point\n\n\tcontrols.update();\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["params","reset","renderer","camera","scene","clock","gui","stats","environment","collider","bvhHelper","player","controls","playerIsOnGround","fwdPressed","bkdPressed","lftPressed","rgtPressed","playerVelocity","THREE.Vector3","upVector","tempVector","tempVector2","tempBox","THREE.Box3","tempMat","THREE.Matrix4","tempSegment","THREE.Line3","init","THREE.WebGLRenderer","render","THREE.PCFSoftShadowMap","THREE.Scene","THREE.Fog","light","THREE.DirectionalLight","shadowCam","THREE.HemisphereLight","THREE.PerspectiveCamera","THREE.Clock","OrbitControls","Stats","loadColliderEnvironment","THREE.Mesh","RoundedBoxGeometry","THREE.MeshStandardMaterial","GUI","v","visFolder","physicsFolder","e","GLTFLoader","res","gltfScene","box","toMerge","c","hex","THREE.Group","arr","visualGeometries","mesh","geom","newGeom","BufferGeometryUtils.mergeGeometries","newMesh","staticGenerator","StaticGeometryGenerator","mergedGeometry","MeshBVH","BVHHelper","updatePlayer","delta","angle","capsuleInfo","tri","triPoint","capsulePoint","distance","depth","direction","newPosition","deltaVector","offset","physicsSteps","i"],"mappings":"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"}