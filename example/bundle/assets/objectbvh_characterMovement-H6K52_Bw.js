import{V as g,b as X,n as ee,o as F,K as te,W as ae,ae as oe,c as se,P as ne,D as re,q as ie,G as N,g as de,M as D,e as ce,h as le,af as pe}from"./ExtendedTriangle-hsPasuNU.js";/* empty css               */import{R as Q}from"./RoundedBoxGeometry-BprMXSMI.js";import{G as me}from"./GLTFLoader-Be-eETKy.js";import{O as he}from"./OrbitControls-DEZHvbFX.js";import{S as we}from"./stats.min-DbzWzcqd.js";import{g as fe}from"./lil-gui.module.min-BH_YJbPT.js";import{O as ue}from"./ObjectBVH-DzrY0qF4.js";import{M as ye}from"./MeshBVH-DQV6PBDm.js";import{B as ge}from"./BVHHelper-DA_xcAFF.js";import"./BufferGeometryUtils-BuPYlHUL.js";import"./_commonjsHelpers-CqkleIqs.js";const c={firstPerson:!1,displayBVH:!1,visualizeDepth:10,gravity:-80,playerSpeed:10,physicsSteps:5,reset:()=>K()},Z=.05,Y=2*Math.PI,u=new g,j=new g(0,1,0),H=new g,J=new g,x=new X,b=new X,k=new ee,r=new F,C=new F,G=new te;let h,m,B,$,E,a,V,s,W,z,y,A=!1,L=Z,f=0;const p={fwd:!1,bkd:!1,lft:!1,rgt:!1};Me();h.setAnimationLoop(Pe);function Me(){h=new ae({antialias:!0}),h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.setClearColor(1250841,1),h.shadowMap.enabled=!0,h.shadowMap.type=oe,document.body.appendChild(h.domElement),B=new se,m=new ne(75,window.innerWidth/window.innerHeight,.1,200),m.position.set(15,7.5,15);const e=new re(16777215,3);e.position.set(50,75,50),e.shadow.mapSize.setScalar(2048),e.shadow.bias=-1e-4,e.shadow.normalBias=.05,e.shadow.radius=3,e.castShadow=!0;const l=e.shadow.camera;l.left=l.bottom=-30,l.top=30,l.right=45,B.add(e,new ie(16777215,2241348,.4)),a=new he(m,h.domElement),$=new le,E=new we,document.body.appendChild(E.dom),Se(),s=new N,s.rotation.y=Math.PI/2,s.capsuleInfo={radius:.75,segment:new F(new g(0,.75,0),new g(0,1,0))},W=new N,s.add(W);const t=new de({shadowSide:2}),w=new D(new Q(1,2,1,10,.5),t);w.position.y=.75,w.castShadow=w.receiveShadow=!0;const n=new D(new Q(.5,2,.5,10,.5),t);n.rotation.x=Math.PI/2,n.position.y=1.25,n.castShadow=n.receiveShadow=!0;const M=new D(new ce(.5),t);M.position.y=2,M.castShadow=M.receiveShadow=!0,W.add(w,n,M),B.add(s),K();const S=new fe;S.add(c,"firstPerson").onChange(P=>{P||m.position.sub(a.target).normalize().multiplyScalar(10).add(a.target)});const _=S.addFolder("Visualization");_.add(c,"displayBVH"),_.add(c,"visualizeDepth",1,20,1).onChange(()=>{y.depth=c.visualizeDepth,y.update()});const i=S.addFolder("Player");i.add(c,"physicsSteps",0,30,1),i.add(c,"gravity",-100,100,.01),i.add(c,"playerSpeed",1,20),S.add(c,"reset"),window.addEventListener("resize",()=>{m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}),window.addEventListener("keydown",P=>{switch(P.code){case"KeyW":p.fwd=!0;break;case"KeyS":p.bkd=!0;break;case"KeyD":p.rgt=!0;break;case"KeyA":p.lft=!0;break;case"Space":(A||L>0)&&(u.y=20,A=!1,L=0);break}}),window.addEventListener("keyup",P=>{switch(P.code){case"KeyW":p.fwd=!1;break;case"KeyS":p.bkd=!1;break;case"KeyD":p.rgt=!1;break;case"KeyA":p.lft=!1;break}})}function Se(){new me().load(new URL("./models/grandmas_house_compressed.glb",import.meta.url).toString(),o=>{const e=o.scene;e.scale.setScalar(1.75),e.updateMatrixWorld(!0);const l=[];e.traverse(t=>{var w;if((w=t.material)!=null&&w.isMeshPhysicalMaterial&&(t.material.transmission=0),/cat|sheep/.test(t.name)){t.traverse(n=>{n.material&&(n.material=n.material.clone(),n.material.color.set(16711680))}),l.push(t);return}t.castShadow=t.receiveShadow=!0,t.isMesh&&!t.geometry.boundsTree&&(t.geometry.boundsTree=new ye(t.geometry))}),l.forEach(t=>t.removeFromParent()),V=e,B.add(V),V.updateMatrixWorld(!0),z=new ue(V,{maxLeafSize:1}),y=new ge(V,z),y.opacity=.5,y.color.set(16777215),y.update(),B.add(y)})}function K(){u.set(0,0,0),s.position.set(8,10,2.5),m.position.sub(a.target),a.target.copy(s.position),m.position.add(s.position),a.update()}function xe(o){s.updateMatrixWorld(),k.copy(z.matrixWorld).invert();const e=s.capsuleInfo;r.copy(e.segment).applyMatrix4(s.matrixWorld),u.y+=o*c.gravity,r.start.addScaledVector(u,o),r.end.addScaledVector(u,o);const l=a.getAzimuthalAngle(),t=new g,w=[{key:p.fwd,vec:[0,0,-1]},{key:p.bkd,vec:[0,0,1]},{key:p.lft,vec:[-1,0,0]},{key:p.rgt,vec:[1,0,0]}];for(const{key:d,vec:v}of w)d&&(H.set(...v).applyAxisAngle(j,l),t.addScaledVector(H,c.playerSpeed*o));const n=o*25;f=(f-n+Y)%Y;const M=f/Math.PI%1,S=Math.abs(M)<2*n/Math.PI||Math.abs(1-M)<2*n/Math.PI;if(L<0&&S&&(f=Math.round(f/Math.PI)*Math.PI),t.length()>0){r.start.add(t),r.end.add(t);const d=new g(1,0,0),v=d.angleTo(t.normalize());d.cross(t);const I=new pe().setFromAxisAngle(j,Math.sign(d.y)*v);s.quaternion.slerp(I,1-2**(-o/.05))}else S&&(f=Math.round(f/Math.PI)*Math.PI);W.position.y=Math.abs(Math.sin(f))*.6,W.rotation.x=Math.sin(f)*.3,x.makeEmpty(),x.expandByPoint(r.start),x.expandByPoint(r.end),x.min.addScalar(-e.radius),x.max.addScalar(e.radius),x.applyMatrix4(k);const _=r.start.clone();z.shapecast({intersectsBounds:d=>d.intersectsBox(x),intersectsObject:d=>{if(!d.visible||d.material.transparent)return;k.copy(d.matrixWorld).invert(),b.makeEmpty(),b.expandByPoint(r.start),b.expandByPoint(r.end),b.min.addScalar(-e.radius),b.max.addScalar(e.radius),b.applyMatrix4(k),C.copy(r).applyMatrix4(k),G.radius=e.radius,G.applyMatrix4(k);const v=G.radius;d.geometry.boundsTree.shapecast({intersectsBounds:I=>I.intersectsBox(b),intersectsTriangle:I=>{const O=H,T=J,R=I.closestPointToSegment(C,O,T);if(R<v){const q=v-R,U=T.sub(O).normalize();C.start.addScaledVector(U,q),C.end.addScaledVector(U,q)}}}),r.copy(C).applyMatrix4(d.matrixWorld)}});const i=J;i.copy(e.segment.start).applyMatrix4(s.matrixWorld),i.subVectors(r.start,i),s.position.add(i),i.copy(_).subVectors(r.start,i),i.y>Math.abs(o*u.y*.25)?(L=Z,A=!0,u.set(0,0,0)):(L-=o,A=!1,u.addScaledVector(i,-i.dot(u))),s.position.y<-5&&K()}function be(){m.position.sub(a.target),a.target.sub(s.position);const o=m.position.length()*.1;let e=a.target.y;a.target.y=0,a.target.length()>4*o&&a.target.normalize().multiplyScalar(4*o),e=Math.max(1.5-.5*o,Math.min(e,1.5+o)),a.target.y=e,a.target.add(s.position),m.position.add(a.target)}function Pe(){E.update();const o=Math.min($.getDelta(),.1);if(c.firstPerson?(a.maxPolarAngle=Math.PI,a.minDistance=a.maxDistance=1e-4):(a.maxPolarAngle=Math.PI/2,a.minDistance=1,a.maxDistance=2e4),V){y.visible=c.displayBVH;const e=c.physicsSteps;for(let l=0;l<e;l++)xe(o/e)}be(),a.update(),h.render(B,m)}
//# sourceMappingURL=objectbvh_characterMovement-H6K52_Bw.js.map
