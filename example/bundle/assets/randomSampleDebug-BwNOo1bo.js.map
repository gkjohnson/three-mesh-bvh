{"version":3,"file":"randomSampleDebug-BwNOo1bo.js","sources":["../../randomSampleDebug.js"],"sourcesContent":["import * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { acceleratedRaycast, computeBoundsTree, disposeBoundsTree, AVERAGE, BVHHelper } from 'three-mesh-bvh';\n\n// Code for debugging issue #180 and other random raycast test associated issues.\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nlet renderer, camera, scene;\nlet meshes = [];\n\nlet _seed = null;\nfunction random() {\n\n\tif ( _seed === null ) throw new Error();\n\n\tconst a = 1103515245;\n\tconst c = 12345;\n\tconst m = 2e31;\n\n\t_seed = ( a * _seed + c ) % m;\n\treturn _seed / m;\n\n}\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0x111111;\n\n\t// renderer setup\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\trenderer.outputEncoding = THREE.sRGBEncoding;\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// scene setup\n\tscene = new THREE.Scene();\n\n\tconst light = new THREE.DirectionalLight( 0xffffff, 1 );\n\tlight.position.set( 1, 1, 1 );\n\tscene.add( light );\n\tscene.add( new THREE.AmbientLight( 0xb0bec5, 0.8 ) );\n\n\t// camera setup\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 50 );\n\tcamera.position.set( 0, 0, 4 );\n\tcamera.far = 100;\n\tcamera.updateProjectionMatrix();\n\n\tnew OrbitControls( camera, renderer.domElement );\n\n\tconst transformSeed = 7830035629;\n\tconst raySeed = 4697211981;\n\tconst options = { strategy: AVERAGE, packData: false, maxDepth: 1 };\n\n\tconst geometry = new THREE.TorusGeometry( 1, 1, 40, 10 );\n\tgeometry.computeBoundsTree( options );\n\n\t// mesh setup\n\t_seed = transformSeed;\n\trandom(); // call random() to seed with a larger value\n\n\tfor ( var i = 0; i < 10; i ++ ) {\n\n\t\tlet mesh = new THREE.Mesh( geometry, new THREE.MeshStandardMaterial() );\n\t\tmesh.rotation.x = random() * 10;\n\t\tmesh.rotation.y = random() * 10;\n\t\tmesh.rotation.z = random() * 10;\n\n\t\tmesh.position.x = random();\n\t\tmesh.position.y = random();\n\t\tmesh.position.z = random();\n\n\t\t// only the mesh at index 2 was causing an issue\n\t\tif ( i === 2 ) {\n\n\t\t\tmeshes.push( mesh );\n\t\t\tscene.add( mesh );\n\n\t\t\tconst wireframe = mesh.clone();\n\t\t\twireframe.material = new THREE.MeshBasicMaterial( { wireframe: true, color: 0xff6666 } );\n\t\t\tscene.add( wireframe );\n\n\t\t\tconst helper = new BVHHelper( mesh, 10 );\n\t\t\tscene.add( helper );\n\n\t\t\t// mesh.add( new THREE.AxesHelper( 10 ) );\n\n\t\t}\n\n\t\tmesh.updateMatrix( true );\n\t\tmesh.updateMatrixWorld( true );\n\n\t}\n\n\t// raycast\n\t_seed = raySeed;\n\trandom(); // call random() to seed with a larger value\n\n\tconst raycaster = new THREE.Raycaster();\n\traycaster.firstHitOnly = false;\n\traycaster.ray.origin.set( random() * 10, random() * 10, random() * 10 );\n\traycaster.ray.direction.copy( raycaster.ray.origin ).multiplyScalar( - 1 ).normalize();\n\n\t// set up raycast points\n\tconst sphereGeom = new THREE.SphereGeometry( 0.1 );\n\tconst sphereMesh = new THREE.Mesh( sphereGeom );\n\n\tsphereMesh.position.copy( raycaster.ray.at( 0, new THREE.Vector3() ) );\n\tscene.add( sphereMesh );\n\n\t// perform the hits\n\tconst bvhHits = raycaster.intersectObjects( meshes, true );\n\n\traycaster.firstHitOnly = true;\n\tconst firstHit = raycaster.intersectObjects( meshes, true );\n\n\tgeometry.boundsTree = null;\n\tconst ogHits = raycaster.intersectObjects( meshes, true );\n\n\tconsole.log( 'FIRST HIT', firstHit );\n\n\tconsole.log( 'BVH HITS', bvhHits );\n\n\tconsole.log( 'OG HITS', ogHits );\n\n\t// draw hit points and line\n\tconst firstHitSphere = sphereMesh.clone();\n\tfirstHitSphere.position.copy( firstHit[ 0 ].point );\n\tscene.add( firstHitSphere );\n\n\tconst bvhHitSphere = sphereMesh.clone();\n\tbvhHitSphere.position.copy( bvhHits[ 0 ].point );\n\tscene.add( bvhHitSphere );\n\n\tconst line = new THREE.Line();\n\tline.geometry.setFromPoints(\n\t\t[\n\t\t\traycaster.ray.at( 0, new THREE.Vector3() ),\n\t\t\traycaster.ray.at( 20, new THREE.Vector3() ),\n\t\t]\n\t);\n\tscene.add( line );\n\n\t// resize listener\n\twindow.addEventListener( 'resize', function () {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t}, false );\n\n}\n\nfunction render() {\n\n\trenderer.render( scene, camera );\n\n}\n"],"names":["THREE.Mesh","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","renderer","camera","scene","meshes","_seed","random","a","c","m","init","THREE.WebGLRenderer","render","THREE.sRGBEncoding","THREE.Scene","light","THREE.DirectionalLight","THREE.AmbientLight","THREE.PerspectiveCamera","OrbitControls","transformSeed","raySeed","options","AVERAGE","geometry","THREE.TorusGeometry","i","mesh","THREE.MeshStandardMaterial","wireframe","THREE.MeshBasicMaterial","helper","BVHHelper","raycaster","THREE.Raycaster","sphereGeom","THREE.SphereGeometry","sphereMesh","THREE.Vector3","bvhHits","firstHit","ogHits","firstHitSphere","bvhHitSphere","line","THREE.Line"],"mappings":"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"}