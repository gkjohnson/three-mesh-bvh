{"version":3,"file":"pointCloudIntersection-DsaLdpRi.js","sources":["../../../src/core/PointsBVH.js","../../../node_modules/three/examples/jsm/loaders/PLYLoader.js","../../pointCloudIntersection.js"],"sourcesContent":["import { Vector3, Matrix4, Ray, Box3 } from 'three';\nimport { INTERSECTED, NOT_INTERSECTED } from './Constants.js';\nimport { PrimitivePool } from '../utils/PrimitivePool.js';\nimport { GeometryBVH } from './GeometryBVH.js';\n\nconst _inverseMatrix = /* @__PURE__ */ new Matrix4();\nconst _ray = /* @__PURE__ */ new Ray();\nconst _pointPool = /* @__PURE__ */ new PrimitivePool( () => new Vector3() );\nconst _box = /* @__PURE__ */ new Box3();\n\nexport class PointsBVH extends GeometryBVH {\n\n\tget primitiveStride() {\n\n\t\treturn 1;\n\n\t}\n\n\twritePrimitiveBounds( i, targetBuffer, baseIndex ) {\n\n\t\tconst indirectBuffer = this._indirectBuffer;\n\t\tconst { geometry } = this;\n\t\tconst posAttr = geometry.attributes.position;\n\t\tconst indexAttr = geometry.index;\n\t\tlet pointIndex = indirectBuffer ? indirectBuffer[ i ] : i;\n\t\tif ( indexAttr ) {\n\n\t\t\tpointIndex = indexAttr.getX( pointIndex );\n\n\t\t}\n\n\t\tconst px = posAttr.getX( pointIndex );\n\t\tconst py = posAttr.getY( pointIndex );\n\t\tconst pz = posAttr.getZ( pointIndex );\n\n\t\t// Write in min/max format [minx, miny, minz, maxx, maxy, maxz]\n\t\t// For points, min equals max (epsilon padding is applied in computePrimitiveBounds)\n\t\ttargetBuffer[ baseIndex + 0 ] = px;\n\t\ttargetBuffer[ baseIndex + 1 ] = py;\n\t\ttargetBuffer[ baseIndex + 2 ] = pz;\n\t\ttargetBuffer[ baseIndex + 3 ] = px;\n\t\ttargetBuffer[ baseIndex + 4 ] = py;\n\t\ttargetBuffer[ baseIndex + 5 ] = pz;\n\n\t\treturn targetBuffer;\n\n\t}\n\n\tshapecast( callbacks ) {\n\n\t\t// TODO: avoid unnecessary \"iterate over points\" function\n\t\tconst point = _pointPool.getPrimitive();\n\t\tconst result = super.shapecast(\n\t\t\t{\n\t\t\t\t...callbacks,\n\t\t\t\tintersectsPrimitive: callbacks.intersectsPoint,\n\t\t\t\tscratchPrimitive: point,\n\t\t\t\titerate: iterateOverPoints,\n\t\t\t},\n\t\t);\n\n\t\t_pointPool.releasePrimitive( point );\n\t\treturn result;\n\n\t}\n\n\traycastObject3D( object, raycaster, intersects = [] ) {\n\n\t\tconst { geometry } = this;\n\t\tconst { matrixWorld } = object;\n\t\tconst { firstHitOnly } = raycaster;\n\n\t\t_inverseMatrix.copy( matrixWorld ).invert();\n\t\t_ray.copy( raycaster.ray ).applyMatrix4( _inverseMatrix );\n\n\t\tconst threshold = raycaster.params.Points.threshold;\n\t\tconst localThreshold = threshold / ( ( object.scale.x + object.scale.y + object.scale.z ) / 3 );\n\t\tconst localThresholdSq = localThreshold * localThreshold;\n\n\t\tlet closestHit = null;\n\t\tlet closestDistance = Infinity;\n\t\tthis.shapecast( {\n\t\t\tboundsTraverseOrder: box => {\n\n\t\t\t\treturn box.distanceToPoint( _ray.origin );\n\n\t\t\t},\n\t\t\tintersectsBounds: box => {\n\n\t\t\t\t// TODO: for some reason trying to early-out here is causing firstHitOnly tests to fail\n\t\t\t\t_box.copy( box ).expandByScalar( Math.abs( localThreshold ) );\n\t\t\t\treturn _ray.intersectsBox( _box ) ? INTERSECTED : NOT_INTERSECTED;\n\n\t\t\t},\n\t\t\tintersectsPoint: ( point, index ) => {\n\n\t\t\t\tconst rayPointDistanceSq = _ray.distanceSqToPoint( point );\n\t\t\t\tif ( rayPointDistanceSq < localThresholdSq ) {\n\n\t\t\t\t\tconst intersectPoint = new Vector3();\n\n\t\t\t\t\t_ray.closestPointToPoint( point, intersectPoint );\n\t\t\t\t\tintersectPoint.applyMatrix4( matrixWorld );\n\n\t\t\t\t\tconst distance = raycaster.ray.origin.distanceTo( intersectPoint );\n\n\t\t\t\t\tif ( distance < raycaster.near || distance > raycaster.far ) return;\n\n\t\t\t\t\tif ( firstHitOnly && distance >= closestDistance ) return;\n\t\t\t\t\tclosestDistance = distance;\n\n\t\t\t\t\tindex = this.resolvePrimitiveIndex( index );\n\n\t\t\t\t\tclosestHit = {\n\t\t\t\t\t\tdistance,\n\t\t\t\t\t\t// TODO: this doesn't seem right?\n\t\t\t\t\t\tdistanceToRay: Math.sqrt( rayPointDistanceSq ),\n\t\t\t\t\t\tpoint: intersectPoint,\n\t\t\t\t\t\tindex: geometry.index ? geometry.index.getX( index ) : index,\n\t\t\t\t\t\tface: null,\n\t\t\t\t\t\tfaceIndex: null,\n\t\t\t\t\t\tbarycoord: null,\n\t\t\t\t\t\tobject,\n\t\t\t\t\t};\n\n\t\t\t\t\tif ( ! firstHitOnly ) {\n\n\t\t\t\t\t\tintersects.push( closestHit );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\t\t} );\n\n\t\tif ( firstHitOnly && closestHit ) {\n\n\t\t\tintersects.push( closestHit );\n\n\t\t}\n\n\t\treturn intersects;\n\n\t}\n\n}\n\nfunction iterateOverPoints(\n\toffset,\n\tcount,\n\tbvh,\n\tintersectsPointFunc,\n\tcontained,\n\tdepth,\n\tpoint\n) {\n\n\tconst { geometry } = bvh;\n\tconst { index } = geometry;\n\tconst pos = geometry.attributes.position;\n\n\tfor ( let i = offset, l = count + offset; i < l; i ++ ) {\n\n\t\tconst prim = bvh.resolvePrimitiveIndex( i );\n\t\tconst vertexIndex = index ? index.array[ prim ] : prim;\n\t\tpoint.fromBufferAttribute( pos, vertexIndex );\n\n\t\tif ( intersectsPointFunc( point, i, contained, depth ) ) {\n\n\t\t\treturn true;\n\n\t\t}\n\n\t}\n\n\treturn false;\n\n}\n","import {\n\tBufferGeometry,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tLoader,\n\tColor,\n\tSRGBColorSpace\n} from 'three';\n\nconst _color = new Color();\n\n/**\n * A loader for PLY the PLY format (known as the Polygon\n * File Format or the Stanford Triangle Format).\n *\n * Limitations:\n *  - ASCII decoding assumes file is UTF-8.\n *\n * ```js\n * const loader = new PLYLoader();\n * const geometry = await loader.loadAsync( './models/ply/ascii/dolphins.ply' );\n * scene.add( new THREE.Mesh( geometry ) );\n * ```\n *\n * @augments Loader\n * @three_import import { PLYLoader } from 'three/addons/loaders/PLYLoader.js';\n */\nclass PLYLoader extends Loader {\n\n\t/**\n\t * Constructs a new PLY loader.\n\t *\n\t * @param {LoadingManager} [manager] - The loading manager.\n\t */\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\t// internals\n\n\t\tthis.propertyNameMapping = {};\n\t\tthis.customPropertyMapping = {};\n\n\t}\n\n\t/**\n\t * Starts loading from the given URL and passes the loaded PLY asset\n\t * to the `onLoad()` callback.\n\t *\n\t * @param {string} url - The path/URL of the file to be loaded. This can also be a data URI.\n\t * @param {function(BufferGeometry)} onLoad - Executed when the loading process has been finished.\n\t * @param {onProgressCallback} onProgress - Executed while the loading is in progress.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( text ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\t/**\n\t * Sets a property name mapping that maps default property names\n\t * to custom ones. For example, the following maps the properties\n\t * “diffuse_(red|green|blue)” in the file to standard color names.\n\t *\n\t * ```js\n\t * loader.setPropertyNameMapping( {\n\t * \tdiffuse_red: 'red',\n\t * \tdiffuse_green: 'green',\n\t * \tdiffuse_blue: 'blue'\n\t * } );\n\t * ```\n\t *\n\t * @param {Object} mapping - The mapping dictionary.\n\t */\n\tsetPropertyNameMapping( mapping ) {\n\n\t\tthis.propertyNameMapping = mapping;\n\n\t}\n\n\t/**\n\t * Custom properties outside of the defaults for position, uv, normal\n\t * and color attributes can be added using the setCustomPropertyNameMapping method.\n\t * For example, the following maps the element properties “custom_property_a”\n\t * and “custom_property_b” to an attribute “customAttribute” with an item size of 2.\n\t * Attribute item sizes are set from the number of element properties in the property array.\n\t *\n\t * ```js\n\t * loader.setCustomPropertyNameMapping( {\n\t *\tcustomAttribute: ['custom_property_a', 'custom_property_b'],\n\t * } );\n\t * ```\n\t * @param {Object} mapping - The mapping dictionary.\n\t */\n\tsetCustomPropertyNameMapping( mapping ) {\n\n\t\tthis.customPropertyMapping = mapping;\n\n\t}\n\n\t/**\n\t * Parses the given PLY data and returns the resulting geometry.\n\t *\n\t * @param {ArrayBuffer} data - The raw PLY data as an array buffer.\n\t * @return {BufferGeometry} The parsed geometry.\n\t */\n\tparse( data ) {\n\n\t\tfunction parseHeader( data, headerLength = 0 ) {\n\n\t\t\tconst patternHeader = /^ply([\\s\\S]*)end_header(\\r\\n|\\r|\\n)/;\n\t\t\tlet headerText = '';\n\t\t\tconst result = patternHeader.exec( data );\n\n\t\t\tif ( result !== null ) {\n\n\t\t\t\theaderText = result[ 1 ];\n\n\t\t\t}\n\n\t\t\tconst header = {\n\t\t\t\tcomments: [],\n\t\t\t\telements: [],\n\t\t\t\theaderLength: headerLength,\n\t\t\t\tobjInfo: ''\n\t\t\t};\n\n\t\t\tconst lines = headerText.split( /\\r\\n|\\r|\\n/ );\n\t\t\tlet currentElement;\n\n\t\t\tfunction make_ply_element_property( propertyValues, propertyNameMapping ) {\n\n\t\t\t\tconst property = { type: propertyValues[ 0 ] };\n\n\t\t\t\tif ( property.type === 'list' ) {\n\n\t\t\t\t\tproperty.name = propertyValues[ 3 ];\n\t\t\t\t\tproperty.countType = propertyValues[ 1 ];\n\t\t\t\t\tproperty.itemType = propertyValues[ 2 ];\n\n\t\t\t\t} else {\n\n\t\t\t\t\tproperty.name = propertyValues[ 1 ];\n\n\t\t\t\t}\n\n\t\t\t\tif ( property.name in propertyNameMapping ) {\n\n\t\t\t\t\tproperty.name = propertyNameMapping[ property.name ];\n\n\t\t\t\t}\n\n\t\t\t\treturn property;\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0; i < lines.length; i ++ ) {\n\n\t\t\t\tlet line = lines[ i ];\n\t\t\t\tline = line.trim();\n\n\t\t\t\tif ( line === '' ) continue;\n\n\t\t\t\tconst lineValues = line.split( /\\s+/ );\n\t\t\t\tconst lineType = lineValues.shift();\n\t\t\t\tline = lineValues.join( ' ' );\n\n\t\t\t\tswitch ( lineType ) {\n\n\t\t\t\t\tcase 'format':\n\n\t\t\t\t\t\theader.format = lineValues[ 0 ];\n\t\t\t\t\t\theader.version = lineValues[ 1 ];\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'comment':\n\n\t\t\t\t\t\theader.comments.push( line );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'element':\n\n\t\t\t\t\t\tif ( currentElement !== undefined ) {\n\n\t\t\t\t\t\t\theader.elements.push( currentElement );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcurrentElement = {};\n\t\t\t\t\t\tcurrentElement.name = lineValues[ 0 ];\n\t\t\t\t\t\tcurrentElement.count = parseInt( lineValues[ 1 ] );\n\t\t\t\t\t\tcurrentElement.properties = [];\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'property':\n\n\t\t\t\t\t\tcurrentElement.properties.push( make_ply_element_property( lineValues, scope.propertyNameMapping ) );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'obj_info':\n\n\t\t\t\t\t\theader.objInfo = line;\n\n\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tconsole.log( 'unhandled', lineType, lineValues );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( currentElement !== undefined ) {\n\n\t\t\t\theader.elements.push( currentElement );\n\n\t\t\t}\n\n\t\t\treturn header;\n\n\t\t}\n\n\t\tfunction parseASCIINumber( n, type ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'char': case 'uchar': case 'short': case 'ushort': case 'int': case 'uint':\n\t\t\t\tcase 'int8': case 'uint8': case 'int16': case 'uint16': case 'int32': case 'uint32':\n\n\t\t\t\t\treturn parseInt( n );\n\n\t\t\t\tcase 'float': case 'double': case 'float32': case 'float64':\n\n\t\t\t\t\treturn parseFloat( n );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseASCIIElement( properties, tokens ) {\n\n\t\t\tconst element = {};\n\n\t\t\tfor ( let i = 0; i < properties.length; i ++ ) {\n\n\t\t\t\tif ( tokens.empty() ) return null;\n\n\t\t\t\tif ( properties[ i ].type === 'list' ) {\n\n\t\t\t\t\tconst list = [];\n\t\t\t\t\tconst n = parseASCIINumber( tokens.next(), properties[ i ].countType );\n\n\t\t\t\t\tfor ( let j = 0; j < n; j ++ ) {\n\n\t\t\t\t\t\tif ( tokens.empty() ) return null;\n\n\t\t\t\t\t\tlist.push( parseASCIINumber( tokens.next(), properties[ i ].itemType ) );\n\n\t\t\t\t\t}\n\n\t\t\t\t\telement[ properties[ i ].name ] = list;\n\n\t\t\t\t} else {\n\n\t\t\t\t\telement[ properties[ i ].name ] = parseASCIINumber( tokens.next(), properties[ i ].type );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn element;\n\n\t\t}\n\n\t\tfunction createBuffer() {\n\n\t\t\tconst buffer = {\n\t\t\t  indices: [],\n\t\t\t  vertices: [],\n\t\t\t  normals: [],\n\t\t\t  uvs: [],\n\t\t\t  faceVertexUvs: [],\n\t\t\t  colors: [],\n\t\t\t  faceVertexColors: []\n\t\t\t};\n\n\t\t\tfor ( const customProperty of Object.keys( scope.customPropertyMapping ) ) {\n\n\t\t\t  buffer[ customProperty ] = [];\n\n\t\t\t}\n\n\t\t\treturn buffer;\n\n\t\t}\n\n\t\tfunction mapElementAttributes( properties ) {\n\n\t\t\tconst elementNames = properties.map( property => {\n\n\t\t\t\treturn property.name;\n\n\t\t\t} );\n\n\t\t\tfunction findAttrName( names ) {\n\n\t\t\t\tfor ( let i = 0, l = names.length; i < l; i ++ ) {\n\n\t\t\t\t\tconst name = names[ i ];\n\n\t\t\t\t\tif ( elementNames.includes( name ) ) return name;\n\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tattrX: findAttrName( [ 'x', 'px', 'posx' ] ) || 'x',\n\t\t\t\tattrY: findAttrName( [ 'y', 'py', 'posy' ] ) || 'y',\n\t\t\t\tattrZ: findAttrName( [ 'z', 'pz', 'posz' ] ) || 'z',\n\t\t\t\tattrNX: findAttrName( [ 'nx', 'normalx' ] ),\n\t\t\t\tattrNY: findAttrName( [ 'ny', 'normaly' ] ),\n\t\t\t\tattrNZ: findAttrName( [ 'nz', 'normalz' ] ),\n\t\t\t\tattrS: findAttrName( [ 's', 'u', 'texture_u', 'tx' ] ),\n\t\t\t\tattrT: findAttrName( [ 't', 'v', 'texture_v', 'ty' ] ),\n\t\t\t\tattrR: findAttrName( [ 'red', 'diffuse_red', 'r', 'diffuse_r' ] ),\n\t\t\t\tattrG: findAttrName( [ 'green', 'diffuse_green', 'g', 'diffuse_g' ] ),\n\t\t\t\tattrB: findAttrName( [ 'blue', 'diffuse_blue', 'b', 'diffuse_b' ] ),\n\t\t\t};\n\n\t\t}\n\n\t\tfunction parseASCII( data, header ) {\n\n\t\t\t// PLY ascii format specification, as per http://en.wikipedia.org/wiki/PLY_(file_format)\n\n\t\t\tconst buffer = createBuffer();\n\n\t\t\tconst patternBody = /end_header\\s+(\\S[\\s\\S]*\\S|\\S)\\s*$/;\n\t\t\tlet body, matches;\n\n\t\t\tif ( ( matches = patternBody.exec( data ) ) !== null ) {\n\n\t\t\t\tbody = matches[ 1 ].split( /\\s+/ );\n\n\t\t\t} else {\n\n\t\t\t\tbody = [ ];\n\n\t\t\t}\n\n\t\t\tconst tokens = new ArrayStream( body );\n\n\t\t\tloop: for ( let i = 0; i < header.elements.length; i ++ ) {\n\n\t\t\t\tconst elementDesc = header.elements[ i ];\n\t\t\t\tconst attributeMap = mapElementAttributes( elementDesc.properties );\n\n\t\t\t\tfor ( let j = 0; j < elementDesc.count; j ++ ) {\n\n\t\t\t\t\tconst element = parseASCIIElement( elementDesc.properties, tokens );\n\n\t\t\t\t\tif ( ! element ) break loop;\n\n\t\t\t\t\thandleElement( buffer, elementDesc.name, element, attributeMap );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn postProcess( buffer );\n\n\t\t}\n\n\t\tfunction postProcess( buffer ) {\n\n\t\t\tlet geometry = new BufferGeometry();\n\n\t\t\t// mandatory buffer data\n\n\t\t\tif ( buffer.indices.length > 0 ) {\n\n\t\t\t\tgeometry.setIndex( buffer.indices );\n\n\t\t\t}\n\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( buffer.vertices, 3 ) );\n\n\t\t\t// optional buffer data\n\n\t\t\tif ( buffer.normals.length > 0 ) {\n\n\t\t\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( buffer.normals, 3 ) );\n\n\t\t\t}\n\n\t\t\tif ( buffer.uvs.length > 0 ) {\n\n\t\t\t\tgeometry.setAttribute( 'uv', new Float32BufferAttribute( buffer.uvs, 2 ) );\n\n\t\t\t}\n\n\t\t\tif ( buffer.colors.length > 0 ) {\n\n\t\t\t\tgeometry.setAttribute( 'color', new Float32BufferAttribute( buffer.colors, 3 ) );\n\n\t\t\t}\n\n\t\t\tif ( buffer.faceVertexUvs.length > 0 || buffer.faceVertexColors.length > 0 ) {\n\n\t\t\t\tgeometry = geometry.toNonIndexed();\n\n\t\t\t\tif ( buffer.faceVertexUvs.length > 0 ) geometry.setAttribute( 'uv', new Float32BufferAttribute( buffer.faceVertexUvs, 2 ) );\n\t\t\t\tif ( buffer.faceVertexColors.length > 0 ) geometry.setAttribute( 'color', new Float32BufferAttribute( buffer.faceVertexColors, 3 ) );\n\n\t\t\t}\n\n\t\t\t// custom buffer data\n\n\t\t\tfor ( const customProperty of Object.keys( scope.customPropertyMapping ) ) {\n\n\t\t\t\tif ( buffer[ customProperty ].length > 0 ) {\n\n\t\t\t\t  \tgeometry.setAttribute(\n\t\t\t\t\t\tcustomProperty,\n\t\t\t\t\t\tnew Float32BufferAttribute(\n\t\t\t\t\t  \t\tbuffer[ customProperty ],\n\t\t\t\t\t  \t\tscope.customPropertyMapping[ customProperty ].length\n\t\t\t\t\t\t)\n\t\t\t\t  \t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgeometry.computeBoundingSphere();\n\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\tfunction handleElement( buffer, elementName, element, cacheEntry ) {\n\n\t\t\tif ( elementName === 'vertex' ) {\n\n\t\t\t\tbuffer.vertices.push( element[ cacheEntry.attrX ], element[ cacheEntry.attrY ], element[ cacheEntry.attrZ ] );\n\n\t\t\t\tif ( cacheEntry.attrNX !== null && cacheEntry.attrNY !== null && cacheEntry.attrNZ !== null ) {\n\n\t\t\t\t\tbuffer.normals.push( element[ cacheEntry.attrNX ], element[ cacheEntry.attrNY ], element[ cacheEntry.attrNZ ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( cacheEntry.attrS !== null && cacheEntry.attrT !== null ) {\n\n\t\t\t\t\tbuffer.uvs.push( element[ cacheEntry.attrS ], element[ cacheEntry.attrT ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( cacheEntry.attrR !== null && cacheEntry.attrG !== null && cacheEntry.attrB !== null ) {\n\n\t\t\t\t\t_color.setRGB(\n\t\t\t\t\t\telement[ cacheEntry.attrR ] / 255.0,\n\t\t\t\t\t\telement[ cacheEntry.attrG ] / 255.0,\n\t\t\t\t\t\telement[ cacheEntry.attrB ] / 255.0,\n\t\t\t\t\t\tSRGBColorSpace\n\t\t\t\t\t);\n\n\t\t\t\t\tbuffer.colors.push( _color.r, _color.g, _color.b );\n\n\t\t\t\t}\n\n\t\t\t\tfor ( const customProperty of Object.keys( scope.customPropertyMapping ) ) {\n\n\t\t\t\t\tfor ( const elementProperty of scope.customPropertyMapping[ customProperty ] ) {\n\n\t\t\t\t\t  buffer[ customProperty ].push( element[ elementProperty ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else if ( elementName === 'face' ) {\n\n\t\t\t\tconst vertex_indices = element.vertex_indices || element.vertex_index; // issue #9338\n\t\t\t\tconst texcoord = element.texcoord;\n\n\t\t\t\tif ( vertex_indices.length === 3 ) {\n\n\t\t\t\t\tbuffer.indices.push( vertex_indices[ 0 ], vertex_indices[ 1 ], vertex_indices[ 2 ] );\n\n\t\t\t\t\tif ( texcoord && texcoord.length === 6 ) {\n\n\t\t\t\t\t\tbuffer.faceVertexUvs.push( texcoord[ 0 ], texcoord[ 1 ] );\n\t\t\t\t\t\tbuffer.faceVertexUvs.push( texcoord[ 2 ], texcoord[ 3 ] );\n\t\t\t\t\t\tbuffer.faceVertexUvs.push( texcoord[ 4 ], texcoord[ 5 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( vertex_indices.length === 4 ) {\n\n\t\t\t\t\tbuffer.indices.push( vertex_indices[ 0 ], vertex_indices[ 1 ], vertex_indices[ 3 ] );\n\t\t\t\t\tbuffer.indices.push( vertex_indices[ 1 ], vertex_indices[ 2 ], vertex_indices[ 3 ] );\n\n\t\t\t\t}\n\n\t\t\t\t// face colors\n\n\t\t\t\tif ( cacheEntry.attrR !== null && cacheEntry.attrG !== null && cacheEntry.attrB !== null ) {\n\n\t\t\t\t\t_color.setRGB(\n\t\t\t\t\t\telement[ cacheEntry.attrR ] / 255.0,\n\t\t\t\t\t\telement[ cacheEntry.attrG ] / 255.0,\n\t\t\t\t\t\telement[ cacheEntry.attrB ] / 255.0,\n\t\t\t\t\t\tSRGBColorSpace\n\t\t\t\t\t);\n\t\t\t\t\tbuffer.faceVertexColors.push( _color.r, _color.g, _color.b );\n\t\t\t\t\tbuffer.faceVertexColors.push( _color.r, _color.g, _color.b );\n\t\t\t\t\tbuffer.faceVertexColors.push( _color.r, _color.g, _color.b );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction binaryReadElement( at, properties ) {\n\n\t\t\tconst element = {};\n\t\t\tlet read = 0;\n\n\t\t\tfor ( let i = 0; i < properties.length; i ++ ) {\n\n\t\t\t\tconst property = properties[ i ];\n\t\t\t\tconst valueReader = property.valueReader;\n\n\t\t\t\tif ( property.type === 'list' ) {\n\n\t\t\t\t\tconst list = [];\n\n\t\t\t\t\tconst n = property.countReader.read( at + read );\n\t\t\t\t\tread += property.countReader.size;\n\n\t\t\t\t\tfor ( let j = 0; j < n; j ++ ) {\n\n\t\t\t\t\t\tlist.push( valueReader.read( at + read ) );\n\t\t\t\t\t\tread += valueReader.size;\n\n\t\t\t\t\t}\n\n\t\t\t\t\telement[ property.name ] = list;\n\n\t\t\t\t} else {\n\n\t\t\t\t\telement[ property.name ] = valueReader.read( at + read );\n\t\t\t\t\tread += valueReader.size;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn [ element, read ];\n\n\t\t}\n\n\t\tfunction setPropertyBinaryReaders( properties, body, little_endian ) {\n\n\t\t\tfunction getBinaryReader( dataview, type, little_endian ) {\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\t// correspondences for non-specific length types here match rply:\n\t\t\t\t\tcase 'int8':\tcase 'char':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getInt8( at );\n\n\t\t\t\t\t}, size: 1 };\n\t\t\t\t\tcase 'uint8':\tcase 'uchar':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getUint8( at );\n\n\t\t\t\t\t}, size: 1 };\n\t\t\t\t\tcase 'int16':\tcase 'short':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getInt16( at, little_endian );\n\n\t\t\t\t\t}, size: 2 };\n\t\t\t\t\tcase 'uint16':\tcase 'ushort':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getUint16( at, little_endian );\n\n\t\t\t\t\t}, size: 2 };\n\t\t\t\t\tcase 'int32':\tcase 'int':\t\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getInt32( at, little_endian );\n\n\t\t\t\t\t}, size: 4 };\n\t\t\t\t\tcase 'uint32':\tcase 'uint':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getUint32( at, little_endian );\n\n\t\t\t\t\t}, size: 4 };\n\t\t\t\t\tcase 'float32': case 'float':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getFloat32( at, little_endian );\n\n\t\t\t\t\t}, size: 4 };\n\t\t\t\t\tcase 'float64': case 'double':\treturn { read: ( at ) => {\n\n\t\t\t\t\t\treturn dataview.getFloat64( at, little_endian );\n\n\t\t\t\t\t}, size: 8 };\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, l = properties.length; i < l; i ++ ) {\n\n\t\t\t\tconst property = properties[ i ];\n\n\t\t\t\tif ( property.type === 'list' ) {\n\n\t\t\t\t\tproperty.countReader = getBinaryReader( body, property.countType, little_endian );\n\t\t\t\t\tproperty.valueReader = getBinaryReader( body, property.itemType, little_endian );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tproperty.valueReader = getBinaryReader( body, property.type, little_endian );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseBinary( data, header ) {\n\n\t\t\tconst buffer = createBuffer();\n\n\t\t\tconst little_endian = ( header.format === 'binary_little_endian' );\n\t\t\tconst body = new DataView( data, header.headerLength );\n\t\t\tlet result, loc = 0;\n\n\t\t\tfor ( let currentElement = 0; currentElement < header.elements.length; currentElement ++ ) {\n\n\t\t\t\tconst elementDesc = header.elements[ currentElement ];\n\t\t\t\tconst properties = elementDesc.properties;\n\t\t\t\tconst attributeMap = mapElementAttributes( properties );\n\n\t\t\t\tsetPropertyBinaryReaders( properties, body, little_endian );\n\n\t\t\t\tfor ( let currentElementCount = 0; currentElementCount < elementDesc.count; currentElementCount ++ ) {\n\n\t\t\t\t\tresult = binaryReadElement( loc, properties );\n\t\t\t\t\tloc += result[ 1 ];\n\t\t\t\t\tconst element = result[ 0 ];\n\n\t\t\t\t\thandleElement( buffer, elementDesc.name, element, attributeMap );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn postProcess( buffer );\n\n\t\t}\n\n\t\tfunction extractHeaderText( bytes ) {\n\n\t\t\tlet i = 0;\n\t\t\tlet cont = true;\n\n\t\t\tlet line = '';\n\t\t\tconst lines = [];\n\n\t\t\tconst startLine = new TextDecoder().decode( bytes.subarray( 0, 5 ) );\n\t\t\tconst hasCRNL = /^ply\\r\\n/.test( startLine );\n\n\t\t\tdo {\n\n\t\t\t\tconst c = String.fromCharCode( bytes[ i ++ ] );\n\n\t\t\t\tif ( c !== '\\n' && c !== '\\r' ) {\n\n\t\t\t\t\tline += c;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tif ( line === 'end_header' ) cont = false;\n\t\t\t\t\tif ( line !== '' ) {\n\n\t\t\t\t\t\tlines.push( line );\n\t\t\t\t\t\tline = '';\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} while ( cont && i < bytes.length );\n\n\t\t\t// ascii section using \\r\\n as line endings\n\t\t\tif ( hasCRNL === true ) i ++;\n\n\t\t\treturn { headerText: lines.join( '\\r' ) + '\\r', headerLength: i };\n\n\t\t}\n\n\t\t//\n\n\t\tlet geometry;\n\t\tconst scope = this;\n\n\t\tif ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst bytes = new Uint8Array( data );\n\t\t\tconst { headerText, headerLength } = extractHeaderText( bytes );\n\t\t\tconst header = parseHeader( headerText, headerLength );\n\n\t\t\tif ( header.format === 'ascii' ) {\n\n\t\t\t\tconst text = new TextDecoder().decode( bytes );\n\n\t\t\t\tgeometry = parseASCII( text, header );\n\n\t\t\t} else {\n\n\t\t\t\tgeometry = parseBinary( data, header );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tgeometry = parseASCII( data, parseHeader( data ) );\n\n\t\t}\n\n\t\treturn geometry;\n\n\t}\n\n}\n\nclass ArrayStream {\n\n\tconstructor( arr ) {\n\n\t\tthis.arr = arr;\n\t\tthis.i = 0;\n\n\t}\n\n\tempty() {\n\n\t\treturn this.i >= this.arr.length;\n\n\t}\n\n\tnext() {\n\n\t\treturn this.arr[ this.i ++ ];\n\n\t}\n\n}\n\nexport { PLYLoader };\n","import Stats from 'stats.js/src/Stats';\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { PLYLoader } from 'three/examples/jsm/loaders/PLYLoader.js';\nimport { GUI } from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport {\n\tacceleratedRaycast, computeBoundsTree, disposeBoundsTree, BVHHelper, PointsBVH,\n\tSAH, CENTER, AVERAGE,\n} from 'three-mesh-bvh';\n\nTHREE.Points.prototype.raycast = acceleratedRaycast;\nTHREE.BufferGeometry.prototype.computeBoundsTree = computeBoundsTree;\nTHREE.BufferGeometry.prototype.disposeBoundsTree = disposeBoundsTree;\n\nconst plyPath = 'https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/point-cloud-porsche/scene.ply';\n\nconst params = {\n\tdisplayBVH: false,\n\tdisplayDepth: 15,\n\tdisplayParents: false,\n\tstrategy: CENTER,\n\tindirect: true,\n\tpointSize: 0.005,\n\traycastThreshold: 0.005,\n\tuseBVH: true,\n};\n\nlet stats, scene, camera, renderer, bvhHelper, pointCloud, outputContainer;\nconst mouse = new THREE.Vector2();\nconst raycaster = new THREE.Raycaster();\nraycaster.firstHitOnly = true;\nlet sphereCollision;\n\ninit();\n\nfunction init() {\n\n\tconst bgColor = 0x131619;\n\n\toutputContainer = document.getElementById( 'output' );\n\n\t// Renderer\n\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.setClearColor( bgColor, 1 );\n\trenderer.setAnimationLoop( render );\n\tdocument.body.appendChild( renderer.domElement );\n\n\t// Scene\n\tscene = new THREE.Scene();\n\n\t// Camera\n\tcamera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 100 );\n\tcamera.position.set( 0, 2, 4 );\n\n\tnew OrbitControls( camera, renderer.domElement );\n\n\t// Stats\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\t// Collision sphere\n\tsphereCollision = new THREE.Mesh(\n\t\tnew THREE.SphereGeometry( 0.025, 32, 32 ),\n\t\tnew THREE.MeshBasicMaterial( { color: 0xffff00, opacity: 0.9, transparent: true } )\n\t);\n\tsphereCollision.visible = false;\n\tscene.add( sphereCollision );\n\n\t// Load point cloud\n\tnew PLYLoader().load( plyPath, geometry => {\n\n\t\tpointCloud = new THREE.Points( geometry, new THREE.PointsMaterial( {\n\t\t\tsize: params.pointSize,\n\t\t\tvertexColors: true,\n\t\t} ) );\n\n\t\t// Center the point cloud\n\t\tgeometry.computeBoundingBox();\n\t\tgeometry.boundingBox.getCenter( pointCloud.position ).multiplyScalar( - 1 );\n\t\tpointCloud.position.y += 1;\n\n\t\tbvhHelper = new BVHHelper( pointCloud, params.displayDepth );\n\n\t\tscene.add( pointCloud, bvhHelper );\n\t\tupdateBVH();\n\n\t} );\n\n\t// GUI\n\tconst gui = new GUI();\n\n\tconst bvhFolder = gui.addFolder( 'BVH' );\n\tbvhFolder.add( params, 'displayBVH' );\n\tbvhFolder.add( params, 'displayParents' ).onChange( v => {\n\n\t\tbvhHelper.displayParents = v;\n\t\tbvhHelper.update();\n\n\t} );\n\tbvhFolder.add( params, 'displayDepth', 1, 25, 1 ).name( 'depth' ).onChange( v => {\n\n\t\tbvhHelper.depth = v;\n\t\tbvhHelper.update();\n\n\t} );\n\tbvhFolder.open();\n\n\tconst pointsFolder = gui.addFolder( 'Points' );\n\tpointsFolder.add( params, 'useBVH' ).onChange( updateBVH );\n\tpointsFolder.add( params, 'indirect' ).onChange( updateBVH );\n\tpointsFolder.add( params, 'strategy', { CENTER, AVERAGE, SAH } ).onChange( updateBVH );\n\tpointsFolder.add( params, 'pointSize', 0.001, 0.01, 0.001 );\n\tpointsFolder.add( params, 'raycastThreshold', 0.001, 0.01, 0.001 );\n\tpointsFolder.open();\n\n\twindow.addEventListener( 'resize', () => {\n\n\t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\tcamera.updateProjectionMatrix();\n\t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\t\trenderer.setPixelRatio( window.devicePixelRatio );\n\n\t} );\n\n\twindow.addEventListener( 'pointermove', e => {\n\n\t\tmouse.x = ( e.clientX / window.innerWidth ) * 2 - 1;\n\t\tmouse.y = - ( e.clientY / window.innerHeight ) * 2 + 1;\n\n\t} );\n\n}\n\nfunction updateBVH() {\n\n\tif ( params.useBVH ) {\n\n\t\tconsole.time( 'PointsBVH' );\n\t\tpointCloud.geometry.computeBoundsTree( {\n\t\t\tstrategy: parseInt( params.strategy ),\n\t\t\tindirect: params.indirect,\n\t\t\ttype: PointsBVH,\n\t\t} );\n\t\tconsole.timeEnd( 'PointsBVH' );\n\n\t} else {\n\n\t\tpointCloud.geometry.disposeBoundsTree();\n\n\t}\n\n\tbvhHelper.update();\n\n}\n\nfunction render() {\n\n\tstats.begin();\n\n\tif ( pointCloud ) {\n\n\t\t// Update GUI settings\n\t\tpointCloud.material.size = params.pointSize;\n\t\traycaster.params.Points.threshold = params.raycastThreshold;\n\t\tbvhHelper.visible = params.displayBVH;\n\n\t\t// Perform raycast\n\t\traycaster.setFromCamera( mouse, camera );\n\n\t\tconst startTime = window.performance.now();\n\t\tconst intersects = raycaster.intersectObject( pointCloud );\n\t\tconst hit = intersects[ 0 ];\n\n\t\tif ( hit ) {\n\n\t\t\tsphereCollision.position.copy( hit.point );\n\t\t\tsphereCollision.visible = true;\n\n\t\t} else {\n\n\t\t\tsphereCollision.visible = false;\n\n\t\t}\n\n\t\tconst delta = window.performance.now() - startTime;\n\t\toutputContainer.innerText = `${ delta.toFixed( 2 ) }ms`;\n\n\t}\n\n\trenderer.render( scene, camera );\n\tstats.end();\n\n}\n"],"names":["_inverseMatrix","Matrix4","_ray","Ray","_pointPool","PrimitivePool","Vector3","_box","Box3","PointsBVH","GeometryBVH","i","targetBuffer","baseIndex","indirectBuffer","geometry","posAttr","indexAttr","pointIndex","px","py","pz","callbacks","point","result","iterateOverPoints","object","raycaster","intersects","matrixWorld","firstHitOnly","localThreshold","localThresholdSq","closestHit","closestDistance","box","INTERSECTED","NOT_INTERSECTED","index","rayPointDistanceSq","intersectPoint","distance","offset","count","bvh","intersectsPointFunc","contained","depth","pos","l","prim","vertexIndex","_color","Color","PLYLoader","Loader","manager","url","onLoad","onProgress","onError","scope","loader","FileLoader","text","e","mapping","data","parseHeader","headerLength","patternHeader","headerText","header","lines","currentElement","make_ply_element_property","propertyValues","propertyNameMapping","property","line","lineValues","lineType","parseASCIINumber","n","type","parseASCIIElement","properties","tokens","element","list","j","createBuffer","buffer","customProperty","mapElementAttributes","elementNames","findAttrName","names","name","parseASCII","patternBody","body","matches","ArrayStream","loop","elementDesc","attributeMap","handleElement","postProcess","BufferGeometry","Float32BufferAttribute","elementName","cacheEntry","SRGBColorSpace","elementProperty","vertex_indices","texcoord","binaryReadElement","at","read","valueReader","setPropertyBinaryReaders","little_endian","getBinaryReader","dataview","parseBinary","loc","currentElementCount","extractHeaderText","bytes","cont","startLine","hasCRNL","c","arr","THREE.Points","acceleratedRaycast","THREE.BufferGeometry","computeBoundsTree","disposeBoundsTree","plyPath","params","CENTER","stats","scene","camera","renderer","bvhHelper","pointCloud","outputContainer","mouse","THREE.Vector2","THREE.Raycaster","sphereCollision","init","THREE.WebGLRenderer","render","THREE.Scene","THREE.PerspectiveCamera","OrbitControls","Stats","THREE.Mesh","THREE.SphereGeometry","THREE.MeshBasicMaterial","THREE.PointsMaterial","BVHHelper","updateBVH","gui","GUI","bvhFolder","v","pointsFolder","AVERAGE","SAH","startTime","hit","delta"],"mappings":"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","x_google_ignoreList":[1]}